<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <!-- <meta name="viewport" content="width=device-width, initial-scale=1"> -->
    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
    <meta name="apple-mobile-web-app-capable" content="yes" />
    <!-- viewport -->
    <meta content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0, user-scalable=no"
        name="viewport" />
    <title>FOE-Learner V-4.0 ::Passages_Jokes</title>
    <link rel="stylesheet" href="css/jquery.mobile-1.4.5.min.css">
    <link rel="stylesheet" href="css/jquery-ui.css">
    <link rel="stylesheet" href="css/customThemeElements.css">
    <link rel="stylesheet" href="css/simplePagination.css">
    <link rel="stylesheet" href="css/main.css">
    <link rel="stylesheet" href="css/styles.css">
    <link rel="stylesheet" href="css/common.css">
    <link rel="stylesheet" type="text/css" href="css/tooltipster.css" />
    <link rel="stylesheet" type="text/css" href="css/cssTooltip.css" />
    <link rel="stylesheet" type="text/css" href="css/jquery.wizard.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <link rel="stylesheet" href="css/header.css"><!-- Font Awesome CDN -->

    <script src="js/resources/foundation/passage_menustructure.js"></script>
    <script src="js/resources/foundation/passage.js"></script>
    <script src="js/jquery-2.1.4.min.js"></script>
    <script type="text/javascript" src="js/jquery-ui.js"></script>
    <script src="js/jquery.ui.touch-punch.min.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-app-compat.js"></script>

    <!-- Add Firestore (use the compat version for compatibility with the older syntax) -->
    <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-firestore-compat.js"></script>


    <script>
        // Added for chrome workaround - Vikas
        $(document).bind('mobileinit', function () {
            $.mobile.changePage.defaults.changeHash = false;
            $.mobile.hashListeningEnabled = false;
            $.mobile.pushStateEnabled = false;
        });
    </script>

    <script type="text/javascript">
        $(function () {
            $('#toggle4').click(function () {
                $('.toggle4').slideToggle(500);
                return false;
            });
        });

    </script>
    <script src="js/jquery.mobile-1.4.5.min.js"></script>
    <script src="js/jquery-viewstack.js" type="text/javascript"></script>
    <script src="js/jquery.simplePagination.js"></script>
    <script type="text/javascript" src="js/jquery.tooltipster.min.js"></script>
    <script type="text/javascript" src="js/querystring-0.9.0-min.js"></script>
    <script type="text/javascript" src="js/jquery.ui.touch-punch.min.js"></script>
    <!--<script type="text/javascript" src="js/jquery.wizard.js"></script>-->
    <!-- This script file goes at the end of the document -->
    <script src="js/bloomsTaxonomy.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', function () {
            // Function to handle the page change
            function updatePagination(pageNumber) {
                // Hide all pages
                $(".pagination ul li span").removeClass("current");

                // Show the current page
                $("#page-" + pageNumber + " > a").addClass("current");
                $("#page-" + pageNumber + " > span").addClass("current");
            }

            // Read the page number from URL parameters
            const urlParams = new URLSearchParams(window.location.search);
            const pageNumber = urlParams.get('page');

            if (pageNumber) {
                updatePagination(pageNumber);
            }
        });
    </script>





    <script>
        // Define global variables to store the name and uid
        var userName;
        var userId;

        // Function to get query parameters
        function getQueryParams() {
            const params = new URLSearchParams(window.location.search);
            return params;
        }

        // Function to display name and uid
        function displayUserInfo() {
            const queryParams = getQueryParams();
            const name = queryParams.get('name') || 'Guest'; // Default to 'Guest' if no name parameter is found
            const uid = queryParams.get('uid') || 'unknown'; // Default to 'unknown' if no uid parameter is found
            console.log("name=", name);
            console.log("uid=", uid);
            const greetingElement = document.getElementById('greeting');
            greetingElement.textContent = `Hello, ${name}! `;

            // Store the name and uid in the global variables
            userName = name;
            userId = uid;
        }

        // Call displayUserInfo on window load
        window.onload = displayUserInfo;

        function handleLogout() {
            window.location.href = 'http://localhost:3000/';
        }
    </script>


    <script type="text/javascript">

        var isFIBImplementation = false;
        var viewStack;
        var arrActivities = [];
        var arrQuestionObjectsMaster = [];
        var arrMenuObjects = [];
        var qcounter = 1;
        var currentPageNumber = 0;
        var currentQuestionObject;
        var CurrentInnerQuestion;
        var p = 0;
        var audioFile;
        var htmlBuilder = "";
        var activeTextInput = undefined;
        var activeCheckButton = undefined;
        var controlCounter = 0;
        var correctAnswerCount = 0;
        var radioGroupName = "answerOptions";
        var currentStage = 0;
        /*Timer code*/
        var f;
        var tempId;
        var mytimersec = [];
        var mytimermin = [];
        var myminute = '00';
        var mysec = '00';
        var mytimersecGlobal = [];
        var mytimerminGlobal = [];
        var myminuteGlobal = '00';
        var mysecGlobal = '00';
        var secondCount;
        var pbi = 1;
        var timervalue = ['00, 00, 00, 00'];
        var timermin = ['00, 00, 00, 00'];
        var timerglobalvalue = ['00, 00, 00, 00'];
        var timeglobalrmin = ['00, 00, 00, 00'];
        /*Timer end*/
        var synonymContainer = [];
        var titletext;
        var matchesContainer = [];
        var synonymsArray;
        var viewStackSuffixHtml = "</div>";
        var contentImagesPath = "images/resources/content/";
        var SoundFilePath = "AudioFile/";
        var bloomPlaceholders = [6, 5, 4, 3, 2, 1];
        var flag = [true, true, true, true, true, true];
        var $pageid = 1;
        var AudioFileName;
        var matches;
        var answer;
        var usedMode;
        var incrementCount = -1;

        (function ($) {
            $.fn.hasScrollBar = function () {
                return this.get(0).scrollHeight > this.height();
            }
        })(jQuery);

        function validateQueryStrings() {
            var s = 0;
            if ($.QueryString() == null || $.QueryString() == undefined || $.QueryString().size == 0 || $.QueryString().stg == 'undefined' || $.QueryString().stg == '')
                s = 1;
            else if ($.QueryString().size >= 1) {
                s = $.QueryString().stg;
                if (isNaN(s)) {
                    s = 0;
                }
                else if (parseInt(s) > 5) {
                    s = 0;
                }
            }
            else if ($.QueryString().size == 1) {
                s = $.QueryString().stg;
            }
            return s;
        }

        $(document).ready(function () {

            /*Timer code*/
            timer();
            timerGlobal();
            /*timer end*/
            $("#rightAnswer_mat").hide();
            $('body').tooltipster();
            currentStage = validateQueryStrings();
            var moduleHeaderText = $(contentData).filter("activities").attr("headertext");
            $("#moduleHeaderText span").html("<h3 style='margin-bottom:-10px;'>" + moduleHeaderText + "</h3>");
            $("#rightAnswer").hide();

            $("#stage" + currentStage).addClass("stageActive");
            $("#listage" + currentStage).show();

            /* To disable Teach button */
            var TeachPresence = headerText = $(menuData).find("menuitem").attr("teach");
            if (TeachPresence == "no") {
                $("#teachmode").addClass("disableddiv");
                $("#radio-choice-h-2a").css("display", "none");
                $("#radio-choice-h-2a").css("opacity", "0.1");
            }
            var TestPresence = $(menuData).find("menuitem").attr("test");
            if (TestPresence == "no") {
                $("#testmode").addClass("disableddiv");
                $("#radio-choice-h-2d").css("display", "none");
            }

            /* To disable Teach button */

            $(menuData).find("menuitem").each(function () {
                $(this).find("menuitem").each(function () {
                    var objMenu = {};
                    // Set property to the menu object
                    objMenu.id = $(this).attr("PassageGroupId");
                    objMenu.title = $(this).attr("themes").split(",");
                    objMenu.type = $(this).attr("impType");
                    objMenu.learn = $(this).attr("learn");
                    objMenu.enabled = ($(this).attr("excludeFromDemo") == 'false');
                    // Push the menu Object into the menu Object array
                    arrMenuObjects.push(objMenu);

                });
            });



            $("#totScore").html(0);
            let currentActivity = '';

            // Function to handle menu item clicks and set the current activity
            $("#ulMenuItem li").each(function () {
                var menuItemli = $(this);
                menuItemli.click(function (e) {
                    if (!$(this).hasClass("active")) {
                        // Set the current activity based on the clicked menu item
                        currentActivity = $(this).text().trim(); // Use the text of the clicked item as the activity name

                        // Update the UI to reflect the active menu item
                        $("#totScore").html(0);
                        $("#ulMenuItem li").removeClass("active");
                        menuItemli.addClass("active");
                    }
                });
            });

            getContent(arrMenuObjects[0].title[0]);

            initPaginator();
            var count = $("#passage" + (currentPageNumber - 1)).text().replace(/[^\w ]/g, "").split(/\s+/).length;
            if (count > 70) {
                var innerText = "";
                innerText = $("#passage" + (currentPageNumber - 1)).html();
                var trimmedContent = "";
                trimmedContent = innerText.split(/\s+/).slice(0, 69).join(" ");
                $("#passage" + (pageNumber - 1)).html(trimmedContent).append(".....");
            }



            $(".ReadMore").click(function () {
                var PassageTitle = "<h3 style='font-size:20px;text-align:center'>" + arrQuestionObjectsMaster[currentPageNumber].PassageTitle + " </h3>";
                var FullPassage = arrQuestionObjectsMaster[currentPageNumber].desc.replace(/{/g, '<span class="hoverWord" style="background-color:#ffff99;">').replace(/}/g, '</span>');

                $("#FullStory").html(PassageTitle + FullPassage);
                $("#FullPassage").popup('open');
                $(".hoverWord").on("mouseover", function () {
                    $(this).addClass("currentword");
                    titletext = $("span.currentword").next().text();
                    $(".currentword").attr("title", titletext);
                    $(this).removeClass("currentword");
                });

            });

            $(document).on('change', 'input[type="radio"]', function (event) {
                $("#rightAnswer").hide();
                $("#showAnswer").hide();

                if ($(this).hasClass(radioGroupName)) {
                    var wordDataValue = $(this).attr("value").replace(/~/, "'");

                    if ($(this).is(":checked")) {
                        currentQuestionObject.checkedOptionId = $(this).attr("id");
                    }
                }
            });

            if (arrMenuObjects[0].learn == "no") {
                $("#learnmode").addClass("disableddiv");
                $("#radio-choice-h-2b").css("display", "none");
            }
            var width = $(window).width();
            if (width <= 1024) {

                var audioplay = true;
                $(document).on('click', '.playpausebtn', function () {
                    //$(".imgplay").click(function () {
                    if (audioplay) {
                        audioFile.play();
                        audioplay = false;

                        $("#pauseContainer").css("display", "block");
                        $("#playContainer").css("display", "none");

                    }
                    else {
                        audioFile.pause();
                        audioplay = true;

                        $("#pauseContainer").css("display", "none");
                        $("#playContainer").css("display", "block");
                    }
                });


                audioFile.addEventListener('ended', function () {
                    $("#pauseContainer").css("display", "none");
                    $("#playContainer").css("display", "block");
                });
            }
            $("#imptcmprntion").click(function () {
                console.log("Clicked on it ")
                isFIBImplementation = false;
                $('#playContainer').hide();
                $('#pauseContainer').hide();


                activeStepNo = 1;
                if ($("#imptcmprntion").attr("data-leanmode") == "no") {
                    $("#learnmode").addClass("disableddiv");
                    $("#radio-choice-h-2b").css("display", "none");
                }

                var PassageId = $("#stack" + currentPageNumber).attr("data-id");
                $("#imptcmprntion").addClass("activecontainer");
                $("#Backbutton").css("display", "inline-block");
                $("#checkanswer").css("display", "block");
                $("#showAnswer").css("display", "none");
                $("#rightAnswer").css("display", "none");
                $("#imptcmprntion").addClass("disabledLi");
                $("#imtVocabulary").addClass("disabledLi");
                $("#imtFIb").addClass("disabledLi");
                if (usedMode == "L") {
                    $("#checkanswer").css("opacity", "0.1");
                    $("#checkanswer").css("pointer-events", "none");
                }
                else {
                    $("#checkanswer").css("opacity", "1");
                    $("#checkanswer").css("pointer-events", "painted");
                }

                $("#cmpltactivity").css("opacity", "1");
                $("#cmpltactivity").css("pointer-events", "painted");
                $(".ui-controlgroup-controls ").css("opacity", "0.2");
                $(".ui-controlgroup-controls ").css("pointer-events", "none");
                $("#imtSpelling").addClass("disabledLi");
                $("#imptQandA").addClass("disabledLi");
                $("#imtJumbledWords").addClass("disabledLi");
                incrementCount = -1;
                getContentMcq(PassageId, "Comprehension", currentPageNumber, usedMode);
                if (audioFile != undefined) {
                    audioFile.pause();
                    audioFile.currentTime = 0;
                }
            });

            $("#imtVocabulary").click(function () {
                isFIBImplementation = false;
                $('#playContainer').hide();
                $('#pauseContainer').hide();

                if ($("#imptcmprntion").attr("data-leanmode") == "no") {
                    $("#learnmode").addClass("disableddiv");
                    $("#radio-choice-h-2b").css("display", "none");
                }
                activeStepNo = 1;
                var PassageId = $("#stack" + currentPageNumber).attr("data-id");
                $("#imtVocabulary").addClass("activecontainer");
                $("#checkanswer").css("display", "block");
                $("#showAnswer").css("display", "none");
                $("#rightAnswer").css("display", "none");
                $("#Backbutton").css("display", "inline-block");
                $("#imptcmprntion").addClass("disabledLi");
                if (usedMode == "L") {
                    $("#checkanswer").css("opacity", "0.1");
                    $("#checkanswer").css("pointer-events", "none");
                }
                else {
                    $("#checkanswer").css("opacity", "1");
                    $("#checkanswer").css("pointer-events", "painted");
                }

                $("#cmpltactivity").css("opacity", "1");
                $("#cmpltactivity").css("pointer-events", "painted");
                $(".ui-controlgroup-controls ").css("opacity", "0.2");
                $(".ui-controlgroup-controls ").css("pointer-events", "none");
                $("#imtVocabulary").addClass("disabledLi");
                $("#imtFIb").addClass("disabledLi");
                $("#imtSpelling").addClass("disabledLi");
                $("#imptQandA").addClass("disabledLi");
                $("#imtJumbledWords").addClass("disabledLi");
                incrementCount = -1;
                getContentMat(PassageId, "Vocabulary", currentPageNumber, usedMode);
                if (audioFile != undefined) {
                    audioFile.pause();
                    audioFile.currentTime = 0;
                }
            });

            $("#imtJumbledWords").click(function () {
                isFIBImplementation = false;
                $('#playContainer').hide();
                $('#pauseContainer').hide();


                if ($("#imptcmprntion").attr("data-leanmode") == "no") {
                    $("#learnmode").addClass("disableddiv");
                    $("#radio-choice-h-2b").css("display", "none");
                }
                activeStepNo = 1;
                var PassageId = $("#stack" + currentPageNumber).attr("data-id");
                $("#imtJumbledWords").addClass("activecontainer");
                $("#Backbutton").css("display", "inline-block");
                $("#checkanswer").css("display", "block");
                $("#rightAnswer").css("display", "none");
                $("#showAnswer").css("display", "none");
                if (usedMode == "L") {
                    $("#checkanswer").css("opacity", "0.1");
                    $("#checkanswer").css("pointer-events", "none");
                }
                else {
                    $("#checkanswer").css("opacity", "1");
                    $("#checkanswer").css("pointer-events", "painted");
                }

                $("#cmpltactivity").css("opacity", "1");
                $("#cmpltactivity").css("pointer-events", "painted");
                $(".ui-controlgroup-controls ").css("opacity", "0.2");
                $(".ui-controlgroup-controls ").css("pointer-events", "none");
                $("#imptcmprntion").addClass("disabledLi");
                $("#imtVocabulary").addClass("disabledLi");
                $("#imtFIb").addClass("disabledLi");
                $("#imtSpelling").addClass("disabledLi");
                $("#imptQandA").addClass("disabledLi");
                $("#imtJumbledWords").addClass("disabledLi");
                getContentJumbled(PassageId, "JumbledWords", currentPageNumber, usedMode);
                incrementCount = -1;
                if (audioFile != undefined) {
                    audioFile.pause();
                    audioFile.currentTime = 0;
                }
            });

            $("#imtFIb").click(function () {

                isFIBImplementation = true;
                $('#playContainer').hide();
                $('#pauseContainer').hide();

                if ($("#imptcmprntion").attr("data-leanmode") == "no") {
                    $("#learnmode").addClass("disableddiv");
                    $("#radio-choice-h-2b").css("display", "none");
                }
                activeStepNo = 1;
                var PassageId = $("#stack" + currentPageNumber).attr("data-id");


                $("#imtFIb").addClass("activecontainer");
                $("#Backbutton").css("display", "inline-block");
                $("#checkanswer").css("display", "block");
                $("#rightAnswer").css("display", "none");
                $("#showAnswer").css("display", "none");

                $("#imptcmprntion").addClass("disabledLi");
                if (usedMode == "L") {
                    $("#checkanswer").css("opacity", "0.1");
                    $("#checkanswer").css("pointer-events", "none");
                }
                else {
                    $("#checkanswer").css("opacity", "1");
                    $("#checkanswer").css("pointer-events", "painted");
                }

                $("#cmpltactivity").css("opacity", "1");
                $("#cmpltactivity").css("pointer-events", "painted");
                $(".ui-controlgroup-controls ").css("opacity", "0.2");
                $(".ui-controlgroup-controls ").css("pointer-events", "none");
                $("#imtVocabulary").addClass("disabledLi");
                $("#imtFIb").addClass("disabledLi");
                $("#imtSpelling").addClass("disabledLi");
                $("#imptQandA").addClass("disabledLi");
                $("#imtJumbledWords").addClass("disabledLi");
                incrementCount = -1;
                getContentFib(PassageId, "Fillintheblanks", currentPageNumber, usedMode);

                if (audioFile != undefined) {
                    audioFile.pause();
                    audioFile.currentTime = 0;
                }
            });

            $("#imptQandA").click(function () {
                $("#DivLeft1").hide();
                $("#DivRight").hide();
                $("#play-bar").hide();
                isFIBImplementation = false;
                $('#playContainer').hide();
                $('#pauseContainer').hide();


                if ($("#imptcmprntion").attr("data-leanmode") == "no") {
                    $("#learnmode").addClass("disableddiv");
                    $("#radio-choice-h-2b").css("display", "none");
                }
                activeStepNo = 1;
                var PassageId = $("#stack" + currentPageNumber).attr("data-id");
                $("#imptQandA").addClass("activecontainer");
                $("#Backbutton").css("display", "inline-block");
                $("#checkanswer").css("display", "block");
                if (usedMode == "L") {
                    $("#checkanswer").css("opacity", "0.1");
                    $("#checkanswer").css("pointer-events", "none");
                }
                else {
                    $("#checkanswer").css("opacity", "1");
                    $("#checkanswer").css("pointer-events", "painted");
                }

                $("#cmpltactivity").css("opacity", "1");
                $("#cmpltactivity").css("pointer-events", "painted");
                $(".ui-controlgroup-controls ").css("opacity", "0.2");
                $(".ui-controlgroup-controls ").css("pointer-events", "none");
                $("#rightAnswer").css("display", "none");
                $("#showAnswer").css("display", "none");
                $("#imptcmprntion").addClass("disabledLi");
                $("#imtVocabulary").addClass("disabledLi");
                $("#imtFIb").addClass("disabledLi");
                $("#imtSpelling").addClass("disabledLi");
                $("#imptQandA").addClass("disabledLi");
                $("#imtJumbledWords").addClass("disabledLi");
                getContentQA(PassageId, "QandA", currentPageNumber, usedMode);
                if (audioFile != undefined) {
                    audioFile.pause();
                    audioFile.currentTime = 0;
                }
                incrementCount = -1;

            });
            $("#imptQandA").trigger("click");

            $("#imtSpelling").click(function () {
                isFIBImplementation = false;
                $('#playContainer').hide();
                $('#pauseContainer').hide();
                if ($("#imptcmprntion").attr("data-leanmode") == "no") {
                    $("#learnmode").addClass("disableddiv");
                    $("#radio-choice-h-2b").css("display", "none");
                }
                activeStepNo = 1;
                var PassageId = $("#stack" + currentPageNumber).attr("data-id");
                $("#Backbutton").css("display", "inline-block");
                $("#imtSpelling").addClass("activecontainer");
                $("#checkanswer").css("display", "block");
                $("#showAnswer").css("display", "none");
                $("#rightAnswer").css("display", "none");
                $("#imptcmprntion").addClass("disabledLi");
                $("#imtVocabulary").addClass("disabledLi");
                if (usedMode == "L") {
                    $("#checkanswer").css("opacity", "0.1");
                    $("#checkanswer").css("pointer-events", "none");
                }
                else {
                    $("#checkanswer").css("opacity", "1");
                    $("#checkanswer").css("pointer-events", "painted");
                }
                $("#cmpltactivity").css("opacity", "1");
                $("#cmpltactivity").css("pointer-events", "painted");
                $(".ui-controlgroup-controls ").css("opacity", "0.2");
                $(".ui-controlgroup-controls ").css("pointer-events", "none");
                $("#imtFIb").addClass("disabledLi");
                $("#imtSpelling").addClass("disabledLi");
                $("#imptQandA").addClass("disabledLi");
                $("#imtJumbledWords").addClass("disabledLi");
                incrementCount = -1;
                getContentSpelling(PassageId, "Spelling", currentPageNumber, usedMode);
                if (audioFile != undefined) {
                    audioFile.pause();
                    audioFile.currentTime = 0;
                }

            });

            $("#Backbutton").click(function () {
                window.location.href = 'index.html';
            });

            $("#Backbutton").click(function () {
                isFIBImplementation = false;
                $('#playContainer').show();
                //$('#pauseContainer').show();
                var moduleHeaderText = $(contentData).filter("activities").attr("headertext");
                $("#moduleHeaderText span").html("<h3 style='margin-bottom:-10px;'>" + moduleHeaderText + "</h3>");
                $(".container-fluid").css("display", "none");
                $(".pictureIllustrationContainer").css("display", "block");
                $("#DivLeft").css("opacity", "1");
                $("#light-pagination").css("opacity", "1")
                $(".ShowCheckDiv").css("display", "none");
                $("#imptcmprntion").removeClass("activecontainer");
                $("#imtVocabulary").removeClass("activecontainer");
                $("#imtFIb").removeClass("activecontainer");
                $("#imptcmprntion").removeClass("activecontainer");
                $("#imtVocabulary").removeClass("activecontainer");
                $("#imtFIb").removeClass("activecontainer");
                $("#imtSpelling").removeClass("activecontainer");
                $("#imptQandA").removeClass("activecontainer");
                $("#imtJumbledWords").removeClass("activecontainer");
                $("#imptcmprntion").removeClass("active");
                $("#imtVocabulary").removeClass("active");
                $("#imtFIb").removeClass("active");
                $("#imptcmprntion").removeClass("active");
                $("#imtVocabulary").removeClass("active");
                $("#imtFIb").removeClass("active");
                $("#imtSpelling").removeClass("active");
                $("#imptQandA").removeClass("active");
                $("#imtJumbledWords").removeClass("active");
                $("#PassageContainer").css("display", "block");
                $(".ui-controlgroup-controls ").css("opacity", "1");
                $(".ui-controlgroup-controls ").css("pointer-events", "painted");
                $("#imptcmprntion").removeClass("disabledLi");
                $("#imtVocabulary").removeClass("disabledLi");
                $("#imtFIb").removeClass("disabledLi");
                $("#imtSpelling").removeClass("disabledLi");
                $("#imptQandA").removeClass("disabledLi");
                $("#imtJumbledWords").removeClass("disabledLi");
                $(".pagination ul li span").removeClass("current");
                $("#page-" + (currentPageNumber + 1) + " > a").addClass("current");
                $("#page-" + (currentPageNumber + 1) + " > span").addClass("current");
                $("#page-" + (currentPageNumber + 1) + " > .next").removeClass("current");
                LoadAudio(currentPageNumber);
                incrementCount = -1;


                var width = $(window).width();
                if (width <= 1024) {

                    audioFile.play();
                    $("#pauseContainer").css("display", "block");
                    $("#playContainer").css("display", "none");
                    audioFile.addEventListener('ended', function () {
                        $("#pauseContainer").css("display", "none");
                        $("#playContainer").css("display", "block");
                    });
                }
                $('.ReadMore').css("display", "block");
                $('.ReadMore').css("cursor", "pointer");
            });

            $(".backToPassage").click(function () {

                var PassageId = $("#stack" + currentPageNumber).attr("data-id");
                getContent(arrMenuObjects[0].id, arrMenuObjects[0].title[0]);
                $("#DivMainContent").show();
                $("#noContent").hide();
                $("#DivLeft").css("opacity", "1");
                $(".container-fluid").css("display", "none");
                $(".pictureIllustrationContainer").css("display", "block");
                $(".ShowCheckDiv").css("display", "none");
                $("#light-pagination").css("opacity", "1");
                $("#imptcmprntion").removeClass("activecontainer");
                $("#imtVocabulary").removeClass("activecontainer");
                $("#imtFIb").removeClass("activecontainer");
                $("#imtSpelling").removeClass("activecontainer");
                $("#imptQandA").removeClass("activecontainer");
                $("#imtJumbledWords").removeClass("activecontainer");
                $("#PassageContainer").css("display", "block");
                $("#imptcmprntion").removeClass("active");
                $("#imtVocabulary").removeClass("active");
                $("#imtFIb").removeClass("active");
                $("#imtSpelling").removeClass("active");
                $("#imptQandA").removeClass("active");
                $("#imtJumbledWords").removeClass("active");
                $("#imptcmprntion").removeClass("disabledLi");
                $("#imtVocabulary").removeClass("disabledLi");
                $("#imtFIb").removeClass("disabledLi");
                $("#imtSpelling").removeClass("disabledLi");
                $("#imptQandA").removeClass("disabledLi");
                $("#imtJumbledWords").removeClass("disabledLi");

                incrementCount = -1;
            });

            $("#backtohome").on("vclick", function (event) {
                $("#stackContainer").show();
                $("#stack0").hide();
                $("#stack" + currentPageNumber).show();
                $("#stack" + currentPageNumber + "  .step_" + activeStepNo).addClass("active");
                $("#correctAnswerContainer").hide();
                /* back button for question mat*/
                $(".steps-index-container").css("opacity", "1");
                $(".steps-index-container").css("pointer-events", "painted");
                /* back button for question mat*/
                $("#light-pagination").show();
                $("#backtohome").hide();
                $("#checkanswer").show();
                $("#Backbutton").show();
            });

            $(document).on('change', 'input[type="checkbox"]', function (event) {
                //mahesh
                var labelid = $(this).attr("id").replace("option", "label");
                $("#rightAnswer").hide();
                $("#showAnswer").hide();
                var checkCounter = 0;
                var checkBoxId = $(this).attr("id");
                //var arrTempCheckbox = $("#stack" + currentPageNumber).find("input[type=checkbox]");
                var arrTempInput = $("#stack" + currentPageNumber).find("input[type=text]");
                if ($(this).is(":checked")) {
                    $(activeTextInput).val($("#" + checkBoxId).attr("value").replace(/~/g, "'"));
                    $(activeTextInput).attr("data-option-rel", $("#" + checkBoxId).attr("value"));
                    $(activeTextInput).attr("data-option-map", checkBoxId);
                    controlCounter++;
                    setDefaultTextInputFocus();
                    //labelid = $(this).attr("id").replace("option", "label");

                }
                else {
                    $(this).prop("checked", false);
                    var unSelected = $(this).val().trim();
                    $(arrTempInput).each(function () {
                        var t = 0
                        if ($(this).val().trim() == unSelected) {
                            $(this).val(" ");
                            incrementCount = t - 1;
                            setDefaultTextInputFocus();
                            return false;
                        }
                        t++;
                    });
                    return true;


                }
                $("#stackContainer label").removeClass("ui-btn-icon-left");

            });



            $("#imgmute").click(function () {

                if (!audioFile.muted) {
                    audioFile.muted = true;


                    $("#imgmute").attr("src", "images/mute.png");
                    $("#imgmute").attr("title", "Unmute Sound");
                }
                else {
                    audioFile.muted = false;

                    $("#imgmute").attr("src", "images/unmute.png")
                    $("#imgmute").attr("title", "Mute Sound");
                }
            });

            $(document).on('focusin', 'input[type="text"]', function (event) {
                $("#showAnswer").css("display", "none");
                if ($("#myViewStack").hasClass("viewstackFIB")) {

                    $(this).keydown(function (e) {
                        if (e.keyCode == 8) {
                            var inputControl = $(this);
                            var checkBoxControl = $(this).attr("data-option-map");
                            var labelControl = checkBoxControl.replace("option", "label");
                            inputControl.val('');
                            $("#" + labelControl).removeClass("ui-checkbox-on");
                            $("#" + labelControl).addClass("ui-checkbox-off");
                            $("#" + checkBoxControl).prop("checked", false);
                            inputControl.attr("data-option-map", "");
                            activeTextInput = $(this);
                            var t = 0;
                            $(".keyin").each(function () {
                                if ($(this).attr("id") == inputControl.attr("id")) {
                                    incrementCount = t - 1;
                                    setDefaultTextInputFocus();
                                    return false;
                                }
                                t++;
                            });
                            return true;
                        }
                        else {
                            return false;
                        }
                    });
                }
                else {
                    activeTextInput = $(this);
                    tempId = $(this).attr("id");
                    activeInput = $(this);
                    $(this).attr("title", "");
                    if ($(this).val() != "" && $(this).val() == $(this).attr("data-jumbled")) {
                        $(this).val("");
                    }
                    $(this).addClass("ui-link");
                    $(this).attr("title", $(this).attr("data-jumbled"));
                    for (var t = 0; t < arrTextControls.length; t++) {
                        if ($(arrTextControls[t]).attr("id") == tempId) {
                            controlCounter = t;
                        }
                    }
                    $(".keyin").keyup(function (event) {
                        if (event.keyCode == 13) {
                            $("#checkanswer").click();
                        }
                    });
                }

            });

            $(document).on('focusout', 'input[type="text"]', function (event) {
                if ($(this).val() == "") {
                    var t = $(this).attr("data-jumbled");
                    $(this).attr("title", "");
                    $(this).val(t);
                }
            });


            //$(document).on('focusin', 'input[type="text"]', function (event) {
            //    $("#showAnswer").css("display", "none");
            //});

            $(document).on('focusin', 'input[type="textarea"]', function (event) {
                $("#showAnswer").css("display", "none");
            });

            $("#finish").on("vclick", function (event) {
                let correctAnswerCount = 0;
                let TotalnumberOfQuestion = $("#stack" + currentPageNumber).find(".completed").length;
                let questionScores = [];

                if ($("#myViewStack").hasClass("viewstackMCQ")) {
                    $(".stackchild").each(function (index) {
                        let questionScore = 0;
                        $(this).find("input[type=radio]").each(function () {
                            if ($(this).hasClass("correct_choice") && $(this).is(":checked")) {
                                questionScore = 1;
                                correctAnswerCount++;
                            }
                        });
                        questionScores.push({ questionNumber: index + 1, score: questionScore });
                    });
                } else if ($("#myViewStack").hasClass("viewstackJumbled") || $("#myViewStack").hasClass("viewstackFIB") || $("#myViewStack").hasClass("viewstackSpelling")) {
                    for (let x = 0; x < currentQuestionObject.steps.length; x++) {
                        let questionScore = currentQuestionObject.steps[x].isCorrect ? 1 : 0;
                        correctAnswerCount += questionScore;
                        questionScores.push({ questionNumber: x + 1, score: questionScore });
                    }
                } else if ($("#myViewStack").hasClass("viewstackQA")) {
                    $(".stackchild").each(function (index) {
                        let questionScore = 0;
                        $(this).find("input[type=textarea]").each(function () {
                            if ($(this).hasClass("correct_choice") && $(this).val().trim() !== "") {
                                questionScore = 1;
                                correctAnswerCount++;
                            }
                        });
                        questionScores.push({ questionNumber: index + 1, score: questionScore });
                    });
                } else {
                    for (let x = 0; x < currentQuestionObject.steps.length; x++) {
                        let questionScore = currentQuestionObject.steps[x].isCorrect ? 1 : 0;
                        correctAnswerCount += questionScore;
                        questionScores.push({ questionNumber: x + 1, score: questionScore });
                    }
                }

                $("#scorecontainer h3").html("You scored " + correctAnswerCount + " / " + TotalnumberOfQuestion);
                $("#popupDialog").popup('open');

                // Function to convert timestamp to Indian format
                const formatDate = (date) => {
                    const day = String(date.getDate()).padStart(2, '0');
                    const month = String(date.getMonth() + 1).padStart(2, '0'); // Months are zero-indexed
                    const year = date.getFullYear();
                    return `${day}/${month}/${year}`;
                };

                const formatTime = (date) => {
                    return date.toLocaleTimeString('en-IN', { timeZone: 'Asia/Kolkata' });
                };

                const parseDuration = (duration) => {
                    const parts = duration.split(':').map(Number);
                    if (parts.length === 2) {
                        // MM:SS
                        return (parts[0] * 60 + parts[1]) * 1000;
                    }
                    return 0;
                };

                const calculateStartTime = (endTime, duration) => {
                    const endDate = new Date(endTime);
                    const durationMs = parseDuration(duration);
                    const startDate = new Date(endDate - durationMs);
                    return formatTime(startDate);
                };

                const currentDate = new Date();
                const duration = document.getElementById("globalClock").textContent; // Duration in MM:SS
                const endTime = currentDate.toLocaleString('en-IN', { timeZone: 'Asia/Kolkata' });
                const startTime = calculateStartTime(currentDate, duration);

                const userData = {
                    correctAnswers: correctAnswerCount,
                    totalQuestions: TotalnumberOfQuestion,
                    date: formatDate(currentDate), // Store date as DD/MM/YYYY
                    endTime: formatTime(currentDate), // Store end time in Indian format
                    startTime: startTime, // Calculate and store start time
                    duration: duration, // Duration from the global clock
                    activity: currentActivity, // Include the current activity
                    questionScores: questionScores // Array of question number and scores
                };

                // Reference to the Firestore document
                const userDocRef = firebase.firestore().collection('score').doc(userId);

                // Fetch the current document to update the array
                userDocRef.get().then((doc) => {
                    if (doc.exists) {
                        // Document exists, get the current array
                        const data = doc.data();
                        const scores = data.scores || []; // Default to an empty array if no scores field

                        // Append new score to the array
                        scores.push(userData);

                        // Update the document with the new array
                        userDocRef.set({ scores: scores })
                            .then(() => {
                                console.log("Data saved successfully!");
                            })
                            .catch((error) => {
                                console.error("Error saving data: ", error);
                            });
                    } else {
                        // Document does not exist, create it with the new array
                        userDocRef.set({
                            scores: [userData]
                        })
                            .then(() => {
                                console.log("Data saved successfully!");
                            })
                            .catch((error) => {
                                console.error("Error saving data: ", error);
                            });
                    }
                }).catch((error) => {
                    console.error("Error fetching document: ", error);
                });
            });



            $("#checkanswer").on("vclick", function (event) {
                /*Timer code*/

                mytimermin[pbi - 1] = myminute;
                mytimersec[pbi - 1] = mysec;
                $("#mytimerholder").html("LocalValue[" + pbi + "]=" + mytimermin[pbi - 1] + ":" + mytimersec[pbi - 1]);
                /*Timer end*/

                $("#myViewStack").addClass($('#myViewStack').attr('class'));

                if ($("#myViewStack").hasClass("viewstackMCQ")) {

                    $("#resultcontainer").show();
                    currentQuestionObject.isChecked = true;
                    var arrOptions = $("#stack" + currentPageNumber).find(".step_" + activeStepNo).find("input[type=radio]");
                    for (var k = 0; k < arrOptions.length; k++) {
                        rad_id = $(arrOptions[k]).attr("id");
                        $("#" + rad_id).removeClass("correct_choice");
                        $("#b" + rad_id).removeClass();
                        $("#b" + rad_id).addClass("regularBoxradio");
                        if ($("#" + rad_id).attr("id") == currentQuestionObject.checkedOptionId) {

                            if (($("#" + rad_id).attr("value") == $("#" + currentQuestionObject.checkedOptionId).attr("value")) && $("#" + rad_id).attr("value") == "true") {
                                $("#" + rad_id).addClass("correct_choice");
                                $("#b" + rad_id).addClass("CorrectBoxradio");
                                $("#b" + rad_id).removeClass("regularBoxradio");
                                $("#b" + rad_id).removeClass("wrongBoxradio");

                                CurrentInnerQuestion.isCorrect = true;
                                $("#rightAnswer").hide();

                                correctAnswerCount++;
                            }

                            else {
                                $("#b" + rad_id).addClass("wrongBoxradio");
                                $("#b" + rad_id).removeClass("regularBoxradio");
                                $("#b" + rad_id).removeClass("CorrectBoxradio");
                                CurrentInnerQuestion.isCorrect = false;

                                if ($('#showAnswer').is(":visible")) {
                                    $("#rightAnswer").hide();

                                }
                                else {
                                    if ($("#testmode").hasClass("ui-radio-on")) {
                                        $("#rightAnswer").hide();
                                    }
                                    else {
                                        $("#rightAnswer").show();
                                        $("#rightAnswer_mat").hide();

                                    }
                                }

                            }
                        }
                    }
                    correctAnswerCount = 0;

                    $(".stackchild").each(function () {
                        $(this).find("input[type=radio]").each(function () {
                            if ($(this).hasClass("correct_choice")) {
                                correctAnswerCount++;
                            }
                        });
                    });

                    $("#totScore").html(correctAnswerCount);
                    currentQuestionObject.isChecked = true;

                    //$("#rightAnswer").click(function (e) {
                    //    if ($("#myViewStack").hasClass("viewstackMCQ")) {

                    //        $("#rightAnswer").hide();
                    //        $("#showAnswer").show();
                    //        $("#dispalyAnswer").html("");
                    //        $("#dispalyAnswer").html("Correct Answer : " + currentQuestionObject.correctoption.replace(/#/g, " "));
                    //    }
                    //});

                }


                else if ($("#myViewStack").hasClass("viewstackJumbled")) {
                    // working

                    var w = currentQuestionObject.steps[activeStepNo - 1].correctAnswer.split("#");
                    var p = 0;
                    $("#stack" + currentPageNumber).find(".step_" + activeStepNo).find($("#sortableWords" + (activeStepNo - 1) + " > div > div > span ")).each(function () {
                        if (w[p] == $(this).text()) {
                            if ($(this).parent().parent().hasClass("regularBoxSmall")) {
                                $(this).parent().parent().removeClass("regularBoxSmall");
                                $(this).parent().parent().addClass("correctBoxSmall");
                            }
                            else if ($(this).parent().parent().hasClass("wrongBoxSmall")) {
                                $(this).parent().parent().removeClass("wrongBoxSmall");
                                $(this).parent().parent().addClass("correctBoxSmall");
                            }
                            else if ($(this).parent().parent().hasClass("regularBox")) {
                                $(this).parent().parent().removeClass("regularBox");
                                $(this).parent().parent().addClass("correctBox");
                            }
                            else if ($(this).parent().parent().hasClass("wrongBox")) {
                                $(this).parent().parent().removeClass("wrongBox");
                                $(this).parent().parent().addClass("correctBox");
                            }
                            else if ($(this).parent().parent().hasClass("regularBoxLarge")) {
                                $(this).parent().parent().removeClass("regularBoxLarge");
                                $(this).parent().parent().addClass("correctBoxLarge");
                            }
                            else if ($(this).parent().parent().hasClass("wrongBoxLarge")) {
                                $(this).parent().parent().removeClass("wrongBoxLarge");
                                $(this).parent().parent().addClass("correctBoxLarge");
                            }
                            else if ($(this).parent().parent().hasClass("correctBoxLarge")) {
                                $(this).parent().parent().removeClass("correctBoxLarge");
                                $(this).parent().parent().addClass("correctBoxLarge");
                            }
                            else if ($(this).parent().parent().hasClass("correctBox")) {
                                $(this).parent().parent().removeClass("correctBox");
                                $(this).parent().parent().addClass("correctBox");
                            }
                            else if ($(this).parent().parent().hasClass("correctBoxSmall")) {
                                $(this).parent().parent().removeClass("correctBoxSmall");
                                $(this).parent().parent().addClass("correctBoxSmall");
                            }
                        }

                        else {
                            if ($(this).parent().parent().hasClass("regularBoxSmall")) {
                                $(this).parent().parent().removeClass("regularBoxSmall");
                                $(this).parent().parent().addClass("wrongBoxSmall");
                            }
                            else if ($(this).parent().parent().hasClass("correctBoxSmall")) {
                                $(this).parent().parent().removeClass("correctBoxSmall");
                                $(this).parent().parent().addClass("wrongBoxSmall");
                            }
                            else if ($(this).parent().parent().hasClass("regularBox")) {
                                $(this).parent().parent().removeClass("regularBox");
                                $(this).parent().parent().addClass("wrongBox");
                            }
                            else if ($(this).parent().parent().hasClass("wrongBox")) {
                                $(this).parent().parent().removeClass("wrongBox");
                                $(this).parent().parent().addClass("wrongBox");
                            }
                            else if ($(this).parent().parent().hasClass("regularBoxLarge")) {
                                $(this).parent().parent().removeClass("regularBoxLarge");
                                $(this).parent().parent().addClass("wrongBoxLarge");
                            }
                            else if ($(this).parent().parent().hasClass("wrongBoxLarge")) {
                                $(this).parent().parent().removeClass("wrongBoxLarge");
                                $(this).parent().parent().addClass("wrongBoxLarge");
                            }
                            else if ($(this).parent().parent().hasClass("wrongBoxSmall")) {
                                $(this).parent().parent().removeClass("wrongBoxSmall");
                                $(this).parent().parent().addClass("wrongBoxSmall");
                            }
                            else if ($(this).parent().parent().hasClass("correctBoxLarge")) {
                                $(this).parent().parent().removeClass("correctBoxLarge");
                                $(this).parent().parent().addClass("wrongBoxLarge");
                            }
                            else if ($(this).parent().parent().hasClass("correctBox")) {
                                $(this).parent().parent().removeClass("correctBox");
                                $(this).parent().parent().addClass("wrongBox");
                            }

                        }
                        p++;

                    });

                    var correctFlag = false;
                    $("#stack" + currentPageNumber).find(".step_" + activeStepNo).find($("#sortableWords" + (activeStepNo - 1) + " > div > div > span ")).each(function () {
                        if ($(this).parent().parent().hasClass("correctBox") || $(this).parent().parent().hasClass("correctBoxLarge") || $(this).parent().parent().hasClass("correctBoxSmall")) {
                            correctFlag = true;
                        }
                        else {
                            correctFlag = false;
                            return false;

                        }

                    });

                    if (correctFlag) {

                        currentQuestionObject.steps[activeStepNo - 1].isCorrect = true;
                        $("#rightAnswer").hide();
                    }
                    else {
                        currentQuestionObject.steps[activeStepNo - 1].isCorrect = false;
                        if ($('#showAnswer').is(":visible")) {
                            $("#rightAnswer").hide();

                        }
                        else {
                            if ($("#testmode").hasClass("ui-radio-on")) {
                                $("#rightAnswer").hide();
                            }
                            else {
                                $("#rightAnswer").show();
                                $("#rightAnswer_mat").hide();

                            }
                        }
                    }

                    var correctAnswerCount = 0;

                    for (x = 0; x < currentQuestionObject.steps.length; x++) {

                        if (currentQuestionObject.steps[x].isCorrect == true) {
                            correctAnswerCount++;

                        }
                    }
                    var answer = currentQuestionObject.steps[activeStepNo - 1].correctAnswer.replace(/#/g, ' ');
                    $("#rightAnswer").click(function (e) {
                        if ($("#myViewStack").hasClass("viewstackJumbled")) {

                            $("#rightAnswer").hide();

                            $("#showAnswer").show();
                            $("#displayAnswer").html("Correct Answer : " + answer);
                        }
                    });
                    $("#totScore").html(correctAnswerCount);


                }

                else if ($("#myViewStack").hasClass("viewstackFIB")) {

                    currentQuestionObject = arrQuestionObjectsMaster[currentPageNumber];

                    var tempArrOptions = $("#stack" + currentPageNumber + " .step_" + (activeStepNo)).find("input[type = text]");

                    var answerCorrect = 0;
                    currentQuestionObject.inputValues = [];

                    for (var k = 0; k < tempArrOptions.length; k++) {
                        if (tempArrOptions[k].type == "text") {
                            currentQuestionObject.inputValues.push($(tempArrOptions[k]).val());

                            var lhs = $(tempArrOptions[k]).val().toLowerCase();
                            var rhs = $(tempArrOptions[k]).attr("data-value").toLowerCase().replace("~", "'");
                            if (lhs.trim() == rhs.trim()) {
                                if ($(tempArrOptions[k]).parent().parent().hasClass("regularBoxSmall")) {
                                    $(tempArrOptions[k]).parent().parent().removeClass("regularBoxSmall");
                                    $(tempArrOptions[k]).parent().parent().addClass("correctBoxSmall");
                                } else if ($(tempArrOptions[k]).parent().parent().hasClass("regularBox")) {
                                    $(tempArrOptions[k]).parent().parent().removeClass("regularBox");
                                    $(tempArrOptions[k]).parent().parent().addClass("correctBoxFib");
                                } else if ($(tempArrOptions[k]).parent().parent().hasClass("regularBoxLarge")) {
                                    $(tempArrOptions[k]).parent().parent().removeClass("regularBoxLarge");
                                    $(tempArrOptions[k]).parent().parent().addClass("correctBoxLarge");
                                } else if ($(tempArrOptions[k]).parent().parent().hasClass("wrongBoxSmall")) {
                                    $(tempArrOptions[k]).parent().parent().removeClass("wrongBoxSmall");
                                    $(tempArrOptions[k]).parent().parent().addClass("correctBoxSmall");
                                } else if ($(tempArrOptions[k]).parent().parent().hasClass("wrongBoxFib")) {
                                    $(tempArrOptions[k]).parent().parent().removeClass("wrongBoxFib");
                                    $(tempArrOptions[k]).parent().parent().addClass("correctBoxFib");
                                } else if ($(tempArrOptions[k]).parent().parent().hasClass("wrongBoxLarge")) {
                                    $(tempArrOptions[k]).parent().parent().removeClass("wrongBoxLarge");
                                    $(tempArrOptions[k]).parent().parent().addClass("correctBoxLarge");
                                } else if ($(tempArrOptions[k]).parent().parent().hasClass("correctBoxSmall")) {
                                    $(tempArrOptions[k]).parent().parent().removeClass("correctBoxSmall");
                                    $(tempArrOptions[k]).parent().parent().addClass("correctBoxSmall");
                                } else if ($(tempArrOptions[k]).parent().parent().hasClass("correctBox")) {
                                    $(tempArrOptions[k]).parent().parent().removeClass("correctBoxFib");
                                    $(tempArrOptions[k]).parent().parent().addClass("correctBoxFib");
                                } else if ($(tempArrOptions[k]).parent().parent().hasClass("correctBoxLarge")) {
                                    $(tempArrOptions[k]).parent().parent().removeClass("correctBoxLarge");
                                    $(tempArrOptions[k]).parent().parent().addClass("correctBoxLarge");
                                }
                            }
                            else {
                                if ($(tempArrOptions[k]).parent().parent().hasClass("regularBoxSmall")) {
                                    $(tempArrOptions[k]).parent().parent().removeClass("regularBoxSmall");
                                    $(tempArrOptions[k]).parent().parent().addClass("wrongBoxSmall");
                                } else if ($(tempArrOptions[k]).parent().parent().hasClass("regularBox")) {
                                    $(tempArrOptions[k]).parent().parent().removeClass("regularBox");
                                    $(tempArrOptions[k]).parent().parent().addClass("wrongBoxFib");
                                } else if ($(tempArrOptions[k]).parent().parent().hasClass("regularBoxLarge")) {
                                    $(tempArrOptions[k]).parent().parent().removeClass("regularBoxLarge");
                                    $(tempArrOptions[k]).parent().parent().addClass("wrongBoxLarge");
                                } else if ($(tempArrOptions[k]).parent().parent().hasClass("wrongBoxSmall")) {
                                    $(tempArrOptions[k]).parent().parent().removeClass("wrongBoxSmall");
                                    $(tempArrOptions[k]).parent().parent().addClass("wrongBoxSmall");
                                } else if ($(tempArrOptions[k]).parent().parent().hasClass("wrongBoxFib")) {
                                    $(tempArrOptions[k]).parent().parent().removeClass("wrongBoxFib");
                                    $(tempArrOptions[k]).parent().parent().addClass("wrongBoxFib");
                                } else if ($(tempArrOptions[k]).parent().parent().hasClass("wrongBoxLarge")) {
                                    $(tempArrOptions[k]).parent().parent().removeClass("wrongBoxLarge");
                                    $(tempArrOptions[k]).parent().parent().addClass("wrongBoxLarge");
                                } else if ($(tempArrOptions[k]).parent().parent().hasClass("correctBoxSmall")) {
                                    $(tempArrOptions[k]).parent().parent().removeClass("correctBoxSmall");
                                    $(tempArrOptions[k]).parent().parent().addClass("wrongBoxSmall");
                                } else if ($(tempArrOptions[k]).parent().parent().hasClass("correctBoxFib")) {
                                    $(tempArrOptions[k]).parent().parent().removeClass("correctBoxFib");
                                    $(tempArrOptions[k]).parent().parent().addClass("wrongBoxFib");
                                } else if ($(tempArrOptions[k]).parent().parent().hasClass("correctBoxLarge")) {
                                    $(tempArrOptions[k]).parent().parent().removeClass("correctBoxLarge");
                                    $(tempArrOptions[k]).parent().parent().addClass("wrongBoxLarge");
                                }
                            }
                        }
                    }


                    var correctFlag = false;
                    answer = "";
                    answer = currentQuestionObject.steps[activeStepNo - 1].displayText;
                    $("#rightAnswer").click(function () {
                        if ($("#myViewStack").hasClass("viewstackMCQ")) {

                            $("#rightAnswer").hide();
                            $("#showAnswer").show();
                            $("#dispalyAnswer").html("");
                            $("#dispalyAnswer").html("Correct Answer : " + currentQuestionObject.correctoption.replace(/#/g, " "));
                        }
                        else {
                            $("#displayAnswer").html("Correct Answer : " + answer);
                        }

                    });

                    $("#stack" + currentPageNumber + " .step_" + (activeStepNo)).find("input[type = text]").each(function () {
                        if ($(this).parent().parent().hasClass("correctBoxFib") || $(this).parent().parent().hasClass("correctBoxLarge") || $(this).parent().parent().hasClass("correctBoxSmall")) {
                            correctFlag = true;
                        }
                        else {
                            correctFlag = false;
                            return false;
                        }
                    });
                    if (correctFlag) {

                        currentQuestionObject.steps[activeStepNo - 1].isCorrect = true;
                        $("#rightAnswer").hide();
                    }
                    else {
                        currentQuestionObject.steps[activeStepNo - 1].isCorrect = false;
                        if ($('#showAnswer').is(":visible")) {
                            $("#rightAnswer").hide();

                        }
                        else {
                            if ($("#testmode").hasClass("ui-radio-on")) {
                                $("#rightAnswer").hide();
                            }
                            else {
                                $("#rightAnswer").show();
                                $("#rightAnswer_mat").hide();

                            }
                        }
                    }

                    var correctAnswerCount = 0;

                    for (x = 0; x < currentQuestionObject.steps.length; x++) {

                        if (currentQuestionObject.steps[x].isCorrect == true) {
                            correctAnswerCount++;

                        }
                    }
                    $("#totScore").html(correctAnswerCount);
                    answer = currentQuestionObject.steps[activeStepNo - 1].correctAnswer.replace(/#/g, ' ');
                    $("#rightAnswer").click(function (e) {
                        if ($("#myViewStack").hasClass("viewstackFIB")) {
                            $("#rightAnswer").hide();

                            $("#showAnswer").show();
                            $("#displayAnswer").html("Correct Answer : " + answer);
                        }

                    });


                }

                else if ($("#myViewStack").hasClass("viewstackSpelling")) {

                    $("#rightAnswer").hide();
                    currentQuestionObject = arrQuestionObjectsMaster[currentPageNumber];
                    var tempArrOptions = $("#stack" + currentPageNumber + " .step_" + activeStepNo).find("input[type = text]");
                    var answerCorrect = 0;
                    currentQuestionObject.inputValues = [];

                    for (var k = 0; k < tempArrOptions.length; k++) {
                        if (tempArrOptions[k].type == "text") {
                            currentQuestionObject.inputValues.push($(tempArrOptions[k]).val());
                            var lhs = $(tempArrOptions[k]).val().toLowerCase();
                            var rhs = $(tempArrOptions[k]).attr("data-value").toLowerCase().replace("~", "'");
                            if (lhs.trim() == rhs.trim()) {
                                if ($(tempArrOptions[k]).parent().parent().hasClass("regularBoxSmall")) {
                                    $(tempArrOptions[k]).parent().parent().removeClass("regularBoxSmall");
                                    $(tempArrOptions[k]).parent().parent().addClass("correctBoxSmall");
                                } else if ($(tempArrOptions[k]).parent().parent().hasClass("regularBox")) {
                                    $(tempArrOptions[k]).parent().parent().removeClass("regularBox");
                                    $(tempArrOptions[k]).parent().parent().addClass("correctBoxFib");
                                } else if ($(tempArrOptions[k]).parent().parent().hasClass("regularBoxLarge")) {
                                    $(tempArrOptions[k]).parent().parent().removeClass("regularBoxLarge");
                                    $(tempArrOptions[k]).parent().parent().addClass("correctBoxLarge");
                                } else if ($(tempArrOptions[k]).parent().parent().hasClass("wrongBoxSmall")) {
                                    $(tempArrOptions[k]).parent().parent().removeClass("wrongBoxSmall");
                                    $(tempArrOptions[k]).parent().parent().addClass("correctBoxSmall");
                                } else if ($(tempArrOptions[k]).parent().parent().hasClass("wrongBoxFib")) {
                                    $(tempArrOptions[k]).parent().parent().removeClass("wrongBoxFib");
                                    $(tempArrOptions[k]).parent().parent().addClass("correctBoxFib");
                                } else if ($(tempArrOptions[k]).parent().parent().hasClass("wrongBoxLarge")) {
                                    $(tempArrOptions[k]).parent().parent().removeClass("wrongBoxLarge");
                                    $(tempArrOptions[k]).parent().parent().addClass("correctBoxLarge");
                                } else if ($(tempArrOptions[k]).parent().parent().hasClass("correctBoxSmall")) {
                                    $(tempArrOptions[k]).parent().parent().removeClass("correctBoxSmall");
                                    $(tempArrOptions[k]).parent().parent().addClass("correctBoxSmall");
                                } else if ($(tempArrOptions[k]).parent().parent().hasClass("correctBox")) {
                                    $(tempArrOptions[k]).parent().parent().removeClass("correctBoxFib");
                                    $(tempArrOptions[k]).parent().parent().addClass("correctBoxFib");
                                } else if ($(tempArrOptions[k]).parent().parent().hasClass("correctBoxLarge")) {
                                    $(tempArrOptions[k]).parent().parent().removeClass("correctBoxLarge");
                                    $(tempArrOptions[k]).parent().parent().addClass("correctBoxLarge");
                                }
                            }
                            else {
                                if ($(tempArrOptions[k]).parent().parent().hasClass("regularBoxSmall")) {
                                    $(tempArrOptions[k]).parent().parent().removeClass("regularBoxSmall");
                                    $(tempArrOptions[k]).parent().parent().addClass("wrongBoxSmall");
                                } else if ($(tempArrOptions[k]).parent().parent().hasClass("regularBox")) {
                                    $(tempArrOptions[k]).parent().parent().removeClass("regularBox");
                                    $(tempArrOptions[k]).parent().parent().addClass("wrongBoxFib");
                                } else if ($(tempArrOptions[k]).parent().parent().hasClass("regularBoxLarge")) {
                                    $(tempArrOptions[k]).parent().parent().removeClass("regularBoxLarge");
                                    $(tempArrOptions[k]).parent().parent().addClass("wrongBoxLarge");
                                } else if ($(tempArrOptions[k]).parent().parent().hasClass("wrongBoxSmall")) {
                                    $(tempArrOptions[k]).parent().parent().removeClass("wrongBoxSmall");
                                    $(tempArrOptions[k]).parent().parent().addClass("wrongBoxSmall");
                                } else if ($(tempArrOptions[k]).parent().parent().hasClass("wrongBoxFib")) {
                                    $(tempArrOptions[k]).parent().parent().removeClass("wrongBoxFib");
                                    $(tempArrOptions[k]).parent().parent().addClass("wrongBoxFib");
                                } else if ($(tempArrOptions[k]).parent().parent().hasClass("wrongBoxLarge")) {
                                    $(tempArrOptions[k]).parent().parent().removeClass("wrongBoxLarge");
                                    $(tempArrOptions[k]).parent().parent().addClass("wrongBoxLarge");
                                } else if ($(tempArrOptions[k]).parent().parent().hasClass("correctBoxSmall")) {
                                    $(tempArrOptions[k]).parent().parent().removeClass("correctBoxSmall");
                                    $(tempArrOptions[k]).parent().parent().addClass("wrongBoxSmall");
                                } else if ($(tempArrOptions[k]).parent().parent().hasClass("correctBoxFib")) {
                                    $(tempArrOptions[k]).parent().parent().removeClass("correctBoxFib");
                                    $(tempArrOptions[k]).parent().parent().addClass("wrongBoxFib");
                                } else if ($(tempArrOptions[k]).parent().parent().hasClass("correctBoxLarge")) {
                                    $(tempArrOptions[k]).parent().parent().removeClass("correctBoxLarge");
                                    $(tempArrOptions[k]).parent().parent().addClass("wrongBoxLarge");
                                }
                            }
                        }
                    }

                    var correctFlag = false;
                    for (var k = 1; k < tempArrOptions.length; k++) {
                        if (tempArrOptions[k].type == "text") {
                            if ($(tempArrOptions[k]).parent().parent().hasClass("correctBoxFib") || $(tempArrOptions[k]).parent().parent().hasClass("correctBoxLarge") || $(tempArrOptions[k]).parent().parent().hasClass("correctBoxSmall")) {
                                correctFlag = true;
                            }
                            else {
                                correctFlag = false;
                                break;
                            }
                        }
                    }

                    $("#rightAnswer").hide();
                    if (correctFlag) {

                        currentQuestionObject.steps[activeStepNo - 1].isCorrect = true;

                        $("#rightAnswer").hide();



                    }

                    else {
                        currentQuestionObject.steps[activeStepNo - 1].isCorrect = false;
                        if ($("#showAnswer").is(":visible")) {
                            $("#rightAnswer").hide();

                        }
                        else {
                            if ($("#testmode").hasClass("ui-radio-on")) {
                                $("#rightAnswer").hide();

                            }
                            else {
                                if ($("#testmode").hasClass("ui-radio-on")) {
                                    $("#rightAnswer").hide();
                                }
                                else {
                                    $("#rightAnswer").show();
                                    $("#rightAnswer_mat").hide();

                                }

                            }

                        }
                    }

                    var correctAnswerCount = 0;
                    for (x = 0; x < currentQuestionObject.steps.length; x++) {

                        if (currentQuestionObject.steps[x].isCorrect == true) {
                            correctAnswerCount++;
                        }
                    }
                    $("#totScore").html(correctAnswerCount);

                    currentQuestionObject.steps[activeStepNo - 1].isChecked = true;
                    answer = currentQuestionObject.steps[activeStepNo - 1].correctAnswer;
                    $("#rightAnswer").click(function () {
                        if ($("#myViewStack").hasClass("viewstackSpelling")) {

                            $("#displayAnswer").html("Correct Answer : " + answer);
                        }
                    });


                }

                else if ($("#myViewStack").hasClass("viewstackQA")) {

                    currentQuestionObject = arrQuestionObjectsMaster[currentPageNumber];
                    var textareaValue = $("#textarea").val().toLowerCase().trim();
                    var tempArrOptions = $("#stack" + currentPageNumber).find(".step_" + activeStepNo).find("input[type=textarea]");

                    var answer = currentQuestionObject.steps[activeStepNo - 1].correctoption.toLowerCase();
                    for (var k = 0; k < tempArrOptions.length; k++) {
                        $(tempArrOptions).removeClass("correct_choice");
                        if (tempArrOptions[k].type == "text") {
                            var typedAnswer = $(tempArrOptions[k]).val().toLowerCase();
                            if (answer.trim() === typedAnswer.trim()) {
                                $("#rightAnswer").hide();
                                $("#showAnswer").hide();
                                $(tempArrOptions[k]).addClass("correct_choice");
                                if ($(tempArrOptions[k]).parent().parent().hasClass("regularBoxArea")) {
                                    $(tempArrOptions[k]).parent().parent().removeClass("regularBoxArea");
                                    $(tempArrOptions[k]).parent().parent().addClass("correctBoxArea");
                                }
                                else if ($(tempArrOptions[k]).parent().parent().hasClass("wrongBoxArea")) {
                                    $(tempArrOptions[k]).parent().parent().removeClass("wrongBoxArea");
                                    $(tempArrOptions[k]).parent().parent().addClass("correctBoxArea");
                                }

                            }
                            else {
                                if ($('#showAnswer').is(":visible")) {
                                    $("#rightAnswer").hide();

                                }
                                else {
                                    $("#rightAnswer").show();
                                }
                                if ($(tempArrOptions[k]).parent().parent().hasClass("regularBoxArea")) {

                                    $(tempArrOptions[k]).parent().parent().removeClass("regularBoxArea");
                                    $(tempArrOptions[k]).parent().parent().addClass("wrongBoxArea");
                                }
                                else if ($(tempArrOptions[k]).parent().parent().hasClass("correctBoxArea")) {
                                    $(tempArrOptions[k]).parent().parent().removeClass("correctBoxArea");
                                    $(tempArrOptions[k]).parent().parent().addClass("wrongBoxArea");
                                }


                            }
                        }
                    }
                    correctAnswerCount = 0;

                    $(".stackchild").each(function () {
                        $(this).find("input[type = textarea]").each(function () {
                            if ($(this).hasClass("correct_choice")) {
                                correctAnswerCount++;
                            }
                        });
                    });

                    $("#totScore").html(correctAnswerCount);
                    answer = currentQuestionObject.steps[activeStepNo - 1].correctoption;
                    $("#rightAnswer").click(function () {
                        if ($("#myViewStack").hasClass("viewstackQA")) {
                            $("#showAnswer").show();

                            $("#displayAnswer").html("Correct Answer : " + answer);
                        }
                    });
                }
                //Check function for match the following
                else {

                    currentQuestionObject = arrQuestionObjectsMaster[currentPageNumber];

                    var tempArrPremise = $("#stack" + currentPageNumber).find(".step_" + activeStepNo).find(".sortablepremise");
                    var tempArrResponse = $("#stack" + currentPageNumber).find(".step_" + activeStepNo).find(".sortableresponse");
                    var answerCorrect = 0;
                    for (var k = 0; k < tempArrPremise.length; k++) {
                        var answered = $(tempArrResponse[k]).text();
                        var original = $(tempArrPremise[k]).attr("data-menu-value");
                        if (answered == original) {
                            if ($(tempArrResponse[k]).hasClass("response")) {
                                $(tempArrResponse[k]).removeClass("response");
                                $(tempArrResponse[k]).addClass("responseCorrect");
                            } else if ($(tempArrResponse[k]).hasClass("responseWrong")) {
                                $(tempArrResponse[k]).removeClass("responseWrong");
                                $(tempArrResponse[k]).addClass("responseCorrect");
                            }
                        }
                        else {
                            if ($(tempArrResponse[k]).hasClass("response")) {
                                $(tempArrResponse[k]).removeClass("response");
                                $(tempArrResponse[k]).addClass("responseWrong");
                            } else if ($(tempArrResponse[k]).hasClass("responseCorrect")) {
                                $(tempArrResponse[k]).removeClass("responseCorrect");
                                $(tempArrResponse[k]).addClass("responseWrong");
                            }

                        }
                    }

                    var correctFlag = false;
                    for (var k = 0; k < tempArrPremise.length; k++) {
                        if ($(tempArrResponse[k]).hasClass("responseCorrect")) {
                            correctFlag = true;
                        }

                        else {
                            correctFlag = false;
                            break;
                        }
                    }

                    if (correctFlag) {
                        currentQuestionObject.steps[activeStepNo - 1].isCorrect = true;
                        $("#rightAnswer").hide();
                        $("#rightAnswer_mat").hide();
                        answerCorrect++;
                    }

                    else {
                        currentQuestionObject.steps[activeStepNo - 1].isCorrect = false;
                        if ($("#showAnswer").is(":visible")) {
                            $("#rightAnswer").hide();
                            $("#rightAnswer_mat").hide();
                        }

                        else {
                            if ($("#testmode").hasClass("ui-radio-on")) {
                                $("#rightAnswer").hide();
                                $("#rightAnswer_mat").hide();
                            }
                            else {
                                $("#rightAnswer").hide();
                                $("#rightAnswer_mat").show();

                            }

                        }
                    }
                    var correctAnswerCount = 0;
                    for (x = 0; x < currentQuestionObject.steps.length; x++) {
                        if (currentQuestionObject.steps[x].isCorrect == true) {
                            correctAnswerCount++;
                        }
                    }
                    $("#totScore").html(correctAnswerCount);

                }


                $("#rightAnswer_mat").click(function (e) {

                    $("#showAnswer").show();
                    $("#stackContainer").hide();
                    $("#stackContainer").hide();

                    buildCorrectAnswer(currentPageNumber);
                    $(".steps > .active").removeClass("active");
                    $(".wizard > .steps-content > .active").removeClass("active");
                    $("." + activeStepNo).addClass("active");
                    $("#correctAnswerContainer").show();
                    /* back button for question mat*/
                    $(".steps-index-container").css("opacity", "0.2");
                    $(".steps-index-container").css("pointer-events", "none");
                    /* back button for question mat*/

                });
                $("#showAnswer").click(function (e) {

                    $("#showAnswer").hide();
                });
            });

            $("#showAnswer").click(function (e) {
                $("#rightAnswer").show();

                $("#showAnswer").hide();
            });

            //For diffrent modes start
            $("#teachmode").on("vclick", function () {
                $("#insidecontainer").hide();
                $("#noContent").hide();

                $("#videocontainer").show();
                var vid = document.getElementById("PlayVideo");

                vid.currentTime = 0;


                $("#noContent").hide();
                $("#light-pagination").addClass("disableddiv");

                $("#scoretime").addClass("disableddiv");
                $(".completeCourseSection").addClass("disableddiv");
                $(".bloom_pyramid").addClass("disableddiv");;
                $("#sidestages").addClass("disableddiv");
                $("#DivMainContent").css("display", "block");
                $("#DivMainContent").css("text-align", "center");
                $("#DivMainContent").css("background-color", "#FEFDD1");
                mysecGlobal = 0;
                myminuteGlobal = 0;

                if (countMode == 1) {
                    timerGlobal();
                    countGlobal = 0;
                    countMode = 0;
                }

            })
            $("#practicemode").on("vclick", function () {
                var vid = document.getElementById("PlayVideo");
                vid.pause();
                $("#totScore").html(0);
                $("#videocontainer").hide();
                $("#insidecontainer").show();
                $("#light-pagination").removeClass("disableddiv");

                $("#scoretime").removeClass("disableddiv");
                $(".completeCourseSection").removeClass("disableddiv");
                $(".bloom_pyramid").removeClass("disableddiv");;
                $("#sidestages").removeClass("disableddiv");
                $("#checkanswer").css("opacity", "1");
                $("#checkanswer").css("pointer-events", "painted");
                $("#cmpltactivity").css("opacity", "1");
                $("#cmpltactivity").css("pointer-events", "painted");
                $("#correctAnswerContainer").css("display", "none");
                $("#stackContainer").css("display", "block");
                $("#backtohome").css("display", "none");
                $("#DivMainContent").css("display", "block");
                $("#noContent").css("display", "none");
                $("#checkanswer").css("display", "block");
                $("#DivMainContent").css("background-color", "#fff");
                $("#DivMainContent").css("text-align", "left");
                $("#totScore").removeClass("disableddiv");
                $("#correctAnswerContainer").css("display", "none");
                $("#stackContainer").css("display", "block");
                $("#backtohome").css("display", "none");
                $("#checkanswer").css("display", "block");
                currentPageNumber = 0;
                activeStepNo = $("#stack" + currentPageNumber).find('.steps > li').attr('data-step');
                if (audioFile != undefined) {
                    audioFile.pause();
                    audioFile.currentTime = 0;
                }

                $("#checkanswer").css("display", "none");
                buildContentLoad(0, "P");
                mysecGlobal = 0;
                myminuteGlobal = 0;

                if (countMode == 1) {
                    timerGlobal();
                    countGlobal = 0;
                    countMode = 0;
                }


            })
            $("#testmode").on("vclick", function () {
                var vid = document.getElementById("PlayVideo");
                vid.pause();
                $("#totScore").html(0);
                $("#videocontainer").hide();
                $("#insidecontainer").show();
                $("#checkanswer").css("opacity", "1");
                $("#checkanswer").css("pointer-events", "painted");
                $("#cmpltactivity").css("opacity", "1");
                $("#cmpltactivity").css("pointer-events", "painted");
                $("#rightAnswer").hide();
                $("#light-pagination").removeClass("disableddiv");

                $("#scoretime").removeClass("disableddiv");
                $(".completeCourseSection").removeClass("disableddiv");
                $(".bloom_pyramid").removeClass("disableddiv");;
                $("#sidestages").removeClass("disableddiv");
                $("#DivMainContent").css("background-color", "#fff");
                $("#DivMainContent").css("text-align", "left");
                $("#DivMainContent").css("display", "block");
                $("#noContent").css("display", "none");
                $("#totScore").removeClass("disableddiv");
                $("#correctAnswerContainer").css("display", "none");
                $("#stackContainer").css("display", "block");
                $("#backtohome").css("display", "none");
                $("#checkanswer").css("display", "block");
                $("#correctAnswerContainer").css("display", "none");
                $("#stackContainer").css("display", "block");
                $("#backtohome").css("display", "none");
                $("#checkanswer").css("display", "block");

                activeStepNo = $("#stack" + currentPageNumber).find('.steps > li').attr('data-step');
                if (audioFile != undefined) {
                    audioFile.pause();
                    audioFile.currentTime = 0;
                }

                $("#checkanswer").css("display", "none");
                currentPageNumber = 0;
                buildContentLoad(0, "T");
                mysecGlobal = 0;
                myminuteGlobal = 0;

                if (countMode == 1) {
                    timerGlobal();
                    countGlobal = 0;
                    countMode = 0;
                }


            })
            InitializeThemes();
            $("#learnmode").on("vclick", function () {

                var vid = document.getElementById("PlayVideo");
                vid.pause();
                $("#totScore").html(0);
                $("#videocontainer").hide();
                $("#insidecontainer").show();
                $("#light-pagination").removeClass("disableddiv");

                $("#scoretime").removeClass("disableddiv");
                $("#checkanswer").css("opacity", "0.2");
                $("#checkanswer").css("pointer-events", "none");
                $("#cmpltactivity").css("opacity", "0.2");
                $("#cmpltactivity").css("pointer-events", "none");
                $(".completeCourseSection").removeClass("disableddiv");
                $(".bloom_pyramid").removeClass("disableddiv");
                $("#DivMainContent").css("display", "block");
                $("#noContent").css("display", "none");
                $("#sidestages").removeClass("disableddiv");
                $("#DivMainContent").css("background-color", "#fff");
                $("#DivMainContent").css("text-align", "left");
                $("#totScore").addClass("disableddiv");
                $("#correctAnswerContainer").css("display", "none");
                $("#stackContainer").css("display", "block");
                $("#backtohome").css("display", "none");
                $("#checkanswer").css("display", "block");
                $("#correctAnswerContainer").css("display", "none");
                $("#stackContainer").css("display", "block");
                $("#backtohome").css("display", "none");
                $("#checkanswer").css("display", "block");
                activeStepNo = $("#stack" + currentPageNumber).find('.steps > li').attr('data-step');
                if (audioFile != undefined) {
                    audioFile.pause();
                    audioFile.currentTime = 0;
                }

                var vid = document.getElementById("PlayVideo");
                if (vid != null || vid != undefined) {
                    vid.pause();
                }
                if (audioFile != undefined) {
                    audioFile.pause();
                    audioFile.currentTime = 0;
                }
                $("#checkanswer").css("display", "none");
                buildContentLoad(0, "L");
                mysecGlobal = 0;
                myminuteGlobal = 0;

                if (countMode == 1) {
                    timerGlobal();
                    countGlobal = 0;
                    countMode = 0;
                }
            })

            //For diffrent modes end

            $("#rightAnswer").click(function (e) {
                $("#rightAnswer").hide();

                $("#showAnswer").show();
                var questionsToCheck = $("#stack" + currentPageNumber).find(".step_" + activeStepNo).find("label");
                for (var k = 0; k < questionsToCheck.length; k++) {
                    var labelid = $(questionsToCheck[k]).attr("id");
                    var isCorrectValue = $("#" + labelid).attr("dataiscrct");
                    if (isCorrectValue == "true") {
                        var CorrectAnswer = $("#" + labelid).html();
                    }
                }
                $("#displayAnswer").html("Correct Answer : " + CorrectAnswer);

            });

            $(".stage-class").tooltip({
                position: {
                    my: "center bottom-20",
                    at: "center top",
                    using: function (position, feedback) {
                        $(this).css(position);
                        $("<div>")
                            .addClass("arrow")
                            .addClass(feedback.vertical)
                            .addClass(feedback.horizontal)
                            .appendTo(this);
                    }
                }
            });



            $(document).tooltip({
                position: {
                    my: "center bottom-20",
                    at: "center top",
                    using: function (position, feedback) {
                        $(this).css(position);
                        var tooltip = $(this);
                        $("<div>")
                            .addClass("arrow")
                            .addClass(feedback.vertical)
                            .addClass(feedback.horizontal)
                            .appendTo(this);

                        var width = $(window).width();
                        if (width <= 1024) {
                            setTimeout(function () {
                                tooltip.css("visibility", "hidden");
                            }, 2000);
                        }
                    }
                }


            });



            $(".hoverWord").tooltip({
                position: {
                    my: "center bottom-20",
                    at: "center top",
                    using: function (position, feedback) {
                        $(this).css(position);
                        $("<div>")
                            .addClass("arrow")
                            .addClass(feedback.vertical)
                            .addClass(feedback.horizontal)
                            .appendTo(this);
                    }
                }
            });

            $(".stages").removeAttr("href");

            initPaginator();
            $(".prev").addClass("ui-disabled");

            $(".top-actions").hide();


        });

        var width = $(window).width();
        if (width <= 1024) {

        }


        function jumbleWord(str) {
            var a = str.split(""),
                n = a.length;

            for (var i = n - 1; i > 0; i--) {
                var j = Math.floor(Math.random() * (i + 1));
                var tmp = a[i];
                a[i] = a[j];
                a[j] = tmp;
            }
            return a.join("");
        }
        function imagePopup() {

            var imagePath = $("#stack" + currentPageNumber).find("img").attr("src");
            $(".zoomedImage").attr("src", imagePath);
            $("#ImagePopup").popup('open');
        }



        function initPaginator() {

            $("#light-pagination").pagination({
                items: arrActivities.length,
                itemsOnPage: 1,
                displayedPages: 3,
                pages: arrActivities.length,
                prevText: "<",
                nextText: ">",
                cssStyle: 'light-theme',
                onPageClick: function (pageNumber, event) {

                    var count = $("#passage" + (currentPageNumber - 1)).text().replace(/[^\w ]/g, "").split(/\s+/).length;
                    if (count > 70) {
                        var innerText = "";
                        innerText = $("#passage" + (currentPageNumber - 1)).html();
                        var trimmedContent = "";
                        trimmedContent = innerText.split(/\s+/).slice(0, 69).join(" ");
                        $("#passage" + (pageNumber - 1)).html(trimmedContent).append(".....");
                    }


                    activeStepNo = 1;

                    if (audioFile != undefined) {
                        audioFile.pause();
                        audioFile.currentTime = 0;
                    }
                    incrementCount = -1;
                    $pageid = pageNumber;
                    $(".container-fluid").css("display", "none");
                    currentPageNumber = pageNumber - 1;

                    $("#myViewStack").viewstack("option", "selectedIndex", currentPageNumber);

                    if (pageNumber == arrActivities.length)
                        $(".next").addClass("ui-disabled");
                    else
                        $(".next").removeClass("ui-disabled");

                    if (pageNumber == 1)
                        $(".prev").addClass("ui-disabled");
                    else
                        $(".prev").removeClass("ui-disabled");
                    currentQuestionObject = arrActivities[currentPageNumber];
                    InitializeThemes();

                    LoadAudio(currentPageNumber);
                    buildBloomsTaxonomy(currentPageNumber);
                    var pageid = $("#stack" + currentPageNumber).attr("group-id");

                    EnableLearnMode(pageid);
                    var width = $(window).width();
                    if (width <= 1024) {

                        audioFile.play();

                        $("#pauseContainer").css("display", "block");
                        $("#playContainer").css("display", "none");
                        audioFile.addEventListener('ended', function () {
                            $("#pauseContainer").css("display", "none");
                            $("#playContainer").css("display", "block");
                        });

                    }

                    $(".hoverWord").on("mouseover", function () {

                        $(this).addClass("currentword");

                        titletext = $("span.currentword").next().text();
                        $(".currentword").attr("title", titletext);

                        $(this).removeClass("currentword");
                    });
                }

            });
            $(".prev").addClass("ui-disabled");
        }

        function EnableLearnMode(pageid) {
            $(menuData).find("menuitem").each(function () {
                $(this).find("menuitem").each(function () {

                    if ($(this).attr("PassageGroupId") == pageid) {
                        if ($(this).attr("learn") == "no") {
                            $("#learnmode").addClass("disableddiv");
                            $("#radio-choice-h-2b").css("display", "none");
                        }
                        else {
                            $("#learnmode").removeClass("disableddiv");
                            $("#radio-choice-h-2b").css("display", "block");
                        }

                    }
                });
            });
        }

        function getContentJumbled(PassageId, type, PageNumber, mode) {
            activeStepNo = 1;
            $("#stackContainer").empty();
            arrActivities = [];
            arrQuestionObjectsMaster = [];
            $(contentData).find("Passage").each(function () {

                if ($(this).is('[Stage]')) {
                    if ($(this).attr("Stage") == currentStage.toString()) {
                        var currentQuestionObject = [];
                        currentQuestionObject.id = $(this).attr("id");
                        currentQuestionObject.desc = $(this).attr("desc");

                        currentQuestionObject.pictureSource = contentImagesPath + $(this).attr("img");
                        currentQuestionObject.foundationGroupId = $(this).attr("PassageGroupId");
                        currentQuestionObject.PassageTitle = $(this).attr("Passagetitle");
                        currentQuestionObject.SoundFile = SoundFilePath + $(this).attr("AudioSource");
                        currentQuestionObject.useIn = $(this).attr("Use");
                        currentQuestionObject.bloomsTaxonomy = $(this).attr("BloomsTaxonomy").split(",");

                        var arrSteps = [];
                        var head;
                        if (PassageId == currentQuestionObject.id) {
                            $(this).find("activity").each(function () {
                                if ($(this).attr("impType") == type) {

                                    head = $(this).attr("headerText");
                                    $(this).find("question").each(function () {
                                        var objQuestion = [];
                                        objQuestion.id = $(this).attr("id");
                                        objQuestion.correctAnswer = $(this).attr("correctOption");

                                        objQuestion.head = head;

                                        objQuestion.isCorrect = false;
                                        objQuestion.bloomsTaxonomy = [];
                                        if ($(this).is('[BloomsTaxonomy]')) {
                                            objQuestion.bloomsTaxonomy = $(this).attr("BloomsTaxonomy").split(",");
                                        }
                                        // Push the Question Object into the Question Object array

                                        arrSteps.push(objQuestion);

                                    });
                                }
                            });
                        }

                        currentQuestionObject.steps = arrSteps;
                        arrQuestionObjectsMaster.push(currentQuestionObject);
                    }
                }
            });

            buildContentJumbled(PageNumber, mode);
        }


        function getContentQA(PassageId, type, PageNumber, mode) {
            activeStepNo = 1;
            $("#stackContainer").empty();
            arrActivities = [];
            arrQuestionObjectsMaster = [];

            $(contentData).find("Passage").each(function () {

                if ($(this).is('[Stage]')) {
                    if ($(this).attr("Stage") == currentStage.toString()) {

                        var currentQuestionObject = [];
                        currentQuestionObject.id = $(this).attr("id");
                        currentQuestionObject.desc = $(this).attr("desc");

                        currentQuestionObject.pictureSource = contentImagesPath + $(this).attr("img");
                        currentQuestionObject.foundationGroupId = $(this).attr("PassageGroupId");
                        currentQuestionObject.PassageTitle = $(this).attr("Passagetitle");
                        currentQuestionObject.SoundFile = SoundFilePath + $(this).attr("AudioSource");
                        currentQuestionObject.useIn = $(this).attr("Use");
                        currentQuestionObject.bloomsTaxonomy = $(this).attr("BloomsTaxonomy").split(",");
                        var arrStep = [];
                        var head;
                        if (PassageId == currentQuestionObject.id) {
                            $(this).find("activity").each(function () {
                                if ($(this).attr("impType") == type) {
                                    head = $(this).attr("headerText");
                                    $(this).find("question").each(function () {
                                        var objStep = [];
                                        objStep.id = $(this).attr("id");
                                        objStep.displayText = $(this).attr("desc");

                                        objStep.isCorrect = false;
                                        objStep.correctoption = $(this).attr("correctoption");
                                        objStep.head = head;
                                        arrStep.push(objStep);
                                    });
                                }
                            });
                        }
                        currentQuestionObject.steps = arrStep;
                        arrQuestionObjectsMaster.push(currentQuestionObject);
                    }
                }

            });

            buildContentQA(PageNumber, mode);
        }


        function getContentSpelling(PassageId, type, PageNumber, mode) {
            $("#stackContainer").empty();
            arrActivities = [];
            arrQuestionObjectsMaster = [];

            $(contentData).find("Passage").each(function () {
                if ($(this).is('[Stage]')) {
                    if ($(this).attr("Stage") == currentStage.toString()) {
                        var currentQuestionObject = [];
                        currentQuestionObject.id = $(this).attr("id");
                        currentQuestionObject.desc = $(this).attr("desc");

                        currentQuestionObject.pictureSource = contentImagesPath + $(this).attr("img");
                        currentQuestionObject.foundationGroupId = $(this).attr("PassageGroupId");
                        currentQuestionObject.useIn = $(this).attr("Use");
                        currentQuestionObject.PassageTitle = $(this).attr("Passagetitle");
                        currentQuestionObject.SoundFile = SoundFilePath + $(this).attr("AudioSource");
                        currentQuestionObject.bloomsTaxonomy = $(this).attr("BloomsTaxonomy").split(",");
                        var arrSteps = [];
                        var head;
                        if (PassageId == currentQuestionObject.id) {
                            $(this).find("activity").each(function () {
                                if ($(this).attr("impType") == type) {
                                    head = $(this).attr("headerText");
                                    var objStep = {};
                                    objStep.id = $(this).attr("id");
                                    objStep.correctAnswer = $(this).attr("correctoption");
                                    objStep.head = head;
                                    objStep.wordPositions = $(this).attr("wordpositions");
                                    objStep.currentState = "";
                                    objStep.inputValues = [];
                                    objStep.optionOrder = [];
                                    objStep.isChecked = false;
                                    objStep.isCorrect = false;
                                    objStep.checkedOptionId = "";
                                    arrSteps.push(objStep);
                                }

                            });
                        }
                        currentQuestionObject.steps = arrSteps;
                        arrQuestionObjectsMaster.push(currentQuestionObject);

                    }

                }
            });

            buildContentSpelling(PageNumber, mode);
        }


        function getContent(type) {
            $("#stackContainer").empty();
            arrActivities = [];
            arrQuestionObjectsMaster = [];
            $(contentData).find("Passage").each(function () {

                if ($(this).is('[Stage]')) {
                    if ($(this).attr("Stage") == currentStage.toString()) {

                        var currentQuestionObject = [];
                        currentQuestionObject.id = $(this).attr("id");
                        currentQuestionObject.desc = $(this).attr("desc");

                        currentQuestionObject.pictureSource = contentImagesPath + $(this).attr("img");
                        currentQuestionObject.foundationGroupId = $(this).attr("PassageGroupId");
                        currentQuestionObject.PassageTitle = $(this).attr("Passagetitle");
                        currentQuestionObject.SoundFile = SoundFilePath + $(this).attr("AudioSource");
                        currentQuestionObject.useIn = $(this).attr("Use");
                        currentQuestionObject.bloomsTaxonomy = $(this).attr("BloomsTaxonomy").split(",");

                        var arrSteps = [];
                        var head;
                        $(this).find("activity").each(function () {

                            if ($(this).attr("impType") == type) {
                                head = $(this).attr("headerText");
                                var objStep = [];
                                objStep.id = $(this).attr("id");
                                objStep.displayText = $(this).attr("question");
                                objStep.isCorrect = false;
                                objStep.headerText = $(this).attr("headerText");
                                objStep.head = head;
                                var arrStepOptions = [];
                                $(this).find("question").each(function () {
                                    var objOption = {};
                                    objOption.id = $(this).attr("id");
                                    objOption.displayWord = $(this).attr("sentence");
                                    objOption.correctAnswer = $(this).attr("correctOption");
                                    arrStepOptions.push(objOption);

                                });

                                objStep.options = arrStepOptions;
                                arrSteps.push(objStep);
                            }
                        });

                        currentQuestionObject.steps = arrSteps;
                        arrQuestionObjectsMaster.push(currentQuestionObject);



                    }

                }



                // }
            });

            buildContentLoad(0, "P");

        }
        function getContentMcq(PassageId, type, PageNumber, mode) {
            activeStepNo = 1;
            $("#stackContainer").empty();

            arrActivities = [];
            arrQuestionObjectsMaster = [];
            $(contentData).find("Passage").each(function () {

                if ($(this).is('[Stage]')) {
                    if ($(this).attr("Stage") == currentStage.toString()) {
                        var currentQuestionObject = [];
                        currentQuestionObject.id = $(this).attr("id");
                        currentQuestionObject.desc = $(this).attr("desc");

                        currentQuestionObject.pictureSource = contentImagesPath + $(this).attr("img");
                        currentQuestionObject.foundationGroupId = $(this).attr("PassageGroupId");
                        currentQuestionObject.useIn = $(this).attr("Use");
                        currentQuestionObject.PassageTitle = $(this).attr("Passagetitle");
                        currentQuestionObject.SoundFile = SoundFilePath + $(this).attr("AudioSource");
                        currentQuestionObject.bloomsTaxonomy = $(this).attr("BloomsTaxonomy").split(",");
                        var arrSteps = [];
                        var head;
                        if (PassageId == currentQuestionObject.id) {
                            $(this).find("activity").each(function () {
                                if ($(this).attr("impType") == type) {
                                    head = $(this).attr("headerText");
                                    var objStep = {};
                                    objStep.id = $(this).attr("id");
                                    objStep.displayText = $(this).attr("question");
                                    objStep.isCorrect = false;
                                    objStep.head = head;
                                    var arrStepOptions = [];
                                    $(this).find("option").each(function () {
                                        var objOption = {};
                                        objOption.slNo = $(this).attr("slno");
                                        objOption.description = $(this).attr("desc");
                                        objOption.isCorrectOption = $(this).attr("correct");

                                        arrStepOptions.push(objOption);
                                    });

                                    objStep.options = arrStepOptions;
                                    arrSteps.push(objStep);

                                }

                            });
                        }
                        currentQuestionObject.steps = arrSteps;
                        arrQuestionObjectsMaster.push(currentQuestionObject);



                    }

                }




            });
            buildContentMcq(PageNumber, mode);

        }
        function getContentFib(PassageId, type, PageNumber, mode) {
            activeStepNo = 1;
            $("#stackContainer").empty();

            //To get content for cts type of implementation
            arrActivities = [];
            arrQuestionObjectsMaster = [];
            $(contentData).find("Passage").each(function () {
                if ($(this).is('[Stage]')) {
                    if ($(this).attr("Stage") == currentStage.toString()) {
                        var currentQuestionObject = [];
                        currentQuestionObject.id = $(this).attr("id");
                        currentQuestionObject.desc = $(this).attr("desc");
                        currentQuestionObject.pictureSource = contentImagesPath + $(this).attr("img");

                        currentQuestionObject.foundationGroupId = $(this).attr("PassageGroupId");
                        currentQuestionObject.useIn = $(this).attr("Use");
                        currentQuestionObject.PassageTitle = $(this).attr("Passagetitle");
                        currentQuestionObject.SoundFile = SoundFilePath + $(this).attr("AudioSource");
                        currentQuestionObject.bloomsTaxonomy = $(this).attr("BloomsTaxonomy").split(",");


                        var arrSteps = [];
                        var head;
                        if (PassageId == currentQuestionObject.id) {
                            $(this).find("activity").each(function () {
                                if ($(this).attr("impType") == type) {
                                    head = $(this).attr("headerText");
                                    $(this).find("question").each(function () {
                                        var objStep = {};
                                        objStep.id = $(this).attr("id");

                                        objStep.displayText = $(this).attr("correctoption");
                                        objStep.wordPositions = $(this).attr("wordpositions");
                                        objStep.display = $(this).attr("display");
                                        objStep.head = head;
                                        objStep.currentState = "";
                                        objStep.inputValues = [];
                                        objStep.optionOrder = [];
                                        objStep.isChecked = false;
                                        objStep.isCorrect = false;
                                        objStep.checkedOptionId = "";

                                        arrSteps.push(objStep);
                                    });
                                }

                            });
                        }
                        currentQuestionObject.steps = arrSteps;
                        arrQuestionObjectsMaster.push(currentQuestionObject);
                    }
                }

            });

            buildContentFib(PageNumber, mode);
        }


        function getContentMat(PassageId, type, PageNumber, mode) {
            $("#stackContainer").empty();
            arrActivities = [];
            arrQuestionObjectsMaster = [];
            $(contentData).find("Passage").each(function () {
                if ($(this).is('[Stage]')) {
                    if ($(this).attr("Stage") == currentStage.toString()) {
                        var currentQuestionObject = [];
                        currentQuestionObject.id = $(this).attr("id");
                        currentQuestionObject.desc = $(this).attr("desc");

                        currentQuestionObject.pictureSource = contentImagesPath + $(this).attr("img");
                        currentQuestionObject.foundationGroupId = $(this).attr("PassageGroupId");
                        currentQuestionObject.useIn = $(this).attr("Use");
                        currentQuestionObject.PassageTitle = $(this).attr("Passagetitle");
                        currentQuestionObject.SoundFile = SoundFilePath + $(this).attr("AudioSource");
                        currentQuestionObject.bloomsTaxonomy = $(this).attr("BloomsTaxonomy").split(",");
                        var arrSteps = [];
                        var head;
                        $(this).find("activity").each(function () {
                            if ($(this).attr("impType") == type) {
                                head = $(this).attr("headerText");
                                var objStep = [];
                                objStep.id = $(this).attr("id");
                                objStep.displayText = $(this).attr("question");
                                objStep.isCorrect = false;
                                objStep.head = head;

                                var arrStepOptions = [];
                                $(this).find("question").each(function () {
                                    var objOption = {};
                                    objOption.id = $(this).attr("id");
                                    objOption.displayWord = $(this).attr("sentence");
                                    objOption.correctAnswer = $(this).attr("correctOption");

                                    arrStepOptions.push(objOption);

                                });

                                objStep.options = arrStepOptions;
                                arrSteps.push(objStep);
                            }
                        });
                        currentQuestionObject.steps = arrSteps;

                        arrQuestionObjectsMaster.push(currentQuestionObject);
                    }
                }

            });


            buildContentMat(PageNumber, mode);
        }

        function LoadAudio(pageNumber) {

            AudioFileName = arrQuestionObjectsMaster[pageNumber].SoundFile;
            audioFile = new Audio(AudioFileName);

            audioFile.load();
            audioFile.play();
            audioFile.volume = 1.0;
            if (!audioFile.muted) {

                audioFile.muted = false;
                $("#imgmute").attr("src", "images/unmute.png")
                $("#imgmute").attr("title", "Mute Sound");
            }
            else {

                audioFile.muted = true;
                $("#imgmute").attr("src", "images/mute.png");
                $("#imgmute").attr("title", "Unmute Sound");

            }

        }

        var questionIndex = 0;
        function buildContentLoad(pageNumber, usedIn) {

            usedMode = usedIn;

            $("#stackContainer").empty();
            var htmlBuilder = "";
            var viewStackContainerHtml = "";
            $("#stackContainer label").removeClass("ui-btn-icon-left");

            arrActivities = $.grep(arrQuestionObjectsMaster, function (v) {
                return v.useIn.indexOf(usedIn) >= 0;
            });

            if (arrActivities.length == 0) {
                $("#DivMainContent").hide();
                $("#noContent").show();
            }
            else {
                $("#DivMainContent").addClass("EnableMainDiv");
                $("#noContent").addClass("disavledMainDiv");
                $("#DivMainContent").show();
                $("#noContent").hide();
            }
            var displayOptionsHtml = "";
            var viewStackPrefixHtml = "<div id='myViewStack' class='myViewStack viewstackLoad'>";
            var fluidContainerPrefixHtml = "<div class='container-fluid' style='height:100%;'>";
            var fluidContainerSuffixHtml = "</div>";
            var dataWizardInitPrefixHtml = "<div data-wizard-init class='wizard' style='height:100%'>"
            var dataWizardInitSuffixHtml = "</div>"
            var unorderedListPrefixHtml = "<ul class='steps' id='step" + currentPageNumber + "'>";
            var unorderedListSuffixHtml = "</ul>"
            var clearDivHtml = "<div style='clear:both;'></div>";
            var titletext = "alt";

            for (var a = 0; a < arrActivities.length; a++) {
                currentQuestionObject = arrActivities[a];

                var stepItemHtml = "";
                var wizardStepContentPrefixHtml = "<div class='steps-content'>";
                var wizardStepContentSuffixHtml = "</div>";
                var stackChildPrefixHtml = "<div id='stack" + a + "' data-id='" + arrActivities[a].id + "'group-id='" + arrActivities[a].foundationGroupId + "' class='stackchild' style='width:100%; height:100%'>";
                var stackChildSuffixHtml = "</div>";
                var pictureIllustrationContainerPrefixHtml = "<div id='pictureIllustrationContainer" + a + "' class='pictureIllustrationContainer'>";
                var pictureIllustrationContainerSuffixHtml = "</div>";
                var paragraphTrext = currentQuestionObject.desc.replace(/pagebreak/gi, "<br />");
                currentQuestionObject.desc = currentQuestionObject.desc.replace(/~/g, '<span class="synonym"  style="display:none">').replace(/#/g, '</span>');
                var pictureIllustrationContentHtml = "<h3 style='margin-top:-20px;font-size:20px;'>" + arrActivities[a].PassageTitle + "</h2><div style='height:270px'><div class='tooltipimage' style='height:auto;display:block !important'><a href='#' onclick='imagePopup()' class='zoomimage'><img style='float:left;width:45%' id='pictureIllustration" + a + "' class='' src='" + currentQuestionObject.pictureSource + "' /><span class='tooltip-content-image'>Click on the image to Zoom</span></a></div>" + "<div style='float:right;width:48%;' id='passage" + a + "' class='pictureIllustration'>" + currentQuestionObject.desc.replace(/{/g, '<span class="hoverWord" style="background-color:#ffff99;">').replace(/}/g, '</span>') + "</div></div><div style='text-align:right'></div><img class='ReadMore' src='images/expand-arrows.png' style='height:20px;width:20px'/>";
                var wizardStepPrefixHtml = "";
                var wizardStepSuffixHtml = "</div>";
                var fullWizardStepsHtml = "";
                var arrCorrectAnswer = [];
                var arrCorrectAnswerUNrandomize;
                var arrDisplayword;
                var premiseHtml = "";
                var responseHtml = "";

                $("#pictureIllustration").attr("src", currentQuestionObject.pictureSource);

                // Concat all required html components
                htmlBuilder +=
                    stackChildPrefixHtml +
                    pictureIllustrationContainerPrefixHtml +
                    pictureIllustrationContentHtml +
                    pictureIllustrationContainerSuffixHtml +
                    fluidContainerPrefixHtml +
                    dataWizardInitPrefixHtml +
                    unorderedListPrefixHtml +
                    stepItemHtml +
                    unorderedListSuffixHtml +
                    wizardStepContentPrefixHtml +
                    fullWizardStepsHtml +
                    wizardStepContentSuffixHtml +
                    dataWizardInitSuffixHtml +
                    fluidContainerSuffixHtml +
                    stackChildSuffixHtml;
            }
            viewStackContainerHtml = viewStackPrefixHtml + htmlBuilder + viewStackSuffixHtml;

            //  Append generated html to the stackContainer Div
            //  Note: the jquery wizard js is at the end of the file to init the wizard component after the html is appended.
            $("#stackContainer").append(viewStackContainerHtml);

            // Refresh checkboxes for applying style
            $("#stackContainer").find("input[type=checkbox]").checkboxradio();

            // Re-Init viewstack component
            viewStack = $("#myViewStack").viewstack({
                selectedIndex: 0,
                creationComplete: function (e, data) { },
                selectedIndexChanged: function (e, data) { }
            });
            var color = $(".pictureIllustration span").css("background-color");

            // remove left-icon from the checkbox
            $("#stackContainer label").removeClass("ui-btn-icon-left");

            $("#stackContainer").find("input[type=radio]").checkboxradio();

            if ($("#imptcmprntion").hasClass("activecontainer") || $("#imtVocabulary").hasClass("activecontainer")) {
                $("#light-pagination").css("opacity", "0.1");
                $(".rightpagination").attr("title", "");
                $(".container-fluid").css("display", "blcok");
                $(".pictureIllustrationContainer").css("display", "none");
                $("#Backbutton").css("display", "inline-block");
                $(".ShowCheckDiv").css("display", "block");
            }
            else {
                $("#light-pagination").css("opacity", "1");
                $(".rightpagination").attr("title", "");
                $(".container-fluid").css("display", "none");
                $(".pictureIllustrationContainer").css("display", "block");
                $("#Backbutton").css("display", "none");
            }
            // to show no content div when data is not there in perticular page
            if ($("#stack" + currentPageNumber).find("ul li").length == 0) {

                $("#DivMainContent").hide();
                $("#noContent").show();
            }
            else {

                $("#DivMainContent").show();
                $("#noContent").hide();
            }
            $(".hoverWord").on("mouseover", function () {

                $(this).addClass("currentword");

                titletext = $("span.currentword").next().text();
                $(".currentword").attr("title", titletext);

                $(this).removeClass("currentword");
            });
            buildBloomsTaxonomy(0);

            initPaginator();

            // Reinitialize the wizard
            $(".wizard").each(function () {
                $(this)['wizardByGiro']({});
            });

            $(".sortable2").sortable({
                items: 'li',
                connectWith: ".connectedSortable",
                stop: handleSortStop
            }).disableSelection();
            LoadAudio(0);
            $(".ReadMore").click(function () {
                var PassageTitle = "<h3 style='font-size:20px;text-align:center'>" + arrQuestionObjectsMaster[currentPageNumber].PassageTitle + " </h3>";
                var FullPassage = arrQuestionObjectsMaster[currentPageNumber].desc.replace(/{/g, '<span class="hoverWord" style="background-color:#ffff99;">').replace(/}/g, '</span>');

                $("#FullStory").html(PassageTitle + FullPassage);
                $("#FullPassage").popup('open');
                $(".hoverWord").on("mouseover", function () {
                    $(this).addClass("currentword");
                    titletext = $("span.currentword").next().text();
                    $(".currentword").attr("title", titletext);
                    $(this).removeClass("currentword");
                });

            });

        }
        var questionIndex = 0;
        function buildContentQA(pageNumber, usedIn) {
            $("#stackContainer").empty();
            var htmlBuilder = "";
            var viewStackContainerHtml = "";
            $("#stackContainer label").removeClass("ui-btn-icon-left");
            arrActivities = $.grep(arrQuestionObjectsMaster, function (v) {
                return v.useIn.indexOf(usedIn) >= 0;
            });

            if (arrActivities.length == 0) {
                $("#DivMainContent").hide();
                $("#noContent").show();
            }
            else {

                $("#DivMainContent").show();
                $("#noContent").hide();
            }
            var displayOptionsHtml = "";
            var viewStackPrefixHtml = "<div id='myViewStack' class='myViewStack viewstackQA'>";
            var fluidContainerPrefixHtml = "<div class='container-fluid' style='height:100%;'>";
            var fluidContainerSuffixHtml = "</div>";
            var dataWizardInitPrefixHtml = "<div data-wizard-init class='wizard' style='height:100%'>"
            var dataWizardInitSuffixHtml = "</div>"
            var stepsindexPrefix = " <div style='padding-bottom:60px;' class='steps-index-container'>";
            var stepsindexSuffix = "</div>";
            var unorderedListPrefixHtml = "<ul class='steps'>";
            var unorderedListSuffixHtml = "</ul>"
            var clearDivHtml = "<div style='clear:both;'></div>";
            for (var a = 0; a < arrActivities.length; a++) {

                currentQuestionObject = arrActivities[a];

                var stepItemHtml = "";
                var wizardStepContentPrefixHtml = "<div class='steps-content'>";
                var wizardStepContentSuffixHtml = "</div>";
                var stackChildPrefixHtml = "<div id='stack" + a + "' group-id='" + arrActivities[a].foundationGroupId + "' data-id='" + arrActivities[a].id + "'group-id='" + arrActivities[a].foundationGroupId + "' class='stackchild' style='width:100%; height:100%'>";
                var stackChildSuffixHtml = "</div>";
                var pictureIllustrationContainerPrefixHtml = "<div id='pictureIllustrationContainer" + a + "'  class='pictureIllustrationContainer'>";
                var pictureIllustrationContainerSuffixHtml = "</div>";
                var paragraphTrext = currentQuestionObject.desc.replace(/pagebreak/gi, "<br />");
                currentQuestionObject.desc = currentQuestionObject.desc.replace(/~/g, '<span class="synonym"  style="display:none">').replace(/#/g, '</span>');
                var pictureIllustrationContentHtml = "<h3 style='margin-top:-20px;font-size:20px;'>" + arrActivities[a].PassageTitle + "</h2><div style='display:inline-block;'><div class='tooltipimage' style='height:auto'><a href='#' onclick='imagePopup()' class='zoomimage'><img style='float:left;width:45%' id='pictureIllustration" + a + "' class='' src='" + currentQuestionObject.pictureSource + "' /><span class='tooltip-content-image'>Click on the image to Zoom</span></a></div>" + "<p style='float:right;width:48%;' id='passage" + a + "' class='pictureIllustration'>" + currentQuestionObject.desc.replace(/{/g, '<span class="hoverWord" style="background-color:#ffff99;">').replace(/}/g, '</span>') + "</p></div><img class='ReadMore' src='images/expand-arrows.png' style='height:20px;width:20px'/>";
                var wizardStepPrefixHtml = "";
                var wizardStepSuffixHtml = "</div>";
                var fullWizardStepsHtml = "";
                $("#pictureIllustration").attr("src", currentQuestionObject.pictureSource);


                for (var s = 0; s < currentQuestionObject.steps.length; s++) {

                    CurrentInnerQuestion = currentQuestionObject.steps[s];
                    var moduletextheader = CurrentInnerQuestion.head;
                    $("#moduleHeaderText span").html("<h3 style='margin-bottom:-10px;'>" + moduletextheader + "</h3>");
                    stepItemHtml += "<li data-step='" + (s + 1) + "'>Q</li>";
                    wizardStepPrefixHtml = "<div class='step_" + (s + 1) + "' data-step='" + (s + 1) + "' id='ques" + currentQuestionObject.steps[s].id + "' >";
                    var stepNarrativePrefixHtml = "<h3 style='padding:3px;text-align:center'>" + currentQuestionObject.steps[s].displayText;

                    var stepNarrativeSuffixHtml = "</h3>";
                    var optionsContainerPrefixHtml = stepNarrativePrefixHtml + stepNarrativeSuffixHtml;
                    var optionsContainerSuffixHtml = "";
                    displayOptionsHtml = "";

                    displayOptionsHtml += "&nbsp;<div id='box' style='width:90%;margin:0px auto' class='regularBoxArea' style='display:inline-block;'><div style='width:90%;'><div class='gumbaz'></div><input style='width:90%;height:100px;overflow:auto;margin-bottom:10px;' class='' id='textarea'  type='textarea'  /></div>&nbsp;&nbsp;<div></div></div>";
                    var optionsContainerPrefixHtml2 = "";
                    var optionsContainerSuffixHtml2 = "";

                    fullWizardStepsHtml += wizardStepPrefixHtml + optionsContainerPrefixHtml + displayOptionsHtml + optionsContainerSuffixHtml + optionsContainerPrefixHtml2 + optionsContainerSuffixHtml2 + clearDivHtml + wizardStepSuffixHtml;
                }

                var displaySelectionsListPrefixHtml = "";
                var displaySelectionsListfixHtml = "";
                var selectioPanelPrefixHtml = "";
                var selectioPanelSuffixHtml = "";
                var fullDisplayOptionsHtml = "";
                var displayOptionsSectionTitle = "";
                for (var s = 0; s < currentQuestionObject.steps.length; s++) {
                    displaySelectionsListPrefixHtml = "";
                    var displaySelectedOptions = "";
                    displayOptionsSectionTitle = "";
                    fullDisplayOptionsHtml += selectioPanelPrefixHtml + displayOptionsSectionTitle + displaySelectionsListPrefixHtml + displaySelectionsListfixHtml + clearDivHtml + selectioPanelSuffixHtml;
                }

                fullWizardStepsHtml +=
                    fullDisplayOptionsHtml;
                htmlBuilder +=
                    stackChildPrefixHtml +
                    pictureIllustrationContainerPrefixHtml +
                    pictureIllustrationContentHtml +
                    pictureIllustrationContainerSuffixHtml +
                    fluidContainerPrefixHtml +
                    dataWizardInitPrefixHtml +
                    stepsindexPrefix +
                    unorderedListPrefixHtml +

                    stepItemHtml +
                    unorderedListSuffixHtml +
                    wizardStepContentPrefixHtml +
                    fullWizardStepsHtml +
                    wizardStepContentSuffixHtml +
                    stepsindexSuffix +
                    dataWizardInitSuffixHtml +
                    fluidContainerSuffixHtml +
                    stackChildSuffixHtml;
            }

            viewStackContainerHtml = viewStackPrefixHtml + htmlBuilder + viewStackSuffixHtml;

            // Append generated html to the stackContainer Div
            // Note: the jquery wizard js is at the end of the file to init the wizard component after the html is appended.
            $("#stackContainer").append(viewStackContainerHtml);

            // Refresh checkboxes for applying style
            $("#stackContainer").find("input[type=checkbox]").checkboxradio();

            // Re-Init viewstack component
            viewStack = $("#myViewStack").viewstack({
                selectedIndex: 0,
                creationComplete: function (e, data) { },
                selectedIndexChanged: function (e, data) { }
            });

            // remove left-icon from the checkbox
            $("#stackContainer label").removeClass("ui-btn-icon-left");

            $("#stackContainer").find("input[type=radio]").checkboxradio();
            $("#pictureIllustrationContainer1").css("display", "none");
            // remove left-icon from the checkbox
            $("#stackContainer label").removeClass("ui-btn-icon-left");

            $("#stackContainer").find("input[type=radio]").checkboxradio();
            $(".stackchild").css("display", "none");
            $("#stack" + pageNumber).css("display", "block");
            if ($("#imptQandA").hasClass("activecontainer")) {
                $("#light-pagination").css("opacity", "0.1");
                $(".rightpagination").attr("title", "");
                $("#DivLeft").css("opacity", "0.1");
                $(".container-fluid").css("display", "blcok");
                $(".pictureIllustrationContainer").css("display", "none");
                $("#Backbutton").css("display", "inline-block");
                $(".ShowCheckDiv").css("display", "block");
            }
            else {
                $("#light-pagination").css("opacity", "1");
                $(".rightpagination").attr("title", "Click on the ellipses(3 dots) to specify a page number");
                $("#DivLeft").css("opacity", "1");
                $(".container-fluid").css("display", "none");
                $(".pictureIllustrationContainer").css("display", "block");
                $(".Backbutton").css("display", "none");
                initPaginator();
            }
            //  to show no content div when data is not there in perticular page
            if ($("#stack" + currentPageNumber).find("ul li").length == 0) {

                $("#DivMainContent").hide();
                $("#noContent").show();
            }
            else {

                $("#DivMainContent").show();
                $("#noContent").hide();
            }
            buildBloomsTaxonomy(0);

            $(".hoverWord").on("mouseover", function () {

                $(this).addClass("currentword");

                titletext = $("span.currentword").next().text();
                $(".currentword").attr("title", titletext);

                $(this).removeClass("currentword");
            });
            // Reinitialize the wizard
            $(".wizard").each(function () {
                $(this)['wizardByGiro']({});
            });
            $(".ReadMore").click(function () {
                var PassageTitle = "<h3 style='font-size:20px;text-align:center'>" + arrQuestionObjectsMaster[currentPageNumber].PassageTitle + " </h3>";
                var FullPassage = arrQuestionObjectsMaster[currentPageNumber].desc.replace(/{/g, '<span class="hoverWord" style="background-color:#ffff99;">').replace(/}/g, '</span>');

                $("#FullStory").html(PassageTitle + FullPassage);
                $("#FullPassage").popup('open');
                $(".hoverWord").on("mouseover", function () {
                    $(this).addClass("currentword");
                    titletext = $("span.currentword").next().text();
                    $(".currentword").attr("title", titletext);
                    $(this).removeClass("currentword");
                });

            });

        }
        function buildContentMcq(pageNumber, usedIn) {

            $("#stackContainer").empty();
            var htmlBuilder = "";
            var viewStackContainerHtml = "";
            $("#stackContainer label").removeClass("ui-btn-icon-left");

            arrActivities = $.grep(arrQuestionObjectsMaster, function (v) {
                return v.useIn.indexOf(usedIn) >= 0;
            });

            if (arrActivities.length == 0) {
                $("#DivMainContent").hide();
                $("#noContent").show();
            }
            else {

                $("#DivMainContent").show();
                $("#noContent").hide();
            }

            var displayOptionsHtml = "";
            var viewStackPrefixHtml = "<div id='myViewStack' class='myViewStack viewstackMCQ'>";
            var fluidContainerPrefixHtml = "<div class='container-fluid' style='height:100%;'>";
            var fluidContainerSuffixHtml = "</div>";
            var dataWizardInitPrefixHtml = "<div data-wizard-init class='wizard' style='height:100%'>"
            var dataWizardInitSuffixHtml = "</div>"
            var unorderedListPrefixHtml = "<ul class='steps'>";
            var unorderedListSuffixHtml = "</ul>"
            var clearDivHtml = "<div style='clear:both;'></div>";
            for (var a = 0; a < arrActivities.length; a++) {
                currentQuestionObject = arrActivities[a];

                var stepItemHtml = "";
                var wizardStepContentPrefixHtml = "<div class='steps-content'>";
                var wizardStepContentSuffixHtml = "</div>";
                var stackChildPrefixHtml = "<div id='stack" + a + "' group-id='" + arrActivities[a].foundationGroupId + "' data-id='" + arrActivities[a].id + "'group-id='" + arrActivities[a].foundationGroupId + "' class='stackchild' style='width:100%; height:100%'>";
                var stackChildSuffixHtml = "</div>";
                var pictureIllustrationContainerPrefixHtml = "<div id='pictureIllustrationContainer" + a + "' style='display:none'  class='pictureIllustrationContainer'>";
                var pictureIllustrationContainerSuffixHtml = "</div>";
                var paragraphTrext = currentQuestionObject.desc.replace(/pagebreak/gi, "<br />");
                currentQuestionObject.desc = currentQuestionObject.desc.replace(/~/g, '<span class="synonym"  style="display:none">').replace(/#/g, '</span>');
                var pictureIllustrationContentHtml = "<h3 style='margin-top:-20px;font-size:20px;'>" + arrActivities[a].PassageTitle + "</h2><div style='display:inline-block;'><div class='tooltipimage' style='height:auto'><a href='#' onclick='imagePopup()' class='zoomimage'><img style='float:left;width:45%' id='pictureIllustration" + a + "' class='' src='" + currentQuestionObject.pictureSource + "' /><span class='tooltip-content-image'>Click on the image to Zoom</span></a></div>" + "<p style='float:right;width:48%;' id='passage" + a + "' class='pictureIllustration'>" + currentQuestionObject.desc.replace(/{/g, '<span class="hoverWord" style="background-color:#ffff99;">').replace(/}/g, '</span>') + "</p></div><img class='ReadMore' src='images/expand-arrows.png' style='height:20px;width:20px'/>";
                var wizardStepPrefixHtml = "";
                var wizardStepSuffixHtml = "</div>";
                var fullWizardStepsHtml = "";
                $("#pictureIllustration").attr("src", currentQuestionObject.pictureSource);

                for (var s = 0; s < currentQuestionObject.steps.length; s++) {

                    CurrentInnerQuestion = currentQuestionObject.steps[s];
                    var moduletextheader = CurrentInnerQuestion.head;
                    $("#moduleHeaderText span").html("<h3 style='margin-bottom:-10px;'>" + moduletextheader + "</h3>");
                    stepItemHtml += "<li data-step='" + (s + 1) + "'>Q</li>";
                    wizardStepPrefixHtml = "<div class='step_" + (s + 1) + "' data-step='" + (s + 1) + "' id='ques" + currentQuestionObject.steps[s].id + "' >";
                    var stepNarrativePrefixHtml = "<h3 style='padding:10px;text-align:center'>" + currentQuestionObject.steps[s].displayText;
                    var stepNarrativeSuffixHtml = "</h3>";
                    var optionsContainerPrefixHtml = stepNarrativePrefixHtml + stepNarrativeSuffixHtml;
                    var optionsContainerSuffixHtml = "";
                    displayOptionsHtml = "";
                    var randomizedOptions = randomSortArray(currentQuestionObject.steps[s].options);
                    for (var o = 0; o < currentQuestionObject.steps[s].options.length; o++) {
                        var dataValue = randomizedOptions[o].description;
                        var widgetId = "rdo_" + o;
                        var boxid = "box" + widgetId;
                        var checkedState = "checked";
                        displayOptionsHtml += "<div data-item-type='optionradio'  id='boption_" + a + "_" + s + "_" + o + "' class='regularBoxradio' style='width:92%;height:auto !important'><div class='labelparentheight' style='min-width: 50px;height:30px;margin-top:-10px;'><input  id='option_" + a + "_" + s + "_" + o + "' name='option_radio" + s + "' type='radio' class='" + radioGroupName + "' value='" + randomizedOptions[o].isCorrectOption + "'/><label dataIscrct='" + randomizedOptions[o].isCorrectOption + "' id='label_" + a + "_" + s + "_" + o + "' for='option_" + a + "_" + s + "_" + o + "' class='optionlabel ui-btn ui-corner-all ui-btn-inherit ui-checkbox-off ui-radio-off ui-first-child labelheight'>" + dataValue + "</label></div><div class='insidegumbaz' id='gumbaz_boption_" + a + "_" + s + "_" + o + "'></div></div>";

                    }

                    var optionsContainerPrefixHtml2 = "";
                    var optionsContainerSuffixHtml2 = "";

                    fullWizardStepsHtml += wizardStepPrefixHtml + optionsContainerPrefixHtml + displayOptionsHtml + optionsContainerSuffixHtml + optionsContainerPrefixHtml2 + optionsContainerSuffixHtml2 + clearDivHtml + wizardStepSuffixHtml;

                }

                var displaySelectionsListPrefixHtml = "";
                var displaySelectionsListfixHtml = "";
                var selectioPanelPrefixHtml = "";
                var selectioPanelSuffixHtml = "";
                var fullDisplayOptionsHtml = "";
                var displayOptionsSectionTitle = "";
                for (var s = 0; s < currentQuestionObject.steps.length; s++) {
                    displaySelectionsListPrefixHtml = "";
                    var displaySelectedOptions = "";
                    displayOptionsSectionTitle = "";
                    fullDisplayOptionsHtml += selectioPanelPrefixHtml + displayOptionsSectionTitle + displaySelectionsListPrefixHtml + displaySelectionsListfixHtml + clearDivHtml + selectioPanelSuffixHtml;
                }

                fullWizardStepsHtml +=
                    fullDisplayOptionsHtml;


                // Concat all required html components
                htmlBuilder +=
                    stackChildPrefixHtml +
                    pictureIllustrationContainerPrefixHtml +
                    pictureIllustrationContentHtml +
                    pictureIllustrationContainerSuffixHtml +
                    fluidContainerPrefixHtml +
                    dataWizardInitPrefixHtml +
                    unorderedListPrefixHtml +
                    stepItemHtml +
                    unorderedListSuffixHtml +
                    wizardStepContentPrefixHtml +
                    fullWizardStepsHtml +
                    wizardStepContentSuffixHtml +
                    dataWizardInitSuffixHtml +
                    fluidContainerSuffixHtml +
                    stackChildSuffixHtml;
            }
            viewStackContainerHtml = viewStackPrefixHtml + htmlBuilder + viewStackSuffixHtml;

            // Append generated html to the stackContainer Div
            // Note: the jquery wizard js is at the end of the file to init the wizard component after the html is appended.
            $("#stackContainer").append(viewStackContainerHtml);

            // Refresh checkboxes for applying style
            $("#stackContainer").find("input[type=checkbox]").checkboxradio();

            // Re-Init viewstack component
            viewStack = $("#myViewStack").viewstack({
                selectedIndex: 0,
                creationComplete: function (e, data) { },
                selectedIndexChanged: function (e, data) { }
            });
            $(".stackchild").css("display", "none");
            $("#stack" + pageNumber).css("display", "block");
            $("#pictureIllustrationContainer1").css("display", "none");
            // remove left-icon from the checkbox
            $("#stackContainer label").removeClass("ui-btn-icon-left");

            $("#stackContainer").find("input[type=radio]").checkboxradio();

            if ($("#imptcmprntion").hasClass("activecontainer")) {
                $("#DivLeft").css("opacity", "0.1");
                $("#light-pagination").css("opacity", "0.1");
                $(".rightpagination").attr("title", "");
                $(".container-fluid").css("display", "block");
                $(".pictureIllustrationContainer").css("display", "none");
                $("#Backbutton").css("display", "inline-block");
                $(".ShowCheckDiv").css("display", "block");
            }
            else {
                $("#DivLeft").css("opacity", "1");
                $("#light-pagination").css("opacity", "1");
                $(".rightpagination").attr("title", "Click on the ellipses(3 dots) to specify a page number");
                $(".container-fluid").css("display", "none");
                $(".pictureIllustrationContainer").css("display", "block");
                $("#Backbutton").css("display", "none");
                initPaginator();
            }
            // to show no content div when data is not there in perticular page
            if ($("#stack" + currentPageNumber).find("ul li").length == 0) {

                $("#DivMainContent").hide();
                $("#noContent").show();
            }
            else {

                $("#DivMainContent").show();
                $("#noContent").hide();
            }
            buildBloomsTaxonomy(0);
            $(".hoverWord").on("mouseover", function () {

                $(this).addClass("currentword");

                titletext = $("span.currentword").next().text();
                $(".currentword").attr("title", titletext);

                $(this).removeClass("currentword");
            });
            // Reinitialize the wizard
            $(".wizard").each(function () {
                $(this)['wizardByGiro']({});
            });
            $(".ReadMore").click(function () {
                var PassageTitle = "<h3 style='font-size:20px;text-align:center'>" + arrQuestionObjectsMaster[currentPageNumber].PassageTitle + " </h3>";
                var FullPassage = arrQuestionObjectsMaster[currentPageNumber].desc.replace(/{/g, '<span class="hoverWord" style="background-color:#ffff99;">').replace(/}/g, '</span>');

                $("#FullStory").html(PassageTitle + FullPassage);
                $("#FullPassage").popup('open');
                $(".hoverWord").on("mouseover", function () {
                    $(this).addClass("currentword");
                    titletext = $("span.currentword").next().text();
                    $(".currentword").attr("title", titletext);
                    $(this).removeClass("currentword");
                });

            });

        }
        var questionIndex = 0;
        function buildContentSpelling(pageNumber, usedIn) {
            $("#stackContainer").empty();
            var htmlBuilder = "";
            var viewStackContainerHtml = "";
            $("#stackContainer label").removeClass("ui-btn-icon-left");
            arrActivities = $.grep(arrQuestionObjectsMaster, function (v) {
                return v.useIn.indexOf(usedIn) >= 0;
            });
            if (arrActivities.length == 0) {
                $("#DivMainContent").hide();
                $("#noContent").show();
            }
            else {

                $("#DivMainContent").show();
                $("#noContent").hide();
            }

            var displayOptionsHtml = "";
            var viewStackPrefixHtml = "<div id='myViewStack' class='myViewStack viewstackSpelling'>";
            var fluidContainerPrefixHtml = "<div class='container-fluid' style='height:100%;'>";
            var fluidContainerSuffixHtml = "</div>";
            var dataWizardInitPrefixHtml = "<div data-wizard-init class='wizard' style='height:100%'>"
            var dataWizardInitSuffixHtml = "</div>"
            var stepsindexPrefix = " <div class='steps-index-container'>";
            var stepsindexSuffix = "</div>";
            var unorderedListPrefixHtml = "<ul class='steps'>";
            var unorderedListSuffixHtml = "</ul>"
            var clearDivHtml = "<div style='clear:both;'></div>";
            for (var a = 0; a < arrActivities.length; a++) {
                currentQuestionObject = arrActivities[a];

                var stepItemHtml = "";
                var wizardStepContentPrefixHtml = "<div class='steps-content'>";
                var wizardStepContentSuffixHtml = "</div>";
                var stackChildPrefixHtml = "<div id='stack" + a + "' group-id='" + arrActivities[a].foundationGroupId + "' data-id='" + arrActivities[a].id + "'group-id='" + arrActivities[a].foundationGroupId + "' class='stackchild' style='width:100%; height:100%'>";
                var stackChildSuffixHtml = "</div>";
                var pictureIllustrationContainerPrefixHtml = "<div id='pictureIllustrationContainer" + a + "' style='display:none'  class='pictureIllustrationContainer'>";
                var pictureIllustrationContainerSuffixHtml = "</div>";
                var paragraphTrext = currentQuestionObject.desc.replace(/pagebreak/gi, "<br />");
                currentQuestionObject.desc = currentQuestionObject.desc.replace(/~/g, '<span class="synonym"  style="display:none">').replace(/#/g, '</span>');
                var pictureIllustrationContentHtml = "<h3 style='margin-top:-20px;font-size:20px;'>" + arrActivities[a].PassageTitle + "</h2><div style='display:inline-block;'><div class='tooltipimage' style='height:auto'><a href='#' onclick='imagePopup()' class='zoomimage'><img style='float:left;width:45%' id='pictureIllustration" + a + "' class='' src='" + currentQuestionObject.pictureSource + "' /><span class='tooltip-content-image'>Click on the image to Zoom</span></a></div>" + "<p style='float:right;width:48%;' id='passage" + a + "' class='pictureIllustration'>" + currentQuestionObject.desc.replace(/{/g, '<span class="hoverWord" style="background-color:#ffff99;">').replace(/}/g, '</span>') + "</p></div><img class='ReadMore' src='images/expand-arrows.png' style='height:20px;width:20px'/>";
                var wizardStepPrefixHtml = "";
                var wizardStepSuffixHtml = "</div>";
                var fullWizardStepsHtml = "";
                $("#pictureIllustration").attr("src", currentQuestionObject.pictureSource);


                for (var s = 0; s < currentQuestionObject.steps.length; s++) {
                    CurrentInnerQuestion = currentQuestionObject.steps[s];
                    var moduletextheader = CurrentInnerQuestion.head;
                    $("#moduleHeaderText span").html("<h3 style='margin-bottom:-10px;'>" + moduletextheader + "</h3>");
                    stepItemHtml += "<li data-step='" + (s + 1) + "'>Q</li>";
                    wizardStepPrefixHtml = "<div class='step_" + (s + 1) + "' data-step='" + (s + 1) + "' id='ques" + currentQuestionObject.steps[s].id + "' >";
                    var stepNarrativePrefixHtml = "<div style='padding:10px;text-align:left;line-height:2em'>";
                    var stepNarrativeSuffixHtml = "</div>";
                    var arrWordPositions = currentQuestionObject.steps[s].wordPositions.split(",");

                    var arrWordsInSentence = currentQuestionObject.steps[s].correctAnswer.split(" ");

                    counttext = 0;
                    for (var w = 0; w < arrWordsInSentence.length; w++) {

                        if (arrWordPositions.indexOf(String(w + 1)) == -1) {
                            stepNarrativePrefixHtml += "<span class='textonly'>" + arrWordsInSentence[w] + "</span>&nbsp;";
                        }
                        else {
                            if (arrWordsInSentence[w].length <= 3) {
                                var jumbledWord = jumbleWord(arrWordsInSentence[w]);
                                counttext++;
                                stepNarrativePrefixHtml += "&nbsp;<div id='box" + counttext + "'class='regularBoxSmall' style='display:inline-block;margin: 12px 0px;'><div style='min-width:45px;margin-bottom:0px;'><input class='keyin textinputSmall' id='txt_" + w + "'  type='text' data-option-rel='' data-enered-value='' data-jumbled='" + jumbledWord + "' value='" + jumbledWord + "' data-value='" + arrWordsInSentence[w].replace(/'/g, "~") + "'/></div>&nbsp;&nbsp;<div></div></div>";
                            } else if (arrWordsInSentence[w].length <= 5) {
                                var jumbledWord = jumbleWord(arrWordsInSentence[w]);
                                counttext++;
                                stepNarrativePrefixHtml += "&nbsp;<div id='box" + counttext + "' class='regularBox' style='display:inline-block;margin: 12px 0px'><div style='min-width:60px;margin-bottom:0px;'><input class='keyin textinput' id='txt_" + w + "'  type='text' data-option-rel='' data-enered-value='' data-jumbled='" + jumbledWord + "' value='" + jumbledWord + "'data-value='" + arrWordsInSentence[w].replace(/'/g, "~") + "'/></div>&nbsp;&nbsp;<div></div></div>";
                            } else {
                                var jumbledWord = jumbleWord(arrWordsInSentence[w]);
                                counttext++;
                                stepNarrativePrefixHtml += "&nbsp;<div id='box" + counttext + "' class='regularBoxLarge' style='display:inline-block;margin: 12px 0px'><div style='min-width:85px;margin-bottom:0px;'><input class='keyin textinputLarge' id='txt_" + w + "'  type='text' data-option-rel='' data-enered-value='' data-jumbled='" + jumbledWord + "' value='" + jumbledWord + "' data-value='" + arrWordsInSentence[w].replace(/'/g, "~") + "'/></div>&nbsp;&nbsp;<div></div></div>";
                            }
                        }
                    }
                    var optionsContainerPrefixHtml = stepNarrativePrefixHtml + stepNarrativeSuffixHtml;
                    var optionsContainerSuffixHtml = "";
                    displayOptionsHtml = "";
                    var optionsContainerPrefixHtml2 = "";
                    var optionsContainerSuffixHtml2 = "";

                    fullWizardStepsHtml += wizardStepPrefixHtml + optionsContainerPrefixHtml + optionsContainerSuffixHtml + optionsContainerPrefixHtml2 + optionsContainerSuffixHtml2 + clearDivHtml + wizardStepSuffixHtml;

                }
                var displaySelectionsListPrefixHtml = "";
                var displaySelectionsListfixHtml = "";
                var selectioPanelPrefixHtml = "";
                var selectioPanelSuffixHtml = "";
                var fullDisplayOptionsHtml = "";
                var displayOptionsSectionTitle = "";
                for (var s = 0; s < currentQuestionObject.steps.length; s++) {
                    displaySelectionsListPrefixHtml = "";
                    var displaySelectedOptions = "";
                    displayOptionsSectionTitle = "";
                    fullDisplayOptionsHtml += selectioPanelPrefixHtml + displayOptionsSectionTitle + displaySelectionsListPrefixHtml + displaySelectionsListfixHtml + clearDivHtml + selectioPanelSuffixHtml;
                }

                fullWizardStepsHtml +=
                    fullDisplayOptionsHtml;


                // Concat all required html components
                htmlBuilder +=
                    stackChildPrefixHtml +
                    pictureIllustrationContainerPrefixHtml +
                    pictureIllustrationContentHtml +
                    pictureIllustrationContainerSuffixHtml +
                    fluidContainerPrefixHtml +
                    dataWizardInitPrefixHtml +
                    stepsindexPrefix +
                    unorderedListPrefixHtml +

                    stepItemHtml +
                    unorderedListSuffixHtml +
                    wizardStepContentPrefixHtml +
                    fullWizardStepsHtml +
                    wizardStepContentSuffixHtml +
                    stepsindexSuffix +
                    dataWizardInitSuffixHtml +
                    fluidContainerSuffixHtml +
                    stackChildSuffixHtml;
            }

            viewStackContainerHtml = viewStackPrefixHtml + htmlBuilder + viewStackSuffixHtml;

            // Append generated html to the stackContainer Div
            // Note: the jquery wizard js is at the end of the file to init the wizard component after the html is appended.
            $("#stackContainer").append(viewStackContainerHtml);

            // Refresh checkboxes for applying style
            $("#stackContainer").find("input[type=checkbox]").checkboxradio();

            // Re-Init viewstack component
            viewStack = $("#myViewStack").viewstack({
                selectedIndex: 0,
                creationComplete: function (e, data) { },
                selectedIndexChanged: function (e, data) { }
            });

            // remove left-icon from the checkbox
            $("#stackContainer label").removeClass("ui-btn-icon-left");

            $("#stackContainer").find("input[type=radio]").checkboxradio();

            $(".stackchild").css("display", "none");
            $("#stack" + pageNumber).css("display", "block");
            $("#pictureIllustrationContainer").css("display", "none");
            $("#PassageContainer").css("display", "none");
            // remove left-icon from the checkbox
            $("#stackContainer label").removeClass("ui-btn-icon-left");

            $("#stackContainer").find("input[type=radio]").checkboxradio();

            $(".stackchild").css("display", "none");
            $("#stack" + pageNumber).css("display", "block");
            if ($("#imtSpelling").hasClass("activecontainer")) {
                $("#DivLeft").css("opacity", "0.1");
                $("#light-pagination").css("opacity", "0.1");
                $(".rightpagination").attr("title", "");
                $(".container-fluid").css("display", "blcok");
                $(".pictureIllustrationContainer").css("display", "none");
                $("#Backbutton").css("display", "inline-block");
                $(".ShowCheckDiv").css("display", "block");
            }
            else {
                $("#DivLeft").css("opacity", "1");
                $("#light-pagination").css("opacity", "1");
                $(".rightpagination").attr("title", "Click on the ellipses(3 dots) to specify a page number");
                $(".container-fluid").css("display", "none");
                $(".pictureIllustrationContainer").css("display", "block");
                $("#Backbutton").css("display", "none");
                initPaginator();
            }
            // to show no content div when data is not there in perticular page
            if ($("#stack" + currentPageNumber).find("ul li").length == 0) {

                $("#DivMainContent").hide();
                $("#noContent").show();
            }
            else {

                $("#DivMainContent").show();
                $("#noContent").hide();
            }
            buildBloomsTaxonomy(0);


            $(".hoverWord").on("mouseover", function () {

                $(this).addClass("currentword");

                titletext = $("span.currentword").next().text();
                $(".currentword").attr("title", titletext);

                $(this).removeClass("currentword");
                // $("li.third-item").next()
            });
            // Reinitialize the wizard
            $(".wizard").each(function () {
                $(this)['wizardByGiro']({});
            });

            $(".ReadMore").click(function () {
                var PassageTitle = "<h3 style='font-size:20px;text-align:center'>" + arrQuestionObjectsMaster[currentPageNumber].PassageTitle + " </h3>";
                var FullPassage = arrQuestionObjectsMaster[currentPageNumber].desc.replace(/{/g, '<span class="hoverWord" style="background-color:#ffff99;">').replace(/}/g, '</span>');

                $("#FullStory").html(PassageTitle + FullPassage);
                $("#FullPassage").popup('open');
                $(".hoverWord").on("mouseover", function () {
                    $(this).addClass("currentword");
                    titletext = $("span.currentword").next().text();
                    $(".currentword").attr("title", titletext);
                    $(this).removeClass("currentword");
                });

            });
        }
        var questionIndex = 0;
        function buildContentJumbled(pageNumber, usedIn) {

            $("#stackContainer").empty();
            $(".sortableWords").empty();

            var htmlBuilder = "";
            var viewStackContainerHtml = "";
            $("#stackContainer label").removeClass("ui-btn-icon-left");
            arrActivities = $.grep(arrQuestionObjectsMaster, function (v) {
                return v.useIn.indexOf(usedIn) >= 0;
            });

            //currentQuestionObject = arrActivities[pageNumber];
            if (arrActivities.length == 0) {
                $("#DivMainContent").hide();
                $("#noContent").show();
            }
            else {

                $("#DivMainContent").show();
                $("#noContent").hide();
            }

            var displayOptionsHtml = "";
            var viewStackPrefixHtml = "<div id='myViewStack' class='myViewStack viewstackJumbled'>";
            var fluidContainerPrefixHtml = "<div class='container-fluid' style='height:100%;'>";
            var fluidContainerSuffixHtml = "</div>";
            var dataWizardInitPrefixHtml = "<div data-wizard-init class='wizard' style='height:100%'>"
            var dataWizardInitSuffixHtml = "</div>"
            var stepsindexPrefix = " <div class='steps-index-container'>";
            var stepsindexSuffix = "</div>";
            var unorderedListPrefixHtml = "<ul class='steps'>";
            var unorderedListSuffixHtml = "</ul>"
            var clearDivHtml = "<div style='clear:both;'></div>";
            for (var a = 0; a < arrActivities.length; a++) {
                currentQuestionObject = arrActivities[a];

                var stepItemHtml = "";
                var wizardStepContentPrefixHtml = "<div class='steps-content'>";
                var wizardStepContentSuffixHtml = "</div>";
                var stackChildPrefixHtml = "<div id='stack" + a + "' group-id='" + arrActivities[a].foundationGroupId + "' data-id='" + arrActivities[a].id + "'group-id='" + arrActivities[a].foundationGroupId + "' class='stackchild' style='width:100%; height:100%'>";
                var stackChildSuffixHtml = "</div>";
                var pictureIllustrationContainerPrefixHtml = "<div style='display:none;' id='pictureIllustrationContainer" + a + "'  class='pictureIllustrationContainer'>";
                var pictureIllustrationContainerSuffixHtml = "</div>";
                var paragraphTrext = currentQuestionObject.desc.replace(/pagebreak/gi, "<br />");
                currentQuestionObject.desc = currentQuestionObject.desc.replace(/~/g, '<span class="synonym"  style="display:none">').replace(/#/g, '</span>');
                var pictureIllustrationContentHtml = "<h3 style='margin-top:-20px;font-size:20px;'>" + arrActivities[a].PassageTitle + "</h2><div style='display:inline-block;'><div class='tooltipimage' style='height:auto'><a href='#' onclick='imagePopup()' class='zoomimage'><img style='float:left;width:45%' id='pictureIllustration" + a + "' class='' src='" + currentQuestionObject.pictureSource + "' /><span class='tooltip-content-image'>Click on the image to Zoom</span></a></div>" + "<p style='float:right;width:48%;' id='passage" + a + "' class='pictureIllustration'>" + currentQuestionObject.desc.replace(/{/g, '<span class="hoverWord" style="background-color:#ffff99;">').replace(/}/g, '</span>') + "</p></div><img class='ReadMore' src='images/expand-arrows.png' style='height:20px;width:20px'/>";
                var wizardStepPrefixHtml = "";
                var wizardStepSuffixHtml = "</div>";
                var fullWizardStepsHtml = "";
                $("#pictureIllustration").attr("src", currentQuestionObject.pictureSource);
                for (var s = 0, i = 0; s < currentQuestionObject.steps.length; i++, s++) {

                    CurrentInnerQuestion = currentQuestionObject.steps[s];
                    var moduletextheader = CurrentInnerQuestion.head;
                    $("#moduleHeaderText span").html("<h3 style='margin-bottom:-10px;'>" + moduletextheader + "</h3>");
                    stepItemHtml += "<li data-step='" + (s + 1) + "'>Q</li>";
                    wizardStepPrefixHtml = "<div class='step_" + (s + 1) + "' style='margin: 30px; margin-left:40px !important;' data-step='" + (s + 1) + "' id='ques" + currentQuestionObject.steps[s].id + "' >";
                    var stepNarrativePrefixHtml = "<div style='padding:10px;text-align:center;line-height:2em'><div class='sortableWords ' id='sortableWords" + s + "'>";
                    var stepNarrativeSuffixHtml = "</div></div>";
                    var arrWordsInSentence = currentQuestionObject.steps[s].correctAnswer.split("#");
                    arrWordsInSentence = randomSortArray(arrWordsInSentence);
                    counttext = 0;
                    for (var w = 0; w < arrWordsInSentence.length; w++) {
                        if (arrWordsInSentence[w].length <= 3) {
                            stepNarrativePrefixHtml += "<div style='float:left' id='box" + w + "' class='regularBoxSmall '>&nbsp;&nbsp;<div style='min-width:45px;'class='dragText" + w + "'><span id='sortablewordstext'>" + arrWordsInSentence[w] + "</span></div><div class='gumbaz'></div></div>";
                        } else if (arrWordsInSentence[w].length <= 5) {
                            stepNarrativePrefixHtml += "<div style='float:left' id='box" + w + "' class='regularBox '>&nbsp;&nbsp;<div style='min-width:60px;'class='dragText" + w + "'><span id='sortablewordstext'>" + arrWordsInSentence[w] + "</span></div><div class='gumbaz'></div></div>";
                        } else {
                            stepNarrativePrefixHtml += "<div style='float:left' id='box" + w + "' class='regularBoxLarge '>&nbsp;&nbsp;<div style='min-width:85px;'class='dragText" + w + "'><span id='sortablewordstext'>" + arrWordsInSentence[w] + "</span></div><div class='gumbaz'></div></div>";
                        }
                    }

                    var optionsContainerPrefixHtml = stepNarrativePrefixHtml + stepNarrativeSuffixHtml;

                    var optionsContainerSuffixHtml = "";
                    displayOptionsHtml = "";
                    var optionsContainerPrefixHtml2 = "";
                    var optionsContainerSuffixHtml2 = "";

                    fullWizardStepsHtml += wizardStepPrefixHtml + optionsContainerPrefixHtml + optionsContainerSuffixHtml + optionsContainerPrefixHtml2 + optionsContainerSuffixHtml2 + clearDivHtml + wizardStepSuffixHtml;
                }

                var displaySelectionsListPrefixHtml = "";
                var displaySelectionsListfixHtml = "";
                var selectioPanelPrefixHtml = "";
                var selectioPanelSuffixHtml = "";
                var fullDisplayOptionsHtml = "";
                var displayOptionsSectionTitle = "";
                for (var s = 0; s < currentQuestionObject.steps.length; s++) {
                    displaySelectionsListPrefixHtml = "";
                    var displaySelectedOptions = "";
                    displayOptionsSectionTitle = "";
                    fullDisplayOptionsHtml += selectioPanelPrefixHtml + displayOptionsSectionTitle + displaySelectionsListPrefixHtml + displaySelectionsListfixHtml + clearDivHtml + selectioPanelSuffixHtml;
                }

                fullWizardStepsHtml +=
                    fullDisplayOptionsHtml;


                // Concat all required html components
                htmlBuilder +=
                    stackChildPrefixHtml +
                    pictureIllustrationContainerPrefixHtml +
                    pictureIllustrationContentHtml +
                    pictureIllustrationContainerSuffixHtml +
                    fluidContainerPrefixHtml +
                    dataWizardInitPrefixHtml +
                    stepsindexPrefix +
                    unorderedListPrefixHtml +
                    stepItemHtml +
                    unorderedListSuffixHtml +
                    wizardStepContentPrefixHtml +
                    fullWizardStepsHtml +
                    wizardStepContentSuffixHtml +
                    stepsindexSuffix +
                    dataWizardInitSuffixHtml +
                    fluidContainerSuffixHtml +
                    stackChildSuffixHtml;
            }
            viewStackContainerHtml = viewStackPrefixHtml + htmlBuilder + viewStackSuffixHtml;
            // Append generated html to the stackContainer Div
            // Note: the jquery wizard js is at the end of the file to init the wizard component after the html is appended.
            $("#stackContainer").append(viewStackContainerHtml);
            currentQuestionObject = arrActivities[pageNumber];
            var identifier;


            for (var q = 0; q < currentQuestionObject.steps.length; q++) {


                $page_id = parseInt($pageid) - parseInt(1);

                /// $("#sortableWords" + q).sortable({
                $('#stack' + $page_id).find("#sortableWords" + q).sortable({
                    start: function (event, ui) {
                        $(".gumbaz").hide();
                        $("#rightAnswer").hide();

                        $("#showAnswer").hide();
                        identifier = ui.item.attr("id").replace("box", "dragText");
                        $("." + identifier).css("background-color", "#dd619e");
                        $("." + identifier).css("color", "#fff");
                    },
                    stop: function (event, ui) {
                        $(".gumbaz").show();
                        $("#rightAnswer").hide();

                        $("#showAnswer").hide();
                        $("." + identifier).css("background-color", "#fbfbfb !important");
                        $("." + identifier).css("color", "#333 !important");
                    }
                });
                $("#sortableWords" + q).disableSelection();
            }
            // Refresh checkboxes for applying style
            $("#stackContainer").find("input[type=checkbox]").checkboxradio();
            // Re-Init viewstack component
            viewStack = $("#myViewStack").viewstack({
                selectedIndex: 0,
                creationComplete: function (e, data) { },
                selectedIndexChanged: function (e, data) { }
            });
            $(".stackchild").css("display", "none");
            $("#stack" + pageNumber).css("display", "block");
            $("#pictureIllustrationContainer1").css("display", "none");
            // remove left-icon from the checkbox
            $("#stackContainer label").removeClass("ui-btn-icon-left");

            $("#stackContainer").find("input[type=radio]").checkboxradio();

            if ($("#imtJumbledWords").hasClass("activecontainer")) {
                $("#DivLeft").css("opacity", "0.1");
                $(".container-fluid").css("display", "blcok");
                $(".rightpagination").attr("title", "");
                $(".pictureIllustrationContainer").css("display", "none");
                $("#box").css("display", "block");
                $("#light-pagination").css("opacity", "0.1")
                $("#Backbutton").css("display", "inline-block");
                $(".ShowCheckDiv").css("display", "block");
            }
            else {
                $("#DivLeft").css("opacity", "1");
                $("#light-pagination").css("opacity", "1");
                $(".rightpagination").attr("title", "Click on the ellipses(3 dots) to specify a page number");
                $(".container-fluid").css("display", "none");
                $(".pictureIllustrationContainer").css("display", "block");
                $("#Backbutton").css("display", "none");
                initPaginator();
            }
            // to show no content div when data is not there in perticular page
            if ($("#stack" + currentPageNumber).find("ul li").length == 0) {

                $("#DivMainContent").hide();
                $("#noContent").show();
            }
            else {

                $("#DivMainContent").show();
                $("#noContent").hide();
            }
            buildBloomsTaxonomy(0);

            $(".hoverWord").on("mouseover", function () {

                $(this).addClass("currentword");

                titletext = $("span.currentword").next().text();
                $(".currentword").attr("title", titletext);

                $(this).removeClass("currentword");
            });

            // Reinitialize the wizard
            $(".wizard").each(function () {
                $(this)['wizardByGiro']({});
            });
            $(".ReadMore").click(function () {
                var PassageTitle = "<h3 style='font-size:20px;text-align:center'>" + arrQuestionObjectsMaster[currentPageNumber].PassageTitle + " </h3>";
                var FullPassage = arrQuestionObjectsMaster[currentPageNumber].desc.replace(/{/g, '<span class="hoverWord" style="background-color:#ffff99;">').replace(/}/g, '</span>');

                $("#FullStory").html(PassageTitle + FullPassage);
                $("#FullPassage").popup('open');
                $(".hoverWord").on("mouseover", function () {
                    $(this).addClass("currentword");
                    titletext = $("span.currentword").next().text();
                    $(".currentword").attr("title", titletext);
                    $(this).removeClass("currentword");
                });

            });
        }
        var questionIndex = 0;
        function buildContentFib(pageNumber, usedIn) {

            $("#stackContainer").empty();
            var htmlBuilder = "";
            var viewStackContainerHtml = "";
            $("#stackContainer label").removeClass("ui-btn-icon-left");

            arrActivities = $.grep(arrQuestionObjectsMaster, function (v) {
                return v.useIn.indexOf(usedIn) >= 0;
            });

            if (arrActivities.length == 0) {
                $("#DivMainContent").hide();
                $("#noContent").show();
            }
            else {

                $("#DivMainContent").show();
                $("#noContent").hide();
            }
            var displayOptionsHtml = "";
            var viewStackPrefixHtml = "<div id='myViewStack' class='myViewStack viewstackFIB'>";
            var fluidContainerPrefixHtml = "<div class='container-fluid' style='height:100%;'>";
            var fluidContainerSuffixHtml = "</div>";
            var dataWizardInitPrefixHtml = "<div data-wizard-init class='wizard' style='height:100%'>"
            var dataWizardInitSuffixHtml = "</div>"
            var unorderedListPrefixHtml = "<ul class='steps'>";
            var unorderedListSuffixHtml = "</ul>"
            var clearDivHtml = "<div style='clear:both;'></div>";
            for (var a = 0; a < arrActivities.length; a++) {

                currentQuestionObject = arrActivities[a];

                var stepItemHtml = "";
                var wizardStepContentPrefixHtml = "<div class='steps-content'>";
                var wizardStepContentSuffixHtml = "</div>";
                var stackChildPrefixHtml = "<div id='stack" + a + "' data-id='" + arrActivities[a].id + "'group-id='" + arrActivities[a].foundationGroupId + "' class='stackchild' style='width:100%; height:100%'>";
                var stackChildSuffixHtml = "</div>";
                var pictureIllustrationContainerPrefixHtml = "<div id='pictureIllustrationContainer" + a + "' style='display:none;' class='pictureIllustrationContainer'>";
                var pictureIllustrationContainerSuffixHtml = "</div>";
                var paragraphTrext = currentQuestionObject.desc.replace(/pagebreak/gi, "<br />");
                currentQuestionObject.desc = currentQuestionObject.desc.replace(/~/g, '<span class="synonym"  style="display:none">').replace(/#/g, '</span>');
                var pictureIllustrationContentHtml = "<h3 style='margin-top:-20px;font-size:20px;'>" + arrActivities[a].PassageTitle + "</h2><div style='display:inline-block;'><div class='tooltipimage' style='height:auto'><a href='#' onclick='imagePopup()' class='zoomimage'><img style='float:left;width:45%' id='pictureIllustration" + a + "' class='' src='" + currentQuestionObject.pictureSource + "' /><span class='tooltip-content-image'>Click on the image to Zoom</span></a></div>" + "<p style='float:right;width:48%;' id='passage" + a + "' class='pictureIllustration'>" + currentQuestionObject.desc.replace(/{/g, '<span class="hoverWord" style="background-color:#ffff99;">').replace(/}/g, '</span>') + "</p></div><img class='ReadMore' src='images/expand-arrows.png' style='height:20px;width:20px'/>";


                var wizardStepPrefixHtml = "";
                var wizardStepSuffixHtml = "</div>";
                var fullWizardStepsHtml = "";
                $("#pictureIllustration").attr("src", currentQuestionObject.pictureSource);
                for (var s = 0; s < currentQuestionObject.steps.length; s++) {

                    CurrentInnerQuestion = currentQuestionObject.steps[s];
                    var moduletextheader = CurrentInnerQuestion.head;
                    $("#moduleHeaderText span").html("<h3 style='margin-bottom:-10px;'>" + moduletextheader + "</h3>");
                    stepItemHtml += "<li data-step='" + (s + 1) + "'>Q</li>";

                    wizardStepPrefixHtml = "<div class='wizardstep step_" + (s + 1) + "' data-step='" + (s + 1) + "' id='ques" + currentQuestionObject.steps[s].id + "' >";

                    var stepNarrativePrefixHtml = "<div style='padding:10px;text-align:left;word-wrap:break-word'>";
                    var stepNarrativeSuffixHtml = "</div>";

                    var arrWordPositions = currentQuestionObject.steps[s].wordPositions.split(",");

                    var arrWordsInSentence = currentQuestionObject.steps[s].displayText.split(" ");

                    var arrDisplayOptions = currentQuestionObject.steps[s].display.split(",");
                    arrDisplayOptions = randomSortArray(arrDisplayOptions);

                    for (var w = 0; w < arrWordsInSentence.length; w++) {

                        if (arrWordPositions.indexOf(String(w + 1)) == -1) {
                            stepNarrativePrefixHtml += "<span class='textonly'>" + arrWordsInSentence[w] + "</span>&nbsp;";
                        }
                        else {
                            if (arrWordsInSentence[w].length <= 3) {
                                stepNarrativePrefixHtml += "&nbsp;<div id='box' class='regularBoxSmall fibRegularBox' style='display:inline-block;'><div style='min-width:45px;'><input class='keyin textinputSmall' id='txt_" + a + "_" + s + "_" + w + "'  type='text' data-option-rel='' data-enered-value='' data-value='" + arrWordsInSentence[w].replace(/'/g, "~") + "'/></div>&nbsp;&nbsp;<div></div></div>";
                            } else if (arrWordsInSentence[w].length <= 5) {
                                stepNarrativePrefixHtml += "&nbsp;<div id='box' class='regularBox fibRegularBox' style='display:inline-block;'><div style='min-width:60px;'><input class='keyin textinput' id='txt_" + a + "_" + s + "_" + w + "'  type='text' data-option-rel='' data-enered-value='' data-value='" + arrWordsInSentence[w].replace(/'/g, "~") + "'/></div>&nbsp;&nbsp;<div></div></div>";
                            } else {
                                stepNarrativePrefixHtml += "&nbsp;<div id='box' class='regularBoxLarge fibRegularBox' style='display:inline-block !important;'><div style='min-width:85px;'><input class='keyin textinputLarge' id='txt_" + a + "_" + s + "_" + w + "'  type='text' data-option-rel='' data-enered-value='' data-value='" + arrWordsInSentence[w].replace(/'/g, "~") + "'/></div>&nbsp;&nbsp;<div></div></div>";
                            }
                        }
                    }
                    var optionsContainerPrefixHtml = stepNarrativePrefixHtml + stepNarrativeSuffixHtml;
                    var optionsContainerSuffixHtml = "";
                    displayOptionsHtml = "";
                    htmlDisplayOption = "";
                    var htmlDisplayOptionsContainerPrefix = "<div class='fieldsetContainer'><fieldset data-role='controlgroup' style='text-align: center'  data-type='horizontal' id='optionsContainer" + s + "' class='ui-controlgroup ui-controlgroup-horizontal ui-corner-all'>"
                    var htmlDisplayOptionsContainerSuffix = "</fieldset></div>";

                    for (var d = 0; d < arrDisplayOptions.length; d++) {
                        htmlDisplayOption += "<input id='option_" + a + "_" + s + "_" + d + "' class='custom' type='checkbox' value='" + arrDisplayOptions[d].replace(/'/g, "~") + "'/><label id='label_" + a + "_" + s + "_" + d + "' for='option_" + a + "_" + s + "_" + d + "' class='ui-btn ui-corner-all ui-btn-inherit ui-checkbox-off ui-first-child' style='padding:5px !important;border-color:#808080 !important'>" + arrDisplayOptions[d] + "</label>";
                    }
                    htmlDisplayOption = htmlDisplayOptionsContainerPrefix + htmlDisplayOption + htmlDisplayOptionsContainerSuffix;
                    var optionsContainerPrefixHtml2 = "";
                    var optionsContainerSuffixHtml2 = "";

                    fullWizardStepsHtml += wizardStepPrefixHtml + htmlDisplayOption + optionsContainerPrefixHtml + htmlBuilder + optionsContainerSuffixHtml + optionsContainerPrefixHtml2 + optionsContainerSuffixHtml2 + clearDivHtml + wizardStepSuffixHtml;

                }


                var displaySelectionsListPrefixHtml = "";
                var displaySelectionsListfixHtml = "";
                var selectioPanelPrefixHtml = "";
                var selectioPanelSuffixHtml = "";
                var fullDisplayOptionsHtml = "";
                var displayOptionsSectionTitle = "";
                for (var s = 0; s < currentQuestionObject.steps.length; s++) {
                    displaySelectionsListPrefixHtml = "";
                    var displaySelectedOptions = "";
                    displayOptionsSectionTitle = "";
                    fullDisplayOptionsHtml += selectioPanelPrefixHtml + displayOptionsSectionTitle + displaySelectionsListPrefixHtml + displaySelectionsListfixHtml + clearDivHtml + selectioPanelSuffixHtml;
                }

                fullWizardStepsHtml +=
                    fullDisplayOptionsHtml;


                // Concat all required html components
                htmlBuilder +=
                    stackChildPrefixHtml +
                    pictureIllustrationContainerPrefixHtml +
                    pictureIllustrationContentHtml +
                    pictureIllustrationContainerSuffixHtml +
                    fluidContainerPrefixHtml +
                    dataWizardInitPrefixHtml +
                    unorderedListPrefixHtml +
                    stepItemHtml +
                    unorderedListSuffixHtml +
                    wizardStepContentPrefixHtml +
                    fullWizardStepsHtml +
                    wizardStepContentSuffixHtml +
                    dataWizardInitSuffixHtml +
                    fluidContainerSuffixHtml +
                    stackChildSuffixHtml;
            }
            viewStackContainerHtml = viewStackPrefixHtml + htmlBuilder + viewStackSuffixHtml;

            // Append generated html to the stackContainer Div
            // Note: the jquery wizard js is at the end of the file to init the wizard component after the html is appended.
            $("#stackContainer").append(viewStackContainerHtml);

            // Refresh checkboxes for applying style
            $("#stackContainer").find("input[type=checkbox]").checkboxradio();

            // Re-Init viewstack component
            viewStack = $("#myViewStack").viewstack({
                selectedIndex: 0,
                creationComplete: function (e, data) { },
                selectedIndexChanged: function (e, data) { }
            });
            setDefaultTextInputFocus();
            // remove left-icon from the checkbox
            $(".stackchild").css("display", "none");
            $("#stack" + pageNumber).css("display", "block");
            $("#pictureIllustrationContainer1").css("display", "none");
            $("#stackContainer label").removeClass("ui-btn-icon-left");
            if ($("#imtFIb").hasClass("activecontainer")) {
                $("#DivLeft").css("opacity", "0.1");
                $("#light-pagination").css("opacity", "0.1");
                $(".rightpagination").attr("title", "");
                $(".container-fluid").css("display", "blcok");
                $(".pictureIllustrationContainer").css("display", "none");
                $("#box").css("display", "block");
                $("#Backbutton").css("display", "inline-block");
                $(".ShowCheckDiv").css("display", "block");
            }
            else {
                $("#DivLeft").css("opacity", "1");
                $(".rightpagination").attr("title", "Click on the ellipses(3 dots) to specify a page number");
                $("#light-pagination").css("opacity", "1");
                $(".container-fluid").css("display", "none");
                $(".pictureIllustrationContainer").css("display", "block");
                $("#Backbutton").css("display", "none");
            }
            $("#stackContainer").find("input[type=radio]").checkboxradio();
            buildBloomsTaxonomy(0);
            $(".hoverWord").on("mouseover", function () {

                $(this).addClass("currentword");

                titletext = $("span.currentword").next().text();
                $(".currentword").attr("title", titletext);

                $(this).removeClass("currentword");
                // $("li.third-item").next()
            });

            // Reinitialize the wizard
            $(".wizard").each(function () {
                $(this)['wizardByGiro']({});
            });
            $(".ReadMore").click(function () {
                var PassageTitle = "<h3 style='font-size:20px;text-align:center'>" + arrQuestionObjectsMaster[currentPageNumber].PassageTitle + " </h3>";
                var FullPassage = arrQuestionObjectsMaster[currentPageNumber].desc.replace(/{/g, '<span class="hoverWord" style="background-color:#ffff99;">').replace(/}/g, '</span>');

                $("#FullStory").html(PassageTitle + FullPassage);
                $("#FullPassage").popup('open');
                $(".hoverWord").on("mouseover", function () {
                    $(this).addClass("currentword");
                    titletext = $("span.currentword").next().text();
                    $(".currentword").attr("title", titletext);
                    $(this).removeClass("currentword");
                });

            });

        }
        var questionIndex = 0;
        function buildContentMat(pageNumber, usedIn) {

            $("#stackContainer").empty();
            var htmlBuilder = "";
            var viewStackContainerHtml = "";
            $("#stackContainer label").removeClass("ui-btn-icon-left");

            arrActivities = $.grep(arrQuestionObjectsMaster, function (v) {
                return v.useIn.indexOf(usedIn) >= 0;
            });

            if (arrActivities.length == 0) {
                $("#DivMainContent").hide();
                $("#noContent").show();
            }
            else {

                $("#DivMainContent").show();
                $("#noContent").hide();
            }
            var displayOptionsHtml = "";
            var viewStackPrefixHtml = "<div id='myViewStack' class='myViewStack viewstackMat'>";
            var fluidContainerPrefixHtml = "<div class='container-fluid' style='height:100%;'>";
            var fluidContainerSuffixHtml = "</div>";
            var dataWizardInitPrefixHtml = "<div data-wizard-init class='wizard' style='height:100%'>"
            var dataWizardInitSuffixHtml = "</div>"
            var unorderedListPrefixHtml = "<ul class='steps' id='step" + currentPageNumber + "'>";
            var unorderedListSuffixHtml = "</ul>"
            var clearDivHtml = "<div style='clear:both;'></div>";

            for (var a = 0; a < arrActivities.length; a++) {
                currentQuestionObject = arrActivities[a];

                var stepItemHtml = "";
                var wizardStepContentPrefixHtml = "<div class='steps-content'>";
                var wizardStepContentSuffixHtml = "</div>";
                var stackChildPrefixHtml = "<div id='stack" + a + "' data-id='" + arrActivities[a].id + "'group-id='" + arrActivities[a].foundationGroupId + "' class='stackchild' style='width:100%; height:100%'>";
                var stackChildSuffixHtml = "</div>";
                var pictureIllustrationContainerPrefixHtml = "<div id='pictureIllustrationContainer" + a + "' style='display:none;' class='pictureIllustrationContainer'>";
                var pictureIllustrationContainerSuffixHtml = "</div>";
                var paragraphTrext = currentQuestionObject.desc.replace(/pagebreak/gi, "<br />");
                currentQuestionObject.desc = currentQuestionObject.desc.replace(/~/g, '<span class="synonym"  style="display:none">').replace(/#/g, '</span>');
                var pictureIllustrationContentHtml = "<h3 style='margin-top:-20px;font-size:20px;'>" + arrActivities[a].PassageTitle + "</h2><div style='display:inline-block;'><div class='tooltipimage' style='height:auto'><a href='#' onclick='imagePopup()' class='zoomimage'><img style='float:left;width:45%' id='pictureIllustration" + a + "' class='' src='" + currentQuestionObject.pictureSource + "' /><span class='tooltip-content-image'>Click on the image to Zoom</span></a></div>" + "<p style='float:right;width:48%;' id='passage" + a + "' class='pictureIllustration'>" + currentQuestionObject.desc.replace(/{/g, '<span class="hoverWord" style="background-color:#ffff99;">').replace(/}/g, '</span>') + "</p></div><img class='ReadMore' src='images/expand-arrows.png' style='height:20px;width:20px'/>";


                var wizardStepPrefixHtml = "";
                var wizardStepSuffixHtml = "</div>";
                var fullWizardStepsHtml = "";
                var arrCorrectAnswer = [];
                var arrCorrectAnswerUNrandomize;
                var arrDisplayword;


                $("#pictureIllustration").attr("src", currentQuestionObject.pictureSource);

                for (var s = 0; s < currentQuestionObject.steps.length; s++) {
                    var premiseHtml = "";
                    var responseHtml = "";

                    CurrentInnerQuestion = currentQuestionObject.steps[s];
                    var moduletextheader = CurrentInnerQuestion.head;
                    $("#moduleHeaderText span").html("<h3 style='margin-bottom:-10px;'>" + moduletextheader + "</h3>");
                    arrCorrectAnswer = [];
                    stepItemHtml += "<li data-step='" + (s + 1) + "' class=" + (s + 1) + ">Q</li>";
                    wizardStepPrefixHtml = "<div class='step_" + (s + 1) + "' data-step='" + (s + 1) + "' id='ques" + currentQuestionObject.steps[s].id + "' >";
                    var optionsContainerSuffixHtml = "";
                    displayOptionsHtml = "";

                    for (var d = 0; d < currentQuestionObject.steps[s].options.length; d++) {
                        arrCorrectAnswer.push(currentQuestionObject.steps[s].options[d].correctAnswer);
                    }

                    if (usedMode == "L") {
                        arrCorrectAnswer = arrCorrectAnswer;
                    }
                    else {
                        arrCorrectAnswer = randomSortArray(arrCorrectAnswer);
                    }
                    for (var d = 0; d < currentQuestionObject.steps[s].options.length; d++) {

                        arrCorrectAnswerUNrandomize = currentQuestionObject.steps[s].options[d].correctAnswer;
                        arrDisplayword = currentQuestionObject.steps[s].options[d].displayWord;
                        premiseHtml += "<li class='premise sortablepremise' data-menu-id='" + currentQuestionObject.steps[s].options[d].id + "' data-menu-value= '" + arrCorrectAnswerUNrandomize + "'><div class='matchwords'>" + arrDisplayword + "</div></li>";
                        responseHtml += "<li class='response sortableresponse' ><div class='matchwords'>" + arrCorrectAnswer[d] + "</div></li>";

                    }

                    premiseHtml = "<div style='display:inline-block'><ul class='sortable1'>" + premiseHtml + "</ul></div>";
                    responseHtml = "<div style='display:inline-block'><ul class='sortable2'>" + responseHtml + "</ul></div>";
                    var optionsContainerPrefixHtml2 = "";
                    var optionsContainerSuffixHtml2 = "";
                    fullWizardStepsHtml += wizardStepPrefixHtml + premiseHtml + responseHtml + optionsContainerSuffixHtml + optionsContainerPrefixHtml2 + optionsContainerSuffixHtml2 + clearDivHtml + wizardStepSuffixHtml;

                }
                var displaySelectionsListPrefixHtml = "";
                var displaySelectionsListfixHtml = "";
                var selectioPanelPrefixHtml = "";
                var selectioPanelSuffixHtml = "";
                var fullDisplayOptionsHtml = "";
                var displayOptionsSectionTitle = "";
                // for (var s = 0; s < currentQuestionObject.steps.length; s++) {
                displaySelectionsListPrefixHtml = "";
                var displaySelectedOptions = "";
                displayOptionsSectionTitle = "";
                fullDisplayOptionsHtml += selectioPanelPrefixHtml + displayOptionsSectionTitle + displaySelectionsListPrefixHtml + displaySelectionsListfixHtml + clearDivHtml + selectioPanelSuffixHtml;
                // }

                fullWizardStepsHtml +=
                    fullDisplayOptionsHtml;


                // Concat all required html components
                htmlBuilder +=
                    stackChildPrefixHtml +
                    pictureIllustrationContainerPrefixHtml +
                    pictureIllustrationContentHtml +
                    pictureIllustrationContainerSuffixHtml +
                    fluidContainerPrefixHtml +
                    dataWizardInitPrefixHtml +
                    unorderedListPrefixHtml +
                    stepItemHtml +
                    unorderedListSuffixHtml +
                    wizardStepContentPrefixHtml +
                    fullWizardStepsHtml +
                    wizardStepContentSuffixHtml +
                    dataWizardInitSuffixHtml +
                    fluidContainerSuffixHtml +
                    stackChildSuffixHtml;

            }
            viewStackContainerHtml = viewStackPrefixHtml + htmlBuilder + viewStackSuffixHtml;

            // Append generated html to the stackContainer Div
            // Note: the jquery wizard js is at the end of the file to init the wizard component after the html is appended.
            $("#stackContainer").append(viewStackContainerHtml);

            // Refresh checkboxes for applying style
            $("#stackContainer").find("input[type=checkbox]").checkboxradio();
            // Re-Init viewstack component
            viewStack = $("#myViewStack").viewstack({
                selectedIndex: 0,
                creationComplete: function (e, data) { },
                selectedIndexChanged: function (e, data) { }
            });
            $(".stackchild").css("display", "none");
            $("#stack" + pageNumber).css("display", "block");
            $("#pictureIllustrationContainer1").css("display", "none");
            // remove left-icon from the checkbox
            $("#stackContainer label").removeClass("ui-btn-icon-left");

            $("#stackContainer").find("input[type=radio]").checkboxradio();

            if ($("#imtVocabulary").hasClass("activecontainer")) {
                $("#DivLeft").css("opacity", "0.1");
                $("#light-pagination").css("opacity", "0.1");
                $(".rightpagination").attr("title", "");
                $(".container-fluid").css("display", "blcok");
                $(".pictureIllustrationContainer").css("display", "none");
                $("#Backbutton").css("display", "inline-block");
                $(".ShowCheckDiv").css("display", "block");
            }
            else {
                $("#DivLeft").css("opacity", "1");
                $("#light-pagination").css("opacity", "1");
                $(".rightpagination").attr("title", "Click on the ellipses(3 dots) to specify a page number");
                $(".container-fluid").css("display", "none");
                $(".pictureIllustrationContainer").css("display", "block");
                $("#Backbutton").css("display", "none");
                initPaginator();
            }

            // to show no content div when data is not there in perticular page
            if ($("#stack" + currentPageNumber).find("ul li").length == 0) {

                $("#DivMainContent").hide();
                $("#noContent").show();
            }
            else {

                $("#DivMainContent").show();
                $("#noContent").hide();
            }
            buildBloomsTaxonomy(0);
            $(".hoverWord").on("mouseover", function () {

                $(this).addClass("currentword");

                titletext = $("span.currentword").next().text();
                $(".currentword").attr("title", titletext);

                $(this).removeClass("currentword");

            });

            // Reinitialize the wizard
            $(".wizard").each(function () {
                $(this)['wizardByGiro']({});
            });
            $("#rightAnswer_mat").click(function () {
                $("#rightAnswer_mat").hide();
                $("#Backbutton").hide();
            });
            $(".sortable2").sortable({
                items: 'li',
                connectWith: ".connectedSortable",
                stop: handleSortStop

            }).disableSelection();
            $(".ReadMore").click(function () {
                var PassageTitle = "<h3 style='font-size:20px;text-align:center'>" + arrQuestionObjectsMaster[currentPageNumber].PassageTitle + " </h3>";
                var FullPassage = arrQuestionObjectsMaster[currentPageNumber].desc.replace(/{/g, '<span class="hoverWord" style="background-color:#ffff99;">').replace(/}/g, '</span>');

                $("#FullStory").html(PassageTitle + FullPassage);
                $("#FullPassage").popup('open');
                $(".hoverWord").on("mouseover", function () {
                    $(this).addClass("currentword");
                    titletext = $("span.currentword").next().text();
                    $(".currentword").attr("title", titletext);
                    $(this).removeClass("currentword");
                });

            });

        }
        function handleSortStop(event, ui) {
            if ($(ui.item).hasClass("correct")) {
                $(ui.item).removeClass("correct");
                $(ui.item).css({ 'position': 'relative', 'left': 0 });
            }
            else {
                $(ui.item).addClass("correct");
                $(ui.item).css({ 'position': 'relative', 'left': -35 });
                $(ui.item).addClass("attached");
            }
        }
        function randomSortArray(arr) {
            for (var j, x, i = arr.length; i; j = parseInt(Math.random() * i), x = arr[--i], arr[i] = arr[j], arr[j] = x);
            return arr;
        };
        function buildBloomsTaxonomy(pageNumber) {
            for (var b = 0; b <= 5; b++) {
                $(".p" + (b + 1) + "grey > a > img").attr("src", "images/pyramid/pyramid_0" + (b + 1) + "Grey.png");
                $(".g" + (b + 1) + " > div > p").removeClass();
                $(".g" + (b + 1) + " > div > p").addClass("btContentGrey");
            }



            for (var b = 0; b < arrQuestionObjectsMaster[pageNumber].bloomsTaxonomy.length; b++) {
                var blockId = arrQuestionObjectsMaster[pageNumber].bloomsTaxonomy[b];
                var newBlockId = bloomPlaceholders[parseInt(blockId) - 1];
                var oldImage = $(".p" + newBlockId + "grey > a > img").attr("src");
                var newImage = oldImage.replace("Grey.png", ".png");
                $(".p" + newBlockId + "grey > a > img").attr("src", newImage);
                flag[blockId - 1] = false;
            }
            flag.reverse();

            for (var t = 0; t < 6; t++) {
                updateTooltipTheme(t + 1, flag[t], bloomsTaxonomyContentText[t][0]);
            }
            flag.reverse();
        }

        function buildCorrectAnswer(pageNumber) {

            $("#backtohome").show();
            $("#checkanswer").hide();
            $("#light-pagination").hide();
            $("#showAnswer").hide();
            $("#stackContainer").hide();
            $("#correctAnswerContainer").empty();
            var correctAnswerHtmlBuilder = "";
            var viewStackContainerHtml = "";
            var correctAnswerObject = arrQuestionObjectsMaster[pageNumber];
            var displayOptionsHtml = "";
            var viewStackPrefixHtml = "<div id='myViewStack' class='myViewStack viewstackMat'>";
            var fluidContainerPrefixHtml = "<div class='container-fluid' style='height:100%;'>";
            var fluidContainerSuffixHtml = "</div>";
            var dataWizardInitPrefixHtml = "<div data-wizard-init class='wizard' style='height:100%'>"
            var dataWizardInitSuffixHtml = "</div>"
            var unorderedListPrefixHtml = "<ul class='steps'>";
            var unorderedListSuffixHtml = "</ul>"
            var clearDivHtml = "<div style='clear:both;'></div>";

            currentQuestionObject = arrQuestionObjectsMaster[currentPageNumber];
            var stepItemHtml = "";
            var wizardStepContentPrefixHtml = "<div class='steps-content'>";
            var wizardStepContentSuffixHtml = "</div>";
            var stackChildPrefixHtml = "<div id='stack" + currentPageNumber + "' data-id='" + arrQuestionObjectsMaster[currentPageNumber].id + "' class='stackchild' style='width:100%; height:100%'>";
            var stackChildSuffixHtml = "</div>";
            var pictureIllustrationContainerPrefixHtml = "<div id='pictureIllustrationContainer" + currentPageNumber + "' style='display:none;' class='pictureIllustrationContainer'>";
            var pictureIllustrationContainerSuffixHtml = "</div>";
            var paragraphTrext = currentQuestionObject.desc.replace(/pagebreak/gi, "<br />");
            var pictureIllustrationContentHtml = "<div style='display:inline-block;'><img style='float:left;width:45%' id='pictureIllustration" + currentPageNumber + "' class='' src='" + currentQuestionObject.pictureSource + "' />" + "<p style='float:right;width:48%;' id='passage" + currentPageNumber + "' class='pictureIllustration'>" + currentQuestionObject.desc + "</p></div>";
            var wizardStepPrefixHtml = "";
            var wizardStepSuffixHtml = "</div>";
            var fullWizardStepsHtml = "";
            var arrCorrectAnswer = [];
            var arrCorrectAnswerUNrandomize;
            var arrDisplayword;
            var premiseHtml = "";
            var responseHtml = "";


            $("#pictureIllustration").attr("src", currentQuestionObject.pictureSource);
            for (var s = 0; s < currentQuestionObject.steps.length; s++) {

                correctAnswerHtmlBuilder = '';

                CurrentInnerQuestion = currentQuestionObject.steps[s];
                premiseHtml = "";
                responseHtml = "";
                stepItemHtml += "<li data-step='" + (s + 1) + "' class=" + (s + 1) + ">Q</li>";
                wizardStepPrefixHtml = "<div class='step_" + (s + 1) + " " + (s + 1) + " ' data-step='" + (s + 1) + "' id='ques" + currentQuestionObject.steps[s].id + "' >";
                var optionsContainerSuffixHtml = "";
                displayOptionsHtml = "";







                for (var d = 0; d < correctAnswerObject.steps[s].options.length; d++) {

                    premiseHtml += "<li class='premise sortablepremise'  id='p " + (d + 1) + "' data-menu-id='" + correctAnswerObject.steps[s].options[d].id + "'><div class='matchwords'>" + correctAnswerObject.steps[s].options[d].displayWord + "</div></li>";
                    responseHtml += "<li class='response sortableresponse' id='r" + (d + 1) + "' ><div class='matchwords'>" + correctAnswerObject.steps[s].options[d].correctAnswer + "</div></li>";
                }


                premiseHtml = "<div style='display:inline-block'><ul class='sortable1'>" + premiseHtml + "</ul></div>";

                responseHtml = "<div style='display:inline-block'><ul class='sortable2'>" + responseHtml + "</ul></div>";

                var optionsContainerPrefixHtml2 = "";
                var optionsContainerSuffixHtml2 = "";

                fullWizardStepsHtml += wizardStepPrefixHtml + premiseHtml + responseHtml + optionsContainerSuffixHtml + optionsContainerPrefixHtml2 + optionsContainerSuffixHtml2 + clearDivHtml + wizardStepSuffixHtml;
            }

            var displaySelectionsListPrefixHtml = "";
            var displaySelectionsListfixHtml = "";
            var selectioPanelPrefixHtml = "";
            var selectioPanelSuffixHtml = "";
            var fullDisplayOptionsHtml = "";
            var displayOptionsSectionTitle = "";
            // for (var s = 0; s < currentQuestionObject.steps.length; s++) {
            displaySelectionsListPrefixHtml = "";
            var displaySelectedOptions = "";
            displayOptionsSectionTitle = "";
            fullDisplayOptionsHtml += selectioPanelPrefixHtml + displayOptionsSectionTitle + displaySelectionsListPrefixHtml + displaySelectionsListfixHtml + clearDivHtml + selectioPanelSuffixHtml;
            // }

            fullWizardStepsHtml +=
                fullDisplayOptionsHtml;


            // Concat all required html components
            correctAnswerHtmlBuilder +=
                stackChildPrefixHtml +
                pictureIllustrationContainerPrefixHtml +
                pictureIllustrationContentHtml +
                pictureIllustrationContainerSuffixHtml +
                fluidContainerPrefixHtml +
                dataWizardInitPrefixHtml +
                unorderedListPrefixHtml +
                stepItemHtml +
                unorderedListSuffixHtml +
                wizardStepContentPrefixHtml +
                fullWizardStepsHtml +
                wizardStepContentSuffixHtml +
                dataWizardInitSuffixHtml +
                fluidContainerSuffixHtml +
                stackChildSuffixHtml;

            viewStackContainerHtml = viewStackPrefixHtml + correctAnswerHtmlBuilder + viewStackSuffixHtml;

            $("#correctAnswerContainer").html(correctAnswerHtmlBuilder);


            viewStack = $("#myViewStack").viewstack({
                selectedIndex: 0,
                creationComplete: function (e, data) { },
                selectedIndexChanged: function (e, data) { }
            });

            buildBloomsTaxonomy(0);
            initPaginator();
            $(".hoverWord").on("mouseover", function () {

                $(this).addClass("current");

                titletext = $("span.current").next().text();
                $(".current").attr("title", titletext);

                $(this).removeClass("current");
                // $("li.third-item").next()
            });
            // Reinitialize the wizard

            $(".wizard").each(function () {
                $(this)['wizardByGiro']({});

            });


            $(".sortable2").sortable({
                items: 'li',
                connectWith: ".connectedSortable",
                stop: handleSortStop

            }).disableSelection();

        }


        function updateTooltipTheme(idSuffix, isDisabled, content1, content2) {
            var themeName = "";
            if (isDisabled == true) {
                themeName = "tooltipster-bloom-grey";
            }
            else {
                themeName = "tooltipster-bloom-" + idSuffix;
            }

            $("#bloom_" + idSuffix).tooltipster({
                theme: themeName,
                multiple: true,
                position: "top",
                touchDevices: true,
                contentAsHTML: true,
                content: content1
            });

            var bloomTooltipsterObjects = $("#bloom_" + idSuffix).tooltipster({
                theme: themeName,
                multiple: true,
                position: "bottom",
                contentAsHTML: true,
                touchDevices: true,
                content: content2
            });
        }
        var arrTextControls = [];
        incrementCount = -1;
        function setDefaultTextInputFocus() {
            $("#stack" + currentPageNumber).find(".step_" + activeStepNo).find('.keyin').each(function () {
                if ($(this).val().trim().length == 0) {
                    activeTextInput = $(this);
                    return false;
                }
            });

            //var keyinLength = $("#stack" + currentPageNumber).find(".step_" + activeStepNo).find('.keyin').length;
            //// var keyinLength = $("#stack" + currentPageNumber).find('.keyin').length;
            // incrementCount++;
            // if (incrementCount >= keyinLength) {
            //     incrementCount = 0;
            // }
            // activeTextInput = $("#stack" + currentPageNumber).find(".step_" + activeStepNo).find('.keyin')[incrementCount];
        }

        var isDisabled;
    </script>

    <!--randomize word-->
    <script>
        String.prototype.shuffle = function () {
            var a = this.split(""),
                n = a.length;

            for (var i = n - 1; i > 0; i--) {
                var j = Math.floor(Math.random() * (i + 1));
                var tmp = a[i];
                a[i] = a[j];
                a[j] = tmp;
            }
            return a.join("");
        }
        function InitializeThemes() {

            $("#ulMenuItem li").each(function () {

                $("#imptcmprntion").removeClass("InactiveMenu");
                $("#imtVocabulary").removeClass("InactiveMenu");
                $("#imtJumbledWords").removeClass("InactiveMenu");
                $("#imptQandA").removeClass("InactiveMenu");
                $("#imtSpelling").removeClass("InactiveMenu");
                $("#imtFIb").removeClass("InactiveMenu");
                var menuItemli = $(this);
                var PassageId = $("#stack" + currentPageNumber).attr("group-id");
                $(this).attr("PassageId", PassageId);
                for (m = 0; m < arrMenuObjects.length; m++) {

                    if (arrMenuObjects[m].id == PassageId) {
                        if (arrMenuObjects[m].title.indexOf("Comprehension") > -1) {
                            $("#imptcmprntion").addClass("ActiveMenu");
                            $("#imptcmprntion").css("pointer-events", "painted");
                            $("#imptcmprntion").attr("data-leanmode", arrMenuObjects[m].learn);

                        } else {
                            $("#imptcmprntion").addClass("InactiveMenu");
                            $("#imptcmprntion").css("pointer-events", "none");
                            $("#imptcmprntion").attr("data-leanmode", arrMenuObjects[m].learn);
                        }
                        if (arrMenuObjects[m].title.indexOf("Vocabulary") > -1) {
                            $("#imtVocabulary").addClass("ActiveMenu");
                            $("#imtVocabulary").css("pointer-events", "painted");
                            $("#imtVocabulary").attr("data-leanmode", arrMenuObjects[m].learn);
                        } else {
                            $("#imtVocabulary").addClass("InactiveMenu");
                            $("#imtVocabulary").css("pointer-events", "none");
                            $("#imtVocabulary").attr("data-leanmode", arrMenuObjects[m].learn);
                        }
                        if (arrMenuObjects[m].title.indexOf("Jumbledwords") > -1) {
                            $("#imtJumbledWords").addClass("ActiveMenu");
                            $("#imtJumbledWords").css("pointer-events", "painted");
                            $("#imtJumbledWords").attr("data-leanmode", arrMenuObjects[m].learn);
                        } else {
                            $("#imtJumbledWords").addClass("InactiveMenu")
                            $("#imtJumbledWords").css("pointer-events", "none");
                        }
                        if (arrMenuObjects[m].title.indexOf("Fillintheblanks") > -1) {
                            $("#imtFIb").addClass("ActiveMenu");
                            $("#imtFIb").css("pointer-events", "painted");
                            $("#imtFIb").attr("data-leanmode", arrMenuObjects[m].learn);
                        } else {
                            $("#imtFIb").addClass("InactiveMenu")
                            $("#imtFIb").css("pointer-events", "none");
                            $("#imtFIb").attr("data-leanmode", arrMenuObjects[m].learn);
                        }
                        if (arrMenuObjects[m].title.indexOf("Spelling") > -1) {
                            $("#imtSpelling").addClass("ActiveMenu");
                            $("#imtSpelling").css("pointer-events", "painted");
                            $("#imtSpelling").attr("data-leanmode", arrMenuObjects[m].learn);
                        } else {
                            $("#imtSpelling").addClass("InactiveMenu");
                            $("#imtSpelling").css("pointer-events", "none");
                            $("#imtSpelling").attr("data-leanmode", arrMenuObjects[m].learn);
                        }
                        if (arrMenuObjects[m].title.indexOf("QandA") > -1) {
                            $("#imptQandA").addClass("ActiveMenu");
                            $("#imptQandA").css("pointer-events", "painted");
                            $("#imptQandA").attr("data-leanmode", arrMenuObjects[m].learn);
                        } else {
                            $("#imptQandA").css("pointer-events", "none");
                            $("#imptQandA").addClass("InactiveMenu");
                            $("#imptQandA").attr("data-leanmode", arrMenuObjects[m].learn);
                        }

                    }

                }
                //divya

            });
        }


    </script>

    <style>
        .ui-sortable-placeholder {
            display: inline-block;
            height: 2.5em;
        }

        .myViewStack {
            height: 100%;
            width: 100%;
        }

        [data-wizard-init] {
            margin: auto;
            width: 95%;
            height: 100%;
        }

        .displaySelectionPanel {
            border: 1px solid #d4d4d4;
            background-color: #eff9f0;
            padding: 5px;
            margin-right: 5px;
            margin-top: 5px;
            display: inline-block;
            text-align: center;
            vertical-align: bottom;
        }

        .displayList {
            width: 100%;
            text-align: center;
            min-height: 20px;
            list-style-type: none;
            padding: 10px 0 10px 0;
            float: left;
            margin: -20px 0 0 0;
            list-style-position: inside;
            background-color: transparent !important;
            border-style: none;
        }

        .displayList li {
            text-align: center;
            margin: 0 5px 5px 5px;
            padding: 5px;
            font-size: 1.2em;
            min-width: 100px;
            background-color: #ededed !important;
            color: #000 !important;
        }


        .pictureIllustrationContainer {
            width: 95%;
            margin: 10px 20px -5px 10px;
            padding: 10px;
            text-align: center;
        }

        .pictureIllustration {
            height: 270px;
            overflow: hidden;
            font-size: 1.2em;
            margin-top: -10px;
            line-height: 25px;
            text-align: justify;
            padding: 5px;
            overflow: hidden;
        }

        .textAreaWrapper {
            border: 0 solid #999999;
            margin: 5px 5px 0 0;
        }

        .customTextArea {
            width: 100%;
            background-color: #eff9f0;
            font-size: 1.2em;
            color: #000;
        }

        .wizardnavbutton:hover {
            background-color: #64ce80 !important;
            color: #fff !important;
        }

        .wizardnavbutton {
            cursor: pointer;
            float: left;
            color: #000 !important;
            text-decoration: none;
            font-size: 1em !important;
            line-height: 24px;
            font-weight: normal;
            text-align: center;
            border: 1px solid #BBB;
            min-width: 14px;
            padding: 0 7px !important;
            margin: 0 5px 0 0;
            border-radius: 3px;
            background: #e6f7ff !important;
            /* Old browsers */
            background: -moz-linear-gradient(top, #e6f7ff 0%, #e6f7ff 100%);
            /* FF3.6+ */
            background: -webkit-gradient(linear, left top, left bottom, color-stop(0%, #e6f7ff), color-stop(100%, #e6f7ff));
            /* Chrome,Safari4+ */
            background: -webkit-linear-gradient(top, #e6f7ff 0%, #e6f7ff 100%);
            /* Chrome10+,Safari5.1+ */
            background: -o-linear-gradient(top, #e6f7ff 0%, #e6f7ff 100%);
            /* Opera11.10+ */
            background: -ms-linear-gradient(top, #e6f7ff 0%, #e6f7ff 100%);
            /* IE10+ */
            background: linear-gradient(top, #e6f7ff 0%, #e6f7ff 100%);
            /* W3C */
            text-shadow: none;
        }

        .btn-wizard-previous {
            display: inline-block;
            float: left;
            margin-top: 10px;
            width: 110px;
            padding: 10px 20px 10px 10px !important;
        }

        .btn-wizard-next {
            display: inline-block;
            float: right;
            text-align: right;
            margin-top: 10px;
            width: 110px;
            padding: 10px 20px 10px 10px !important;
        }

        .ui-checkbox {
            border-color: #808080 !important;
        }

        .ui-icon-check:after,
        html .ui-btn.ui-checkbox-on.ui-checkbox-on:after {
            visibility: hidden !important;
        }

        .ui-btn.ui-checkbox-off:after {
            visibility: hidden;
        }

        .ui-checkbox-off {
            background: #fff !important;
            font-size: 17px !important;
            font-weight: 400 !important;
        }

        .ui-checkbox-on {
            font-size: 17px !important;
            font-weight: 400 !important;
        }

        .fieldsetcontaniner {
            margin-top: 15px !important;
        }

        .ui-checkbox label:hover {
            font-weight: 400 !important;
        }

        body {
            font-family: 'OpenSans-Regular' !important;
        }

        .BoxGrammar {
            display: inline-block;
            margin-right: 3px !important;
        }

        .hintcont {
            position: relative;
            top: -50px;
        }

        ui-checkbox label {
            background-color: #e7edf4 !important;
        }



        .ui-checkbox label:hover {
            background-color: #64ce80 !important;
            color: #fff !important;
            text-shadow: none !important;
        }

        .ui-btn {
            /*padding: 0.7em 1em !important;*/
            line-height: 1.4 !important;
        }

        .ui-checkbox .ui-btn {
            min-width: 30px !important;
            margin: 0px !important;
            text-align: center !important;
        }

        .ui-btn,
        label.ui-btn {
            border-style: none !important;
            border-width: 1px;
            border-style: solid;
        }

        label.ui-btn {
            background-color: #e7edf4 !important;
            font-weight: 500 !important;
        }

        .ui-checkbox {
            border-radius: 3px !important;
            margin: 3px;
        }

        fieldset.ui-controlgroup {
            margin: 0em 0 !important;
        }

        .correctBox>div+div {
            width: 1.7em;
            /*height: 1.3em;
                border: 0.1em solid #999999;
                left: 1.1em;
                top: -1.3em;*/
        }

        .wrongBox>div+div {
            width: 1.7em;
            /*height: 1.3em;
                border: 0.1em solid #999999;
                left: 1.1em;
                top: -1.3em;*/
        }

        #hintContainer {
            float: right;
            background-color: #e4e0b4;
        }


        /*today for button need to put in css*/
        .ui-grid-a {
            overflow: initial !important;
        }

        .radiobtn {
            padding: 2px 3px !important;
            border: 1px solid #bbb !important;
            background-color: #e6f7ff !important;
            line-height: 29px !important;
        }

        .ui-controlgroup-controls {
            margin-top: -1px;
        }

        .ui-radio .ui-btn.ui-radio-on:after {
            display: none !important;
        }

        .ui-radio .ui-btn.ui-radio-on {
            background-color: #dd619e !important;
            font-size: 16px !important;
        }

        .ui-btn.ui-radio-off:after {
            display: none !important;
        }

        .ui-btn {
            white-space: normal !important;
        }

        .ui-radio label {
            margin-top: -9px !important;
            height: 22px;
            border-radius: 0px !important;
            font-size: 20px;
            padding-left: 2px !important;
        }

        .ui-radio .ui-radio-on {
            height: 24px;
            padding: 4px !important;
        }

        .ui-radio label:hover {
            text-shadow: none !important;
            background-color: #64ce80 !important;
            color: #fff !important;
        }

        .ui-radio .ui-btn {
            text-shadow: none !important;
        }

        .ui-radio-off:hover {
            background-color: #64ce80 !important;
        }

        .ui-radio-off {
            margin-top: -20px !important;
            padding: 5px !important;
            border-radius: 0px !important;
            background-color: #e7edf4 !important;
        }

        .ui-radio-on {
            margin-top: -20px !important;
            padding: 5px !important;
            border-radius: 0px !important;
            background-color: red !important;
        }

        .controlbuttons .ui-controlgroup-controls .ui-radio .ui-radio-on {
            padding: 4px !important;
        }

        .regularBoxradio {
            width: 70%;
            margin: 0px auto;
        }

        .ui-radio .ui-radio-off {
            font-weight: 500 !important;
            color: #000000;
        }

        .ShowCheckDiv {
            clear: both;
        }

        .bottom-actions {
            display: none;
        }

        /*for radio buttons*/
        .regularBoxradio>div+div {
            right: -2.2em;
            top: -0.1em;
            background-image: none !important;
            background-color: #F6FDF3 !important;
            border: none !important;
        }

        .wrongBoxradio {
            width: 70%;
            margin: 0px auto;
        }

        .wrongBoxradio>div+div {
            right: -2.2em;
            top: -0.1em;
            background-color: #fff !important;
            border: none !important;
        }

        .CorrectBoxradio {
            width: 70%;
            margin: 0px auto;
        }

        .CorrectBoxradio>div+div {
            right: -2.2em;
            top: -0.1em;
            background-color: #fff !important;
            border: none !important;
        }

        .wizard .steps-content .step-pane {
            padding: 0px;
        }

        .wizard ul.steps>li.active {
            background-color: #A1D685;
        }

        .wizard ul.steps>li.active .step-index .label {
            border-color: #A1D685 !important;
            background-color: #A1D685 !important;
            color: #fff;
        }

        .wizard ul.steps>li.active {
            color: #fff !important;
        }

        .disableddiv {
            pointer-events: none !important;
            opacity: 0.4 !important;
        }

        .ui-page-theme-a .ui-btn {
            border-color: #ddd;
            border-radius: 0 !important;
        }

        /*for math implementation*/

        .sortable1,
        .sortable2 {
            border-style: none;
            width: 142px;
            min-height: 20px;
            list-style-type: none;
            margin: 0;
            padding: 5px 0 0 0;
            float: left;
        }

        .sortable1 li {
            margin: -3px 5px -2px 5px;
            padding-top: 14%;
            text-align: center;
            font-size: 1em;
            width: 320px;
            height: 58px;
            background: url("img/img_01_hover.png") no-repeat center center;
            cursor: pointer;
            background-size: contain;
            cursor: pointer;
            word-break: break-word;
        }

        .sortable2 li {
            margin: 0px 5px -4px 195px;
            padding-top: 20px;
            text-align: center;
            font-size: 1em;
            width: 277px;
            height: 59px;
            cursor: pointer;
            cursor: pointer;
            word-break: break-word;
        }

        .hrbtm {
            margin-bottom: 25px;
        }

        .sortable1Updated {
            margin: 0 5px -30px 25px !important;
        }

        .sortable2Updated {
            margin: 0 5px -30px 135px !important;
        }

        .matchwords {
            text-align: center;
            word-wrap: break-word;
            padding: 0px 25px;
        }

        .response {
            background: url("img/img_02.png") no-repeat center center;
            background-size: contain;
        }

        .response:hover {
            background: url("img/img_02_hover.png") no-repeat center center;
            background-size: contain;
        }

        .responseCorrect {
            background: url("img/img_02_correct.png") no-repeat center center;
            background-size: contain;
        }

        .responseWrong {
            background: url("img/img_02_wrong.png") no-repeat center center;
            background-size: contain;
        }

        .disableddiv {
            pointer-events: none !important;
            opacity: 0.4 !important;
        }

        #PassageContainer {
            display: inline-block;
        }

        .InactiveMenu {
            opacity: 0.1;
        }

        .textArea {
            text-align: center;
            padding-bottom: 10px;
        }

        .textArea input[type="textarea"] {
            width: 90%;
            margin: 0 auto;
            height: 100px;
            font-size: 20px;
        }

        .disabledLi {
            pointer-events: none !important;
        }

        .fibRegularBox {
            margin-top: 25px;
            display: inline-block !important;
        }

        .regularBoxSmall>div {
            margin-bottom: 0;
        }

        .regularBoxLarge>div,
        .wrongBoxSmall>div,
        .wrongBoxFib>div,
        .wrongBoxLarge>div {
            margin-bottom: 0;
        }

        .regularBox>div,
        .correctBoxSmall>div,
        .correctBoxFib>div,
        .correctBoxLarge>div {
            margin-bottom: 0;
        }

        .correctBoxSmall>div {}

        #radio-choice-h-2a {
            display: none;
        }

        .ui-sortable-handle {
            margin-top: 25px;
        }

        .subTitle {
            font-size: 18px;
            font-weight: bolder;
        }

        .EnableMainDiv {
            display: block !important;
        }

        .disavledMainDiv {
            display: none !important;
        }

        #imgpause {
            padding-left: 10px;
            padding-top: 10px;
            /*display: none;*/
        }

        #imgmute {
            padding-left: 50px;
            padding-top: 10px;
            /*display: none;*/
        }

        .playpausebtn {
            display: none;
            float: left;
            padding-left: 10px;
            padding-top: 10px;
        }

        .ReadMore {
            float: right;
            margin-bottom: 6px;
        }

        .sortableWords .ui-sortable-handle {
            height: 30px !important;
        }

        @media screen and (max-width: 1024px) {
            .playpausebtn {
                display: block;
            }

            label.ui-btn {
                font-size: 16px !important;
            }

            .labelparentheight {
                margin-bottom: 26px !important;
                height: 45px !important;
            }

            .labelheight {
                height: 39px !important;
            }
        }
    </style>



</head>

<body>
    <div data-role="header" data-position="fixed" class="main-header headerm">
        <div class="container-full">
            <div class="logo-left"><a class="logo-brand" rel="external" href="#"><img alt="logo"
                        src="images/flow-english-logo.png"></a></div>
            <!-- <div><h3 id="greeting"></h3> </div> -->
            <div class="logo-right"><a class="logo-brand" rel="external" href="#"><img alt="logo"
                        src="images/chipper-sage-logo.png"></a></div>
            <h1 class="firstTitle">
                Flow Of English
                -
                <span class="secondTitle">Learner</span>
            </h1>
            <!-- <h2 id="greeting"></h2>  -->
        </div>
    </div>
    <div style="clear:both"></div>
    <div class="title-bar">
        <div class="container-full">
            <div class="page-row header">
                <!-- <div class="header "> -->
                <h3 id="greeting" style="font-size:18px;font-weight: normal;color:#262525;"></h3>
                <div class="logout-button">
                    <a href="#" class="logout-icon" onclick="handleLogout()" style="color:red"><i
                            class="fas fa-sign-out-alt"></i></a>
                </div>
                <!-- </div> -->
            </div>
        </div>
    </div>
    <div class="title-bar" id="play-bar">
        <div class="container-full">
            <div class="page-row">
                <div class="column-1">
                    <div style="width:50px;float:left;"><img src="images/play.png" id="playContainer" title="Pause"
                            class="ui-link playpausebtn" /></div>
                    <div style="width:50px;float:left;"><img src="images/pause.png" id="pauseContainer"
                            style="display:none;" title="Play" class="ui-link playpausebtn" /></div>
                    <div style="width:50px;float:left;"><img src="images/unmute.png" id="imgmute" title="Mute Sound"
                            class="ui-link" /></div>
                    <!--<div style="width:40px;float:left;"><img src="images/pause.png" id="imgpause" title="Pause" class="ui-link" /></div>-->
                    <!--Timer code-->
                    <div id="globalholder" style="font-size:15px;height:22px; padding-top:10px;display:none"></div>
                    <div id="mytimerholder" style="font-size:15px;height:22px;padding-top:10px;display:none "></div>
                    <!--Timer end -->
                </div>
                <div class="column-2">
                    <div class="page-flow">
                        <ul>
                            <li><a rel="external" href="#">Skills</a></li>
                            <li>»</li>
                            <li><a rel="external" href="#">Passages</a></li>
                            <li>»</li>
                            <li><a style="color:#fff !important" href="#">Passage</a></li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div class="main-content">
        <div class="container-full">
            <div id="DivLeft" class="col-left"></div>
            <div id="DivLeft1" class="col-left">
                <div id="D-left">
                    <a href="#" id="toggle4">Themes<span class="mob-menu-icon"><img
                                src="images/nav-icon.png" /></span></a>
                    <div class="toggle4">
                        <div id="cssmenu">
                            <p class="themes">Activities</p>
                            <ul id="ulMenuItem">
                                <li id="imptcmprntion" data-leanmode="" class="has-sub"><a
                                        href="#"><span>Comprehension</span></a></li>
                                <li id="imtVocabulary" class="has-sub"><a href="#"><span>Vocabulary</span></a></li>
                                <li id="imtJumbledWords" class="has-sub"><a href="#"><span>Jumbled words</span></a></li>
                                <li id="imtFIb" class="has-sub"><a href="#"><span>Fill in the blanks</span></a></li>
                                <li id="imptQandA" class="has-sub"><a href="#"><span>Q & A</span></a></li>
                                <li id="imtSpelling" class="has-sub"><a href="#"><span>Spelling</span></a></li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
            <div id="DivMain" class="col-middle">
                <div id="DivMainContent" style="background:url(images/skills.png);background-size:cover;">
                    <div id="insidecontainer" class="contentdivpanel">
                        <div id="moduleHeaderText"
                            style="text-align:left;font-size:1.3em;padding-left: 10px;padding-top: 0 !important; padding-bottom: 0 !important;">
                            <span></span>
                            <hr class="hrbtm" />
                        </div>

                        <div id="stackContainer">
                        </div>
                        <div id="correctAnswerContainer" style="display:none;">
                        </div>
                        <div class="ShowCheckDiv">
                            <a href="#" id="rightAnswer" data-role="button" data-inline="true" class="correctdiv"
                                style="border-radius:3px !important;margin-left:15px;">
                                <div class="bottom-menu-icon glyph-icon hand-right">Show Correct Answer</div>
                            </a>
                            <a href="#" id="rightAnswer_mat" data-role="button" data-inline="true" class="correctdiv"
                                style="border-radius:3px !important;margin-left:17px;">
                                <div class="bottom-menu-icon glyph-icon hand-right">Show Correct Answer</div>
                            </a>
                            <a href="#" id="checkanswer" data-role="button" data-inline="true"
                                style="float:right !important;border-radius: 5em !important;padding:9px 13px !important;margin-top:5px;display:none"
                                class="checkdiv">
                                <div class="bottom-menu-icon glyph-icon flaticon-tick7"></div>Check
                            </a>
                            <a href="#" id="showAnswer" data-role="button" data-inline="true" class="showanswerdiv"
                                style="border-radius:3px !important;display:none;margin-left:15px;">
                                <div class="bottom-menu-icon glyph-icon hand-right"><span id="displayAnswer"></span>
                                </div>
                            </a>
                            <a href="#" id="backtohome" data-role="button" data-inline="true"
                                style=" border-radius:3px !important;display:none;padding:.7em 3.5em!important;margin-top:1.3em;background-color:rgb(92, 184, 92) !important;margin-left:17px;"
                                class="backanswerdiv">
                                <div class="bottom-menu-icon glyph-icon hand-right"></div>Back
                            </a>
                            <a href="#" id="Backbutton" data-role="button" data-inline="true" class="showanswerdiv"
                                style="border-radius:3px !important;margin-left:15px;background-color:#5cb85c !important;">
                                <div><span>Go back to the Activities</span></div>
                            </a>
                        </div>
                    </div>
                    <div id="videocontainer" style="display:none">
                        <video id="PlayVideo" style="width:90%" controls>
                            <source id="videosrc" src="video/test1.3.mp4" type="video/mp4">
                        </video>
                    </div>
                    <div data-role="popup" id="popupDialog" class="finishpop" data-transition="pop"
                        data-dismissible="false">
                        <a href="#" data-rel="back" style="border-radius:2em !important;padding:.1em 0.1em !important"
                            class="ui-btn ui-corner-all ui-shadow ui-btn-a ui-icon-delete ui-btn-icon-notext ui-btn-right popdclose">Close</a>
                        <div data-role="header" class="pop-header">
                            <h1>Your Score</h1>
                        </div>
                        <div role="main" id="scorecontainer" style="text-align:center;">
                            <h3 class="ui-title scorefnt">You scored</h3>
                            <a href="#" class="btn-Okgreen button-stl ui-link popokbtn" data-rel="back">OK</a>
                        </div>
                    </div>
                    <div data-role="popup" id="ImagePopup" data-transition="pop" data-dismissible="false">
                        <a href="#" data-rel="back"
                            style="border-radius:4em !important;background-color:#64ce80 !important; padding:6px 6px !important;"
                            class="ui-btn ui-corner-all ui-shadow ui-btn-a ui-icon-delete ui-btn-icon-notext ui-btn-right popdclose">Close</a>

                        <div role="main" style="text-align:center;">
                            <div id="imagepath"><img style="width:400px;height:350px" class="zoomedImage" src=""></div>
                        </div>
                    </div>
                </div>


                <div data-role="popup" id="FullPassage" style="width:700px;height:auto;text-align:center;"
                    class="FullPassage" data-transition="pop" data-dismissible="false">
                    <a href="#" data-rel="back" style="border-radius:2em !important"
                        class="ui-btn ui-corner-all ui-shadow ui-btn-a ui-icon-delete ui-btn-icon-notext ui-btn-right popdclose answer-popup">Close</a>
                    <div data-role="header" class="pop-header">
                        <!--<h1 style="color:#000 !important">Correct Answer</h1>-->
                    </div>
                    <div id="FullStory"
                        style="text-align:justify;padding:30px;max-height:450px;font-size:16px;line-height:1.6;overflow-y:auto">
                    </div>
                </div>

                <div id="noContent" style="display:none;background:url(images/skills.png);background-size:contain;">
                    <div class="contentdivpanel">
                        <div id="notextData">
                            <span><img alt="No data" src="images/NoData.png"></span>
                            <p>There are no activites for this section and stage you have selected.</p>
                        </div>

                        <!-- <a href="#" id="BackbuttonNo" data-role="button" data-inline="true"
                            class="showanswerdiv backToPassage"
                            style="border-radius:3px !important;margin-left:15px;background-color:#5cb85c !important;">
                            <div><span>Go Back To Passages</span></div>
                        </a> -->
                    </div>
                </div>
                <div id="buttonPage" style="width:100%;">
                    <div class="form-button controlbuttons" style="width:40%;float:left">
                        <fieldset data-role="controlgroup" data-type="horizontal">
                            <!--The following code is added for cloodon build-->
                            <!--<div class="tooltipteach" style="height:auto">
                                <input type="radio" name="radio-choice-h-2" id="radio-choice-h-2a" value="other">
                                <span class="tooltip-content-teach">You are in teach Mode!</span>
                                <label id="teachmode" class="radiobtn" for="radio-choice-h-2a">Teach</label>
                            </div>-->
                            <!--The following code is added for cloodon build-->
                            <!--<div class="tooltiplearn" style="height:auto">
                                <input type="radio" name="radio-choice-h-2" id="radio-choice-h-2b" value="other">
                                 <span class="tooltip-content-learn">You are in learn mode!</span>
                                <label id="learnmode" class="radiobtn" for="radio-choice-h-2b">Learn</label>
                            </div>-->
                            <div class="tooltipPractice" style="height:auto">
                                <input type="radio" name="radio-choice-h-2" id="radio-choice-h-2c"
                                    style="display: none;" value="on" checked="checked">
                                <!--<span class="tooltip-content-Practice">You are in Practice mode!</span>-->
                                <label id="practicemode" class="radiobtn" style="pointer-events: none; opacity: 0.4;"
                                    for="radio-choice-h-2c">Practice</label>
                            </div>
                            <!--<div class="tooltiptest" style="height:auto">
                                <input type="radio" name="radio-choice-h-2" id="radio-choice-h-2d" value="other">
                                <span class="tooltip-content-test">You are in Test mode!</span>
                                <label id="testmode" class="radiobtn " for="radio-choice-h-2d">Test</label>
                            </div>-->
                        </fieldset>

                    </div>
                    <div class="main-pagenation rightpagination"
                        title="Click on the ellipses(3 dots) to specify a page number">
                        <div id="light-pagination" class="pagination"></div>
                    </div>
                </div>
            </div>
            <div id="DivRight" class="col-right">
                <div class="stage-class">
                    <ul>
                        <li>
                            <h3>Stage</h3>
                        </li>
                        <li><a id="stage0" class="disableStage" title="Foundation">0</a></li>
                        <li><a id="stage1" rel="external" href="African-Elephants.html?stg=1" title="Stage1">1</a></li>
                        <li><a id="stage2" class="disableStage" title="Stage2">2</a></li>
                        <li><a id="stage3" class="disableStage" title="Stage3">3</a></li>
                        <li><a id="stage4" class="disableStage" title="Stage4">4</a></li>
                        <li><a id="stage5" class="disableStage" title="Stage5">5</a></li>
                    </ul>
                </div>
                <style>
                    @media (max-width: 1600px) {

                        /* Adjust the min-width as needed for your desktop breakpoint */
                        .stage-class.bloom_pyramid {
                            display: none;
                        }
                    }
                </style>
                <div class="stage-class bloom_pyramid ">
                    <div id="bloom_1" class="p1grey"><a id="lnkBTfirstgrey" href="#popupBTfirst" data-rel="popup"><img
                                class="bloomStage" alt="logo" src="images/pyramid/pyramid_01Grey.png"
                                style="width:100%;"></a></div>
                    <div id="bloom_2" class="p2grey"><a id="lnkBTsecondgrey" href="#popupBTsecond" data-rel="popup"><img
                                class="bloomStage" alt="logo" src="images/pyramid/pyramid_02Grey.png"
                                style="width:100%;"></a></div>
                    <div id="bloom_3" class="p3grey"><a id="lnkBTthirdgrey" href="#popupBTthird" data-rel="popup"><img
                                class="bloomStage" alt="logo" src="images/pyramid/pyramid_03Grey.png"
                                style="width:100%;"></a></div>
                    <div id="bloom_4" class="p4grey"><a id="lnkBTfourthgrey" href="#popupBTfourth" data-rel="popup"><img
                                class="bloomStage" alt="logo" src="images/pyramid/pyramid_04Grey.png"
                                style="width:100%;"></a></div>
                    <div id="bloom_5" class="p5grey"><a id="lnkBTfifthgrey" href="#popupBTfifth" data-rel="popup"><img
                                class="bloomStage" alt="logo" src="images/pyramid/pyramid_05Grey.png"
                                style="width:100%;"></a></div>
                    <div id="bloom_6" class="p6grey"><a id="lnkBTsixthgrey" href="#popupBTsixth" data-rel="popup"><img
                                class="bloomStage" alt="logo" src="images/pyramid/pyramid_06Grey.png"
                                style="width:100%;"></a></div>
                </div>
                <div class="stage-class" id="scoretime">
                    <h4 class="inner-heading head-bg">Score & Time</h4>
                    <div id="totScore" class="score"></div>
                    <!--Timer code-->
                    <div id="globalClock" class="time">0:0 </div>
                    <div id="localClock" style="display:none" class="time">0:0 <span>Min</span></div>
                    <!--Timer end -->
                </div>
                <div class="stage-class" id="cmpltactivity">
                    <a style="cursor:pointer;" id="finish">
                        <div class="completeCourseSection">
                            <div class="bottom-menu-icon glyph-icon flaticon-running3"></div>
                            Complete Activity
                        </div>
                    </a>
                </div>
            </div>
        </div>
    </div>
    <div data-position="fixed" data-role="footer" class="footer">
        <div class="container-full">
            <div class="text-right footer-light">
                <!--<div class="logged-in">You are logged in as : <span class="value"> John Smith</span></div>
                <div class="subscription">Subscription : <span class="value"> Stage2</span></div>
                <div class="valid-until">Valid Until : <span class="value"> Aug 18, 2017</span></div>-->
                <div class="footer-text">
                    <p class="text-muted">Flow of English &copy; 2017, The Chipper Sage Pvt. Ltd. All Rights Reserved
                    </p>
                </div>
            </div>
        </div>
    </div>
    <script type="text/javascript" src="js/jquery.wizard.js"></script>
    <script>
        $(function () {
            viewStack = $("#myViewStack").viewstack({
                selectedIndex: 0,
                creationComplete: function (e, data) {

                },
                //registering selectedIndex change event
                selectedIndexChanged: function (e, data) {

                }
            });
        });
    </script>
    <!--Timer code-->
    <!-- <script type="text/javascript" src="js/timer.js"></script> -->
    <!--Timer end -->
    <!--   Start - step 1 disabling right click on HTML page -->
    <script type="text/javascript">
        $(document).ready(function () {
            //Disable full page
            $("body").on("contextmenu", function (e) {
                return false;

            });


        });
    </script>
    <script>
        const firebaseConfig = {
            apiKey: "AIzaSyCr67hjaYZtUp4K32J8Ga4x6fcMFDZb6Z4",
            authDomain: "quiz-app-f21c8.firebaseapp.com",
            databaseURL: "https://quiz-app-f21c8-default-rtdb.firebaseio.com",
            projectId: "quiz-app-f21c8",
            storageBucket: "quiz-app-f21c8.appspot.com",
            messagingSenderId: "717819943537",
            appId: "1:717819943537:web:143434ed850a72dc5ed9d0"
        };

        // Initialize Firebase
        firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();

        document.addEventListener("DOMContentLoaded", () => {
            const completeActivityButton = document.getElementById("finish");
        });

        var mysec = 0;
        var myminute = 0;
        var mysecGlobal = 0;
        var myminuteGlobal = 0;
        var count = 0;
        var countGlobal = 0;
        var countModeLocal = 0;
        var countMode = 0;
        var mytimerId1, mytimerId2, mytimerglobalId1, mytimerGlobalId2;

        function timer() {
            // Clear existing intervals
            clearInterval(mytimerId1);
            clearInterval(mytimerId2);

            // Start local timer
            mytimerId1 = setInterval(function () {
                mysec++;
                if (mysec >= 60) {
                    mysec = 0;
                    myminute++;
                }
                $("#localClock").html(myminute + ":" + (mysec < 10 ? "0" : "") + mysec);
            }, 1000);

            mytimerId2 = setInterval(function () {
                $("#localClock").html(myminute + ":" + (mysec < 10 ? "0" : "") + mysec);
            }, 60000);

            $("#light-pagination").click(function () {
                clearInterval(mytimerId1);
                clearInterval(mytimerId2);
                mysec = 0;
                myminute = 0;
                $("#localClock").html(myminute + ":" + (mysec < 10 ? "0" : "") + mysec);
            });

            $("#finish").on("vclick", function () {
                stopminLocal = myminute;
                stopsecLocal = mysec;
                $("#localClock").html(stopminLocal + ":" + (stopsecLocal < 10 ? "0" : "") + stopsecLocal);
                clearInterval(mytimerId1);
                clearInterval(mytimerId2);
                count++;
                countModeLocal = 1;
            });

            $("#ulMenuItem").on("click", ".has-sub", function () {
                mysec = 0;
                myminute = 0;
                if (count !== 0) {
                    timer();
                    count = 0;
                    countModeLocal = 0;
                }
            });

            $(".form-button").click(function () {
                if (countModeLocal === 1) {
                    mysec = 0;
                    myminute = 0;
                    timer();
                    count = 0;
                    countModeLocal = 0;
                }
            });
        }

        function timerGlobal() {
            // Clear existing intervals
            clearInterval(mytimerglobalId1);
            clearInterval(mytimerGlobalId2);

            // Start global timer
            mytimerglobalId1 = setInterval(function () {
                mysecGlobal++;
                if (mysecGlobal >= 60) {
                    mysecGlobal = 0;
                    myminuteGlobal++;
                }
                $("#globalClock").html(myminuteGlobal + ":" + (mysecGlobal < 10 ? "0" : "") + mysecGlobal);
            }, 1000);

            mytimerGlobalId2 = setInterval(function () {
                $("#globalClock").html(myminuteGlobal + ":" + (mysecGlobal < 10 ? "0" : "") + mysecGlobal);
            }, 60000);

            $("#finish").on("vclick", function () {
                stopmin = myminuteGlobal;
                stopsec = mysecGlobal;
                $("#globalClock").html(stopmin + ":" + (stopsec < 10 ? "0" : "") + stopsec);
                clearInterval(mytimerglobalId1);
                clearInterval(mytimerGlobalId2);
                countGlobal++;
                countMode = 1;
            });

            $("#ulMenuItem").on("click", ".has-sub", function () {
                mysecGlobal = 0;
                myminuteGlobal = 0;
                if (countGlobal !== 0) {
                    timerGlobal();
                    countGlobal = 0;
                    countMode = 0;
                }
            });

            $(".form-button").click(function () {
                if (countMode === 1) {
                    mysecGlobal = 0;
                    myminuteGlobal = 0;
                    timerGlobal();
                    countGlobal = 0;
                    countMode = 0;
                }
            });
        }

        // Initialize the timers
        timer();
        timerGlobal();

        // For UI-radio buttons to be in a single line in tablet
        $(document).on("pagecreate", function () {
            $("input[type=radio]").checkboxradio("refresh");
        });


    </script>

    <!--  End - step 1 -->
</body>

</html>